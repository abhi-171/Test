self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[265],{10580:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(6);function r(){return Object(o.i)()?"https://augloop-dogfood.officeppe.com":"https://augloop.office.com"}},10581:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n(40),r="mc-officeEditorALEnabled",s="mc-officeEditorTonalEnabled";function i(){var e=Object(o.i)(r),t=[];return Object(o.i)(s)&&t.push(s),e&&t.push(r),t}},10627:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(15166);Object.defineProperty(t,"runtime",{enumerable:!0,get:function(){return s.runtime}}),Object.defineProperty(t,"createRuntime",{enumerable:!0,get:function(){return s.createRuntime}}),r(n(10632),t);var i=n(15219);Object.defineProperty(t,"SingleItemWorkflow",{enumerable:!0,get:function(){return i.SingleItemWorkflow}})},10628:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.arrayOperators=void 0,function(e){e.some="some",e.every="every",e.none="none"}(t.arrayOperators||(t.arrayOperators={}))},10629:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.comparisonOperators=void 0,function(e){e.eq="eq",e.ne="ne",e.ge="ge",e.gt="gt",e.lt="lt",e.le="le"}(t.comparisonOperators||(t.comparisonOperators={}))},10630:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.logicalOperators=void 0,function(e){e.All="All",e.Any="Any"}(t.logicalOperators||(t.logicalOperators={}))},10631:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.now=void 0;t.now=void 0!==e&&e.hrtime?function(){var t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return Date.now()}}).call(this,n(136))},10632:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LambdaSource=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(t.LambdaSource||(t.LambdaSource={}))},10633:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenCache=void 0;var o=n(4630),r=function(){function e(e){void 0===e&&(e=33e5),this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=e}return e.prototype.updateAuthToken=function(e,t){var n=this,r=JSON.stringify(t),s=this.requestRecordMap.get(r);return(void 0===s||this.isTokenExpired(s))&&(s={requestPromise:e.requestAuthToken(t).then((function(e){if(!e||!e.Token)throw new Error("No token available for request "+r);n.tokenCache.set(r,e.Token)})),requestTime:o.Utils.getCurrentTimeMs()},this.requestRecordMap.set(r,s)),s.requestPromise},e.prototype.getAuthTokenEntries=function(e,t){var n=this;return Array.from(this.tokenCache.keys()).map((function(e){var t=n.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),n.requestMap.set(e,t)),{requestKey:e,request:t}})).filter((function(e){var n=e.request;return!t||n.DocId===t})).map((function(t){var o=t.requestKey,r=t.request;return n.isTokenExpired(n.requestRecordMap.get(o))&&n.updateAuthToken(e,r),{ticket:r.Tickets[0],token:n.tokenCache.get(o)}}))},e.prototype.isTokenExpired=function(e){return o.Utils.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs},e}();t.TokenCache=r},10634:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketWorker=void 0;var o=n(15196),r=n(3521),s=n(4630),i=function(){function e(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.pendingEgress=[]}return e.prototype.init=function(t,n,s){var i=this;this.ws=new o(t),this.logOp=new r.Operation({operationName:e.className,success:!0}).start();var a=function(e){i.logPingLatencyOp.stop(),i.logPingLatencyOp.success=e,r.Log.info(592836228,r.LogCategory.CoreDefault,i.logPingLatencyOp),i.logPingLatencyOp=void 0};this.ws.addEventListener("open",(function(t){e.logCountLimiter.log((function(){i.logOp.resourceId="OnOpen",i.logOp.resultDescription="",i.logOp.success=!0,i.logOp.stop(),r.Log.info(594642307,r.LogCategory.CoreDefault,i.logOp)})),i.hasBeenOpened=!0,i.pendingEgress.forEach((function(e){i.egress(e)})),i.pendingEgress=[],i.pingInterval=setInterval((function(){i.logPingLatencyOp&&(--i.remainingPingFailures,a(!1)),i.remainingPingFailures>0&&i.hasBeenOpened&&i.lastPongTime<i.lastEgressTime&&(i.ws.send(e.pingPongMessage,(function(e){e&&(--i.remainingPingFailures,a(!1))})),i.logPingLatencyOp=new r.Operation({operationName:"Ping",success:!0,dimension0:i.ws.bufferedAmount>=0?i.ws.bufferedAmount.toString().length.toString():void 0}).start())}),3e4)})),this.ws.addEventListener("message",(function(t){i.logPingLatencyOp&&"string"==typeof t.data&&1===t.data.length&&t.data[0]===e.pingPongMessage?(a(!0),i.lastPongTime=Date.now()):n(t.data)})),this.ws.addEventListener("error",(function(t){i.errorMessage=t.message,e.logCountLimiter.log((function(){i.logOp.resourceId="OnError",i.logOp.resultDescription=i.errorMessage,i.logOp.success=!1,i.logOp.stop(),r.Log.info(594642308,r.LogCategory.CoreDefault,i.logOp)})),i.ws.close()})),this.ws.addEventListener("close",(function(t){e.logCountLimiter.log((function(){i.logOp.resourceId="OnClose",i.logOp.resultDescription=t?"code: "+t.code+". reason: "+t.reason:"",i.logOp.success=!0,i.logOp.stop(),r.Log.info(594642309,r.LogCategory.CoreDefault,i.logOp)})),i.pingInterval&&(clearInterval(i.pingInterval),i.pingInterval=void 0),s(i.errorMessage)}))},e.prototype.egress=function(t){var n=this;this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,(function(t){t&&!n.hadEgressError&&(n.hadEgressError=!0,e.logCountLimiter.log((function(){n.logOp.resourceId="OnFirstEgressError",n.logOp.resultDescription=t.message,n.logOp.success=!1,n.logOp.stop(),r.Log.info(594642310,r.LogCategory.CoreDefault,n.logOp)})))})):this.pendingEgress.push(t)},e.prototype.close=function(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close()},e.className="WebSocketWorker",e.logCountLimiter=new s.LogCountLimiter(e.className),e.pingPongMessage="~",e}();t.WebSocketWorker=i},10635:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionHealth=t.SessionHealthImpact=t.SessionHealthReason=t.SessionHealthSource=void 0;var s,i,a,c=n(15201),u=n(10631);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(s=t.SessionHealthSource||(t.SessionHealthSource={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(i=t.SessionHealthReason||(t.SessionHealthReason={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(a=t.SessionHealthImpact||(t.SessionHealthImpact={}));var l=function(e){function t(t,n){var o,r,c=e.call(this,{source:s[t.source],reason:i[t.reason],reasonDependency:t.reasonDependency,sessionHealthEventName:t.sessionHealthEventName,impact:a[t.impact],success:t.success,durationMs:null!==(o=t.durationMs)&&void 0!==o?o:0,count:"number"==typeof t.count?t.count:1,message:t.message,affectedWorkflows:(null!==(r=t.affectedWorkflows)&&void 0!==r?r:[]).join(","),resourceId:t.resourceId,dimension0:t.dimension0,dimension1:t.dimension1,dimension2:t.dimension2,dimension3:t.dimension3,cv:t.cv,resultSignature:t.resultSignature,resultDescription:t.resultDescription})||this;return c.eventName="SessionHealth",n&&c.setClientMetadata(n),c}return r(t,e),t.prototype.setClientMetadata=function(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId),this},t.prototype.setReason=function(e){return this.reason=i[e],this},t.prototype.setSource=function(e){return this.source=s[e],this},t.prototype.setImpact=function(e){return this.impact=a[e],this},t.prototype.setAffectedWorkflows=function(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this},t.prototype.getAffectedWorkflows=function(){return this.affectedWorkflows.split(",")},t.prototype.start=function(){return this.startTime=u.now(),this},t.prototype.stop=function(){var e=u.now();return this.durationMs=Math.round(e-this.startTime),this},t}(c.SessionHealthEvent);t.SessionHealth=l},10636:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenProvisionResponse=t.TokenProvisionMessage=t.AnnotationResultsMessage=t.SessionDeleteMessage=t.SyncResponse=t.MicroSyncMessage=t.SyncMessage=t.AnnotationReleaseResponse=t.AnnotationReleaseMessage=t.AnnotationResultStateMessage=t.AnnotationActivationResponse=t.AnnotationActivationMessage=t.CacheDumpRequestResponse=t.CacheDumpRequestMessage=t.SessionCloseMessage=t.SessionInitResponse=t.SessionInitMessage=t.TimeoutErrorResponse=t.ErrorResponse=t.Response=t.Message=void 0;var o=n(3150),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Message"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Message=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_Response"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Response=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_ErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ErrorResponse=i;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TimeoutErrorResponse=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionInitMessage=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionInitResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionInitResponse=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionCloseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionCloseMessage=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.CacheDumpRequestMessage=p;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.CacheDumpRequestResponse=h;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationActivationMessage=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationActivationResponse=d;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationResultStateMessage=g;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationReleaseMessage=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationReleaseResponse=m;var v=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SyncMessage=v;var S=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_MicroSyncMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MicroSyncMessage=S;var T=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SyncResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SyncResponse=T;var b=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_SessionDeleteMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SessionDeleteMessage=b;var C=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AnnotationResultsMessage=C;var w=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionMessage"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Message"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TokenProvisionMessage=w;var _=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Session_Protocol_TokenProvisionResponse"},e.getBaseTypes=function(){return["AugLoop_Session_Protocol_Response"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TokenProvisionResponse=_},10637:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BatchManager=void 0;var o=n(3521),r=n(5492),s=function(){function e(e,t){this.batchesByGroupingKey=new Map,this.submit=e,this.onSummary=t}return e.prototype.addBatchItem=function(e,t,n,r,s){var i=this,a=t.delayMs,c=t.maxInputSize,u=t.estimateSize,l=t.groupingKeyExtractor,p=u(e),h=l(e);if(t.split&&p>c){var f;try{f=t.split(e)}catch(e){var d=new Error("Split error: "+e.message);return void(s?s(d):o.Log.error(595150344,o.LogCategory.CoreDefault,d))}if(f&&Array.isArray(f.inputs)&&f.inputs.length>1){for(var g,y=[],m=s?function(e,t){if(g=g||e,y.push(t),y.length===f.inputs.length){var n;try{n=f.join(y)}catch(e){return void s(new Error("Join error: "+e.message))}s(g,n)}}:void 0,v=0,S=f.inputs;v<S.length;v++){var T=S[v];this.addBatchItem(T,t,n,r,m)}return}}var b=this.batchesByGroupingKey.get(h);b&&b.size+p>c&&(clearTimeout(b.timeout),this.executeBatch(h,b,t),b=void 0),b||(b={items:[],size:0,hasItemsWithCallbacks:!1,context:n},this.batchesByGroupingKey.set(h,b)),b.items.push({input:e,size:p,callback:s}),b.size+=p,b.hasItemsWithCallbacks=b.hasItemsWithCallbacks||!!s,b.cv=r,clearTimeout(b.timeout),b.timeout=setTimeout((function(){i.executeBatch(h,b,t)}),a)},e.prototype.executeBatch=function(e,t,n){var s=this;this.batchesByGroupingKey.delete(e);var i,a=t.items,c=function(e){return e<0?"Negative":0===e?"0":1===e?"1":"Magnitude "+e.toString().length},u=new o.Operation({operationName:"ExecuteBatch",cv:t.cv,resourceId:t.context.name,dimension0:"Count "+c(a.length),dimension1:"Size "+c(t.size)}).start(),l=function(e,n,s){var i;if(n&&n.exceptionType===r.ExceptionType.NoOutput)u.success=!0,o.Log.info(594379348,o.LogCategory.CoreDefault,u.stop());else{var c=e+" error: "+(n?n.message||n:"Unknown error");i=n||new Error(c),u.success=!1,u.resultDescription="Batch of "+a.length+" items of size "+t.size+" with "+c,u.resultSignature=e+" Error",o.Log.error(594542914,o.LogCategory.CoreDefault,u.stop())}if(t.hasItemsWithCallbacks)for(var l=0,p=a;l<p.length;l++){var h=p[l];h.callback&&h.callback(i,s)}};try{i=n.multiplex(a.map((function(e){return e.input})))}catch(e){return void l("Multiplex",e)}this.submit(i.input,t,(function(e,r){var c;if(e||"exceptionType"in r||r instanceof Error)l("Submit",e||r,r);else if(t.hasItemsWithCallbacks||n.summaryExtractor){var p=void 0;if(t.hasItemsWithCallbacks)try{if((p=i.demultiplex(r)).length!==a.length)throw new Error("Mismatched output length")}catch(e){return void l("Demultiplex",e)}var h=void 0,f=void 0;if(n.summaryExtractor)try{f=(c=n.summaryExtractor(r))[0],h=c[1]}catch(e){return void l("SummaryExtractor",e)}if(u.success=!0,o.Log.info(594542915,o.LogCategory.CoreDefault,u.stop()),t.hasItemsWithCallbacks)for(var d=0;d<a.length;d++)a[d].callback&&a[d].callback(void 0,p[d]);h&&s.onSummary(f,h,t.context)}else u.success=!0,o.Log.info(594379349,o.LogCategory.CoreDefault,u.stop())}))},e}();t.BatchManager=s},10638:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLargerThan=t.estimateSize=void 0,t.estimateSize=function(e){return o(e,Number.POSITIVE_INFINITY)},t.isLargerThan=function(e,t){return o(e,t)>t};var o=function(e,t){for(var n=0,o=[],r=[e];r.length>0;){var s=r.pop(),i=typeof s;if("boolean"===i)n+=4;else if("string"===i)n+=2*s.length;else if("number"===i)n+=8;else if("object"===i&&s&&-1===o.indexOf(s))if(s instanceof Uint8Array)n+=s.length;else for(var a in o.push(s),s)r.push(s[a]);if(n>t)return n}return n}},10639:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TokenRefreshManager=t.TokenType=void 0,function(e){e[e.Anonymous=0]="Anonymous",e[e.Host=1]="Host"}(t.TokenType||(t.TokenType={}));var o=function(){function e(){this.timers=new Map}return e.prototype.scheduleRefresh=function(t,n,o){var r=this.timers.get(t);r||(r={numberOfAttempts:0},this.timers.set(t,r)),r.timeoutId&&(clearTimeout(r.timeoutId),r.timeoutId=void 0);var s=1e3*n-e.tokenExpirationBufferMs;s>0?r.numberOfAttempts=0:(++r.numberOfAttempts,s=e.tokenRefreshBackoffIntervalMs),r.numberOfAttempts<=e.tokenRefreshMaximumAttempts&&(r.timeoutId=setTimeout((function(){return o()}),s))},e.prototype.clearTimeouts=function(){this.timers.forEach((function(e){clearTimeout(e.timeoutId)})),this.timers=new Map},e.tokenExpirationBufferMs=24e4,e.tokenRefreshBackoffIntervalMs=3e4,e.tokenRefreshMaximumAttempts=3,e}();t.TokenRefreshManager=o},11081:function(e,t,n){"use strict";function o(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}const r=65279;function s(e){if(!e)return[];const t=function(e){const t=atob(e),n=Uint8Array.from(t,e=>e.charCodeAt(0)),o=new Uint16Array(n.length/2);if((n[1]<<8|n[0])!==r)throw new Error("Unexpected string encoding");for(let e=0;e<n.length;e+=2){const t=n[e+1],r=n[e],s=t<<8|r;o[e/2]=s}return o.slice(1)}(e);let n="";return t.forEach(e=>{n+=String.fromCharCode(e)}),n.split("\r\n").filter(e=>e)}function i(e){return function(e){let t="";return e.forEach(e=>{t+=String.fromCharCode(e)}),btoa(t)}(function(e){const t=new Uint16Array(e.length+1),n=new Uint8Array(2*t.length);t[0]=r;for(let n=0;n<e.length;n++)t[n+1]=e.charCodeAt(n);for(let e=0;e<n.length;e+=2){const o=t[e/2],r=o>>8,s=255&o;n[e]=s,n[e+1]=r}return n}(e.join("\r\n")+"\r\n"))}function a(e,t,n){var o;const r={isFaulted:!1};try{const t=JSON.parse(e),s=null===(o=null==t?void 0:t.diagnostics_data)||void 0===o?void 0:o.http_status_code;if(r.resultCode=s,!function(e){if(!e)return!1;return e>=200&&e<300}(s))throw new Error(`Received error status code: ${s||0}`);const i=t.settings;if(!i)throw new Error("Settings not defined in response");if(i.forEach(e=>{e.id===n&&(r.value=e.value)}),!r.value)throw new Error(`Value for setting id: ${n} not defined in response`)}catch(e){r.isFaulted=!0,r.fault={errorMessage:e.errorMessage}}return r}var c;function u(e,{response:t},n){return{requestType:e,response:a(t.body,0,n)}}!function(e){e[e.ReadSetting=0]="ReadSetting",e[e.WriteSettingItem=1]="WriteSettingItem"}(c||(c={}));const l={AppName:"RoamingSvcSoapWebClient",AppVersion:"1.0.0",DefaultKnowledge:-1,KnowledgeId_Null:-1,WebClient_POST_TimeoutMsecs:3e4};var p;!function(e){e[e.Uninitialized=0]="Uninitialized",e[e.NormalOrTransientCondition=1e3]="NormalOrTransientCondition",e[e.Success=1001]="Success",e[e.WriteFailed=1002]="WriteFailed",e[e.ServerUnavailable=1003]="ServerUnavailable",e[e.IntermittentCondition=2e3]="IntermittentCondition",e[e.Throttled=2001]="Throttled",e[e.SemiPersistentCondition=3e3]="SemiPersistentCondition",e[e.ServerError=3001]="ServerError",e[e.ServiceDisabled=3002]="ServiceDisabled",e[e.UserFlaggedAsDisabled=3003]="UserFlaggedAsDisabled",e[e.UserNotLicensed=3004]="UserNotLicensed",e[e.PersistentCondition=4e3]="PersistentCondition",e[e.Redirect=4001]="Redirect",e[e.ReconstructClient=4002]="ReconstructClient",e[e.ReconstructServer=4003]="ReconstructServer",e[e.UserNotFound=4004]="UserNotFound",e[e.UnsupportedClient=4005]="UnsupportedClient",e[e.UnsupportedProtocol=4006]="UnsupportedProtocol",e[e.DuplicateWrites=4007]="DuplicateWrites",e[e.InvalidDataValue=4008]="InvalidDataValue",e[e.InvalidListItemData=4009]="InvalidListItemData",e[e.InvalidListItemKey=4010]="InvalidListItemKey",e[e.InvalidSettingId=4011]="InvalidSettingId",e[e.MalformedRequest=4012]="MalformedRequest",e[e.MustNotSpecifyContext=4013]="MustNotSpecifyContext",e[e.MustSpecifyContext=4014]="MustSpecifyContext",e[e.SettingTooLarge=4015]="SettingTooLarge",e[e.TypeMismatch=4016]="TypeMismatch",e[e.InvalidListAction=4017]="InvalidListAction",e[e.ClearSettingData=4018]="ClearSettingData"}(p||(p={}));const h=e=>new Promise(t=>setTimeout(t,e)),f=(e,t)=>Promise.race([e,h(t).then(()=>{throw new Error("TIMEOUT")})]);var d=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};function g(e,t,n,o,r){return d(this,void 0,void 0,(function*(){if(!n)throw new Error("action cannot be null or empty");const s={headers:{"Content-Type":"application/json",Authorization:e,"X-CorrelationId":o.correlationId,"X-Office-Application":`${o.hostApplication}`,"X-Office-Platform":o.hostPlatform,"X-Office-Version":o.hostVersion},method:"ReadSettings"===n?"GET":"PUT"};"WriteSettings"===n&&(s.body=`"${o.value}"`);const i=`${t}/${o.settingId}?rs=${o.hostCulture}`,a=fetch(i,s);let c;try{c=yield f(a,l.WebClient_POST_TimeoutMsecs)}catch(e){throw new Error("WCC: HTTP POST timed out")}if(!c)throw new Error("WCC: No response");if(!c.ok)throw new Error(`WCC: HTTP POST failed: ${c}`);const u={response:{body:yield c.text(),status:c.status,statusText:c.statusText}};return null==r||r.verbose(`WCC: HTTP POST successful: ${u}`),u}))}var y=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};const m={BlackForest:"https://roaming.osi.office.de/rs/v1/settings",Gallatin:"https://roaming.officeapps.partner.office365.cn/rs/v1/settings",PPE:"https://roaming.edog.officeapps.live.com/rs/v1/settings",PROD:"https://roaming.officeapps.live.com/rs/v1/settings",UsGov:"https://roaming.osi.office365.us/rs/v1/settings",UsGovDoD:"https://roaming.osi.apps.mil/rs/v1/settings"};class v{constructor(e,t,n){if(this.accessToken=t,this.logger=n,!e)throw new Error("Environment cannot be null or empty!");if(!m[e])throw new Error(`Environment is invalid. Valid values are [${Object.keys(m)}]`);if(!t)throw new Error("access token cannot be null or empty");this.endpoint=m[e]}read(e){return y(this,void 0,void 0,(function*(){try{const t=yield g(this.accessToken,this.endpoint,"ReadSettings",e,this.logger);return u(c.ReadSetting,t,e.settingId)}catch(e){throw new Error(`exception thrown during Read operation: ${e.message}`)}}))}write(e){return y(this,void 0,void 0,(function*(){try{const t=yield g(this.accessToken,this.endpoint,"WriteSettings",e,this.logger);return u(c.WriteSettingItem,t,e.settingId)}catch(e){throw new Error(`exception thrown during Write operation: ${e.message}`)}}))}}var S=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};function T(e,t,n){return S(this,void 0,void 0,(function*(){if(e){const o=yield e();if(!o)throw new Error("No auth token");return new v(t,o,n)}throw new Error("AuthTokenCallback undefined")}))}const b=1065;var C=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};var w=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};var _,M=function(e,t,n,o){return new(n||(n=Promise))((function(r,s){function i(e){try{c(o.next(e))}catch(e){s(e)}}function a(e){try{c(o.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((o=o.apply(e,t||[])).next())}))};!function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.LOAD_ERROR=3]="LOAD_ERROR"}(_||(_={}));class O{constructor(e,t,n,o,r,s,i){this.authTokenCallback=e,this.environment=t,this.hostApplication=n,this.hostVersion=o,this.hostPlatform=r,this.hostCulture=s,this.logger=i,this.wordSet=new Set,this.lowerCaseWordSet=new Set,this.loadState=_.NOT_LOADED}loadWordListFromRoamingService(e){return M(this,void 0,void 0,(function*(){let t;this.loadState=_.LOADING;try{t=yield function(e,t,n,o,r,s,i,a){var c;return C(this,void 0,void 0,(function*(){const u=yield T(e,t,a);if(u){const e={hostApplication:n,hostVersion:o,hostPlatform:r,hostCulture:s,correlationId:i,settingId:b},t=yield u.read(e);if(t&&t.response){if(t.response.isFaulted)throw new Error(`Got fault in response. ResultCode: ${t.response.resultCode}. ErrorMessage: ${null===(c=t.response.fault)||void 0===c?void 0:c.errorMessage}`);return t.response.value||""}throw new Error("No response from service")}throw new Error("Web Service was not created")}))}(this.authTokenCallback,this.environment,this.hostApplication,this.hostVersion,this.hostPlatform,this.hostCulture,e,this.logger)}catch(e){return this.loadState=_.LOAD_ERROR,{success:!1,errorMessage:e.message}}if(!t)return this.loadState=_.LOADED,this.wordSet=new Set,this.lowerCaseWordSet=new Set,{success:!0};try{const e=s(t);return this.wordSet=new Set(e),this.lowerCaseWordSet=new Set(e.map(e=>e.toLocaleLowerCase())),this.loadState=_.LOADED,{success:!0}}catch(e){return this.loadState=_.LOAD_ERROR,{success:!1,errorMessage:e.message}}}))}saveWordListToRoamingService(e){return M(this,void 0,void 0,(function*(){if(this.loadState!==_.LOADED)return{success:!1,errorMessage:"No dictionary previously loaded"};const t=Array.from(this.wordSet).sort(o);let n="";try{n=i(t)}catch(e){return{success:!1,errorMessage:e.message}}if(n)try{return yield function(e,t,n,o,r,s,i,a,c){return w(this,void 0,void 0,(function*(){const u=yield T(e,t,c);if(u){const e={hostApplication:o,hostVersion:r,hostPlatform:s,hostCulture:i,correlationId:a,settingId:b,value:n},t=yield u.write(e);if(t&&t.response){if(t.response.isFaulted)throw new Error(`Received fault when writing setting. ResultCode: ${t.response.resultCode}`);return}throw new Error("No response received")}throw new Error("Web Service was not created")}))}(this.authTokenCallback,this.environment,n,this.hostApplication,this.hostVersion,this.hostPlatform,this.hostCulture,e,this.logger),{success:!0}}catch(e){return{success:!1,errorMessage:e.message}}return{success:!1,errorMessage:"Nothing to save"}}))}testWord(e,t){return t?this.wordSet.has(e):this.lowerCaseWordSet.has(e.toLocaleLowerCase())}getWordList(){return Array.from(this.wordSet)}addWord(e){if(e&&!this.wordSet.has(e)){this.wordSet.add(e);const t=e.toLocaleLowerCase();return this.lowerCaseWordSet.has(t)||this.lowerCaseWordSet.add(t),!0}return!1}removeWord(e){if(e&&this.wordSet.has(e)){this.wordSet.delete(e);const t=e.toLocaleLowerCase();return this.lowerCaseWordSet.has(t)&&this.lowerCaseWordSet.delete(t),!0}return!1}getLoadState(){return this.loadState}}n.d(t,"b",(function(){return O})),n.d(t,"a",(function(){return _}))},1230:function(e,t,n){"use strict";function o(e){if(this._capacity=s(e),this._length=0,this._front=0,r(e)){for(var t=e.length,n=0;n<t;++n)this[n]=e[n];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),n=this._front,o=this._capacity,r=0;r<e;++r)t[r]=this[n+r&o-1];return t},o.prototype.push=function(e){var t=arguments.length,n=this._length;if(t>1){var o=this._capacity;if(n+t>o){for(var r=0;r<t;++r){this._checkCapacity(n+1),this[s=this._front+n&this._capacity-1]=arguments[r],n++,this._length=n}return n}for(var s=this._front,r=0;r<t;++r)this[s+n&o-1]=arguments[r],s++;return this._length=n+t,n+t}return 0===t?n:(this._checkCapacity(n+1),this[r=this._front+n&this._capacity-1]=e,this._length=n+1,n+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,n=this[t];return this[t]=void 0,this._length=e-1,n}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,n=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,n}},o.prototype.unshift=function(e){var t=this._length,n=arguments.length;if(n>1){if(t+n>(r=this._capacity)){for(var o=n-1;o>=0;o--){this._checkCapacity(t+1);var r=this._capacity;this[i=(this._front-1&r-1^r)-r]=arguments[o],t++,this._length=t,this._front=i}return t}var s=this._front;for(o=n-1;o>=0;o--){var i;this[i=(s-1&r-1^r)-r]=arguments[o],s=i}return this._front=s,this._length=t+n,t+n}if(0===n)return t;this._checkCapacity(t+1);r=this._capacity;return this[o=(this._front-1&r-1^r)-r]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var n=this._length;if(t<0&&(t+=n),!(t<0||t>=n))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,n=this._capacity,o=0;o<e;++o)this[t+o&n-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(s(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var n=this._front,o=this._length;n+o>t&&function(e,t,n,o,r){for(var s=0;s<r;++s)n[s+o]=e[s+t],e[s+t]=void 0}(this,0,this,t,n+o&t-1)};var r=Array.isArray;function s(e){if("number"!=typeof e){if(!r(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}e.exports=o},15166:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.createRuntime=t.runtime=t.ClientRuntime=t.getTypeFromSchema=t.Workflow=void 0;var r,s=n(6877),i=n(3521),a=n(5492),c=n(10632),u=n(15190),l=n(15194),p=n(15197),h=n(15198),f=n(15199),d=n(10634),g=n(15200),y=n(15211),m=n(10637),v=n(10638),S=n(15212),T=n(4630),b=n(15216),C=n(15217),w=n(10639);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(r||(r={}));var _=function(){function e(){this.stateByDocId=new Map,this.executionQueueByDocId=new Map}return e.prototype.scheduleExecution=function(e,t){var n=this.docIdExtractor?this.docIdExtractor(e):void 0,o=this.getStateForDocId(n);if(o===r.Restricted){var s=this.getExecutionQueueForDocId(n);s.push(t),1===s.length&&t()}else o===r.Unrestricted?t():r.Suppressed},e.prototype.onFinish=function(e,t){if(t===a.ExceptionType.Authentication)this.stateByDocId.set(e,r.Suppressed),this.executionQueueByDocId.delete(e);else if(this.stateByDocId.get(e)===r.Restricted){var n=this.getExecutionQueueForDocId(e);if(n.shift(),void 0===t){this.stateByDocId.set(e,r.Unrestricted),this.executionQueueByDocId.delete(e);for(var o=0,s=n;o<s.length;o++){(0,s[o])()}}else if(n.length>0){(0,n[0])()}}},e.prototype.onRefresh=function(){this.stateByDocId=new Map,this.triggerOnRefresh&&(this.executionQueueByDocId=new Map)},e.prototype.getStateForDocId=function(t){var n=this.stateByDocId.get(t);return void 0===n&&(n=e.executionQueuesEnabled?r.Restricted:r.Unrestricted,this.stateByDocId.set(t,n)),n},e.prototype.getExecutionQueueForDocId=function(e){var t=this.executionQueueByDocId.get(e);return void 0===t&&(t=[],this.executionQueueByDocId.set(e,t)),t},e.executionQueuesEnabled=!0,e}();t.Workflow=_,t.getTypeFromSchema=function(e){return{category:a.TypeCategory.Schema,schema:{name:e}}};var M=function(e,t){return"Tiling.TextTileEvent"===e&&t&&t.type==a.Tiling.TextTileEventType.Refresh},O=function(e,t){return"ClpSlideTile"===e&&t&&t.eventType==a.Ppt.SlideTileEventType.Refresh},k=function(e,t){return M(e,t)||O(e,t)},A=function(){function e(e,t,n){this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new h.ResultCache,this.reduceTimerCache=new p.ReduceTimerCache,this.lookupTableCache=new Map,this.sessionsByDocSessionId=new Map,this.throttling=new y.ExecutionWithThrottling,this.lastTileRefreshSeq=-1,this.workerFactory=e||function(){return new d.WebSocketWorker},this.sessionManagerFactory=t||this.createDefaultSessionManagerFactory(),this.sessionFactory=n||function(e){return new S.Session(e)}}return e.prototype.init=function(e,t,o,r){var s=this,a=new i.Operation({operationName:"InitRuntime",resourceId:e});a.start(),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=n(15218).version),this.hostCallbacks=o,i.Log.addLogger(new f.TelemetryLogger(this.hostCallbacks));var c=r.telemetryAggregationIntervalSec,p=r.initSession,h=r.batchOptions;if(c>0){var d=function(e,t,n){return new i.LoggingAggregator(e,(function(e){return e.success&&n.indexOf(e[t])>=0}),[t,"resourceId","success","resultSignature","dimension0","dimension1","dimension2","dimension3"],["durationMs"],c)};i.Log.addAggregator(d("Operation","operationName",["ExecuteLambda","ExecuteWorkflow","ExecuteBatch","ProcessResponse"])),i.Log.addAggregator(d("SessionHealth","sessionHealthEventName",["ProcessMessage","SendMessage"]))}this.batchOptions=h;var g=[];return g.push(this.isFeatureEnabled("DisableWebSocket").then((function(n){if(!!n)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf(t.appName+" "+t.appPlatform)>=0)||l.testWebSocketConnection(T.Utils.convertServiceUrlToWebSocket(e),s.clientMetadata)})).then((function(t){e&&(s.serviceUrl=t?T.Utils.convertServiceUrlToWebSocket(e):e,s.executeRemoteLambda=t?l.executeRemoteLambda:u.executeRemoteLambda,s.clearRemoteLambdaTokenCache=t?l.clearTokenCache:u.clearTokenCache,s.serviceProtocol=s.serviceUrl.split(":")[0].toLowerCase())}))),g.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then((function(e){_.executionQueuesEnabled=!e}))),Promise.all(g).then((function(){s.serviceUrl&&p&&s.createSession(),s.logOperation(a,!0)})).catch((function(e){s.logOperation(a,!1,"Error",e?e.message:"(no error)")}))},e.prototype.getServiceProtocol=function(){return this.serviceProtocol},e.prototype.registerSchemas=function(e,t){return Promise.resolve()},e.prototype.registerSimpleLocalWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),t.source=t.source||c.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,n)},e.prototype.registerSimpleRemoteWorkflow=function(e,t,n,o,r){void 0===r&&(r=this.defaultWorkflowOptions);var s=[];return t&&(t.source=c.LambdaSource.Custom,s.push(t)),n.source=n.func?c.LambdaSource.Custom:c.LambdaSource.Remote,s.push(n),o&&(o.source=c.LambdaSource.Custom,s.push(o)),this.registerHardcodedWorkflow(e,s,this.inputSchemasToWorkflows,r)},e.prototype.registerMultipleLambdasWorkflow=function(e,t,n){return void 0===n&&(n=this.defaultWorkflowOptions),this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,n)},e.prototype.registerReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,n),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||c.LambdaSource.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,r)},e.prototype.registerMultipleLambdasReduceWorkflow=function(e,t,n,o,r){return void 0===o&&(o=10),void 0===r&&(r=this.defaultWorkflowOptions),this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,n),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,r)},e.prototype.registerLocalWorkflow=function(e){this.getSession().registerLocalWorkflow(e)},e.prototype.activateAnnotation=function(e,t){return this.getSession().activateAnnotation(e,t)},e.prototype.updateAnnotationConfig=function(e,t){this.getSession().updateAnnotationConfig(e,t)},e.prototype.releaseAnnotation=function(e){return this.getSession().releaseAnnotation(e)},e.prototype.setAnnotationState=function(e,t,n){this.getSession().setAnnotationState(e,t,n)},e.prototype.submit=function(e,t,n){this.submitToWorkflows(e,t,n,this.inputSchemasToWorkflows)},e.prototype.submitOperation=function(e,t){this.getSession().submitOperation(e,t)},e.prototype.submitOperations=function(e,t){this.getSession().submitOperations(e,t)},e.prototype.submitCustomMessage=function(e){return this.getSession().submitCustomMessage(e)},e.prototype.submitSeedOperations=function(e,t){this.getSession().submitSeedOperations(e,t)},e.prototype.submitSeedGroupOperations=function(e,t,n){this.getSession().submitSeedGroupOperations(e,t,n)},e.prototype.flushTelemetry=function(e){i.Log.flushAggregators(e)},e.prototype.requestCacheDump=function(e){return this.getSession().requestCacheDump(e)},e.prototype.forceReconnectSession=function(){return this.getSession().forceReconnect()},e.prototype.setSessionCloseCallback=function(e){this.getSession().setSessionCloseCallback(e)},e.prototype.closeSession=function(){this.getSession().close()},e.prototype.createSession=function(e){var t=e?e.docSessionId:void 0,n=this.sessionsByDocSessionId.get(t);if(n&&!1===n.isClosed)throw new Error("docSessionId already exists");var r=o({},this.clientMetadata);r.docSessionId=t,e&&e.flights&&(r.flights=r.flights?r.flights+";"+e.flights:e.flights);var s=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(r),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:r});return this.sessionsByDocSessionId.set(t,s),e&&e.onSessionConnect&&s.setConnectCallback(e.onSessionConnect),e&&e.onSessionDisconnect&&s.setDisconnectCallback(e.onSessionDisconnect),e&&e.onSessionReconnect&&s.setReconnectCallback(e.onSessionReconnect),e&&e.onSessionClose&&s.setSessionCloseCallback(e.onSessionClose),s.initialize?s.initialize():Promise.resolve(s)},e.prototype.getSession=function(e){return this.sessionsByDocSessionId.get(e)},e.prototype.createDefaultSessionManagerFactory=function(){var e=this;return function(t){var n=new w.TokenRefreshManager,o=new b.SessionStats,r=function(){i.Log.error(594113806,i.LogCategory.CoreDefault,"Unexpectedly not set sendMessage")},s=new C.SessionInitializer((function(){return o}),t,n,(function(e,t){r(e,t)}),{getAuthToken:e.getAuthToken.bind(e),overrideSessionInitMessage:e.hostCallbacks.overrideSessionInitMessage}),a=new g.WebSocketSessionManager(T.Utils.convertServiceUrlToWebSocket(e.serviceUrl),o,e.workerFactory,s,t);return r=a.sendMessage.bind(a),a.on("disconnect",(function(){return n.clearTimeouts()})),a.on("connect",(function(t,n,o,r){t&&e.hostCallbacks.setSessionData&&e.hostCallbacks.setSessionData(n,o,r)})),a}},e.prototype.getAuthToken=function(){return this.hostCallbacks.requestAuthToken({Tickets:[]}).then((function(e){if(e)return e.Token})).catch((function(){}))},e.prototype.getGroupingKey=function(e,t,n){var o=this.reduceWorkflowsGroupingKeyExtractors.get(n);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)},e.prototype.submitToWorkflows=function(e,n,o,r){var s=this;if(void 0===r&&(r=this.inputSchemasToWorkflows),this.hostCallbacks){var c;c=o?i.CorrelationVector.fromString(o):new i.CorrelationVector,this.handleTileRefresh(e,n,c);for(var u=r.get(e)||[],l=function(o){if(k(e,n)&&!o.triggerOnRefresh)return"continue";var u={messageType:a.MessageType.Input,correlationVector:c.newChild(),payload:n,payloadSchema:t.getTypeFromSchema(o.lambdas[0].inputSchema),clientMetadata:p.clientMetadata},l=new i.Operation({cv:u.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:o.name});l.start(),o.scheduleExecution(n,(function(){try{if(u.payload&&u.payload.tile&&u.payload.tile.metadata&&u.payload.tile.metadata.tileId){var t=u.payload.tile.metadata.tileId;s.throttling.execute(t,o,(function(){return s.executeWorkflow(l,u,n,o,e,r)}))}else s.executeWorkflow(l,u,n,o,e,r)}catch(e){l.success=!1,l.resultSignature="ExecuteException",l.resultDescription=e?e.message:"(no error)",i.Log.error(594364430,i.LogCategory.CoreDefault,l.stop())}}))},p=this,h=0,f=u;h<f.length;h++){l(f[h])}}},e.prototype.handleTileRefresh=function(e,t,n){var o=this;if(k(e,t)){var r=function(e,t){return M(e,t)?t.tile.metadata.seqnoCLPRefresh:(O(e,t),-1)}(e,t);if(!(r<=this.lastTileRefreshSeq)){var s=new i.Operation({cv:n.toString(),operationName:"TileRefresh",resultDescription:""});s.start(),this.inputSchemasToReduceWorkflows.forEach((function(e,t){e.some((function(e){return e.triggerOnRefresh}))&&(o.resultCache.clear(t),o.resultCache.clear(o.getForcedDocLevelSchema(t)),o.reduceTimerCache.clear(t),e.some((function(e){return!e.triggerOnRefresh}))&&(s.resultDescription+="X_"),s.resultDescription+=t+" ")})),this.clearRemoteLambdaTokenCache();var a=[];this.inputSchemasToWorkflows.forEach((function(e){return a.push.apply(a,e)})),this.inputSchemasToReduceWorkflows.forEach((function(e){return a.push.apply(a,e)}));for(var c=0,u=a;c<u.length;c++){u[c].onRefresh()}this.lastTileRefreshSeq=r,i.Log.info(587563408,i.LogCategory.CoreDefault,s.stop())}}},e.prototype.executeWorkflow=function(e,t,n,o,r,c){var u=this,l=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,p=this.lastTileRefreshSeq,h=function(t){if(o.triggerOnRefresh&&u.lastTileRefreshSeq!==p)return e.success=!0,e.resultSignature="TileRefreshIgnore",void i.Log.info(589309539,i.LogCategory.CoreDefault,e.stop());var h=t.messageType==a.MessageType.Exception&&t.payload.exceptionType==a.ExceptionType.NoOutput,f=h&&o.canProduceNullResult,d=f?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,g=f?null:t.payload;t.messageType===a.MessageType.Input||f?(o.shouldSendResultsToHost&&(c===u.inputSchemasToReduceWorkflows?u.hostCallbacks.onResult("Reduce.Input",n,d,g):u.hostCallbacks.onResult(r,n,d,g)),e.success=!0,e.resultSignature=h?"NoOutput":"ValidOutput"):h?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=s.getMessageExceptionDescription(t)),c!==u.inputSchemasToReduceWorkflows&&u.updateResultCacheForReduceWorkflows(r,n,d,g,t.correlationVector.toString()),t.moreResults||(e.stop(),i.Log.info(594364432,i.LogCategory.CoreDefault,e),o.onFinish(l,t.payload&&t.payload.exceptionType?s.getMessageExceptionType(t):void 0))};o.preExecutionPromise.then((function(){for(var e={lookupTable:u.lookupTableCache.get(o.name),docId:l},n=h,r=o.lambdas.length-1;r>=0;r--)n=u.createLambdaExecutionStep(o.name,o.lambdas[r],e,n,h);n(t)}))},e.prototype.getForcedDocLevelSchema=function(e){return"~"+e},e.prototype.updateResultCacheForReduceWorkflows=function(e,t,n,o,r){var s,c=this;this.inputSchemasToReduceWorkflows.get(n)&&("docId"===e?(s=this.getGroupingKey(e,t,n),this.resultCache.setResult(this.getForcedDocLevelSchema(n),s,o),s.secondary="*"):(s=this.getGroupingKey(e,t,n),!function(e,t){return"Tiling.TextTileEvent"===e&&t&&t.type==a.Tiling.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==a.Ppt.SlideTileEventType.Delete}(e,t)||null==s.primary||null==s.secondary?this.resultCache.setResult(n,s,o):this.resultCache.clear(void 0,s)),this.reduceTimerCache.setReduceTimer(n,s.primary,(function(){var e=c.resultCache.getResults(n,s);if(e.push.apply(e,c.resultCache.getResults(c.getForcedDocLevelSchema(n),{primary:s.primary})),Array.isArray(e)){var t={id:s.primary,values:e};c.submitToWorkflows(n,t,r,c.inputSchemasToReduceWorkflows)}else i.Log.error(594364431,i.LogCategory.CoreDefault,'Cached results have unexpected type "'+typeof e+'"')})))},e.prototype.isFeatureEnabled=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n="None"),this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,n).catch((function(){return Promise.resolve(t)})):Promise.resolve(t)},e.prototype.areLicenseFeaturesEnabled=function(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch((function(){return Promise.resolve(!1)})):Promise.resolve(!1)},e.prototype.isWorkflowEnabled=function(e,t,n,o,r){var s=this;if(t.some((function(e){return e.source===c.LambdaSource.Remote}))){if(!this.serviceUrl)return r.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some((function(e){return e.source===c.LambdaSource.Remote&&!e.canRunInPrivateMode})))return r.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,r.resultDescription="Enabled by default due to platform name"),(o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e)).then((function(t){return t?s.isFeatureEnabled("WorkflowDisabled."+e).then((function(e){return e?(r.resultDescription="Disabled because explicitly disabled",!1):!n||s.areLicenseFeaturesEnabled(n).then((function(e){return e||(r.resultDescription="Disabled because license check failed"),e}))})):(r.resultDescription="Disabled because not explicitly enabled",!1)}))},e.prototype.registerHardcodedWorkflow=function(e,n,o,r){var s=this;if(void 0===o&&(o=this.inputSchemasToWorkflows),!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");o.forEach((function(t){if(t.some((function(t){return t.name===e})))throw new Error("Workflow name already registered.")}));var c=new i.Operation({operationName:"WorkflowRegistration",resourceId:e,success:!0});return c.setClientMetadata(this.clientMetadata),c.start(),this.isWorkflowEnabled(e,n,r.licenseFeatures,r.enabledByDefault,c).then((function(u){if(c.resultSignature=u?"Enabled":"Disabled",c.stop(),i.Log.info(594364433,i.LogCategory.CoreDefault,c),u){var l=n[0].inputSchema,p=o.get(l);p||(p=[],o.set(l,p));var h=Promise.resolve();r.lookupTableLambda&&(h=new Promise((function(n,o){var c=new i.CorrelationVector,u={messageType:a.MessageType.Input,correlationVector:c,payloadSchema:t.getTypeFromSchema(r.lookupTableLambda.inputSchema),clientMetadata:s.clientMetadata,payload:{}},l=function(t){t.messageType===a.MessageType.Input&&t.payload&&s.lookupTableCache.set(e,t.payload),n()};s.createLambdaExecutionStep("",r.lookupTableLambda,{},l,l)(u)})));var f=new _;f.name=e,f.lambdas=n,f.canProduceNullResult=r.canProduceNullResult,f.shouldSendResultsToHost=r.shouldSendResultsToHost,f.triggerOnRefresh=r.triggerOnRefresh,f.throttleSettings=r.throttleSettings||s.defaultWorkflowOptions.throttleSettings,f.docIdExtractor=r.docIdExtractor,f.preExecutionPromise=h,p.push(f)}}))},e.prototype.logOperation=function(e,t,n,o){e.stop(),e.success=t,e.resultSignature=n,e.resultDescription=o,i.Log.info(594364434,i.LogCategory.CoreDefault,e)},e.prototype.handleLambdaError=function(e,t,n,o,r){null!=e.exceptionType?s.setMessageException(t,e):e instanceof Error?s.setMessageException(t,{exceptionType:o,message:e.message}):s.setMessageException(t,{exceptionType:a.ExceptionType.Unknown,message:e?e.toString():void 0}),this.logOperation(n,!1,"Exception",s.getMessageExceptionDescription(t)),r(t)},e.prototype.handleLambdaOutput=function(e,n,o,r,i,c){e&&e.exceptionType!==a.ExceptionType.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,n,o,e.exceptionType,c):e instanceof Error?this.handleLambdaError(e,n,o,a.ExceptionType.LambdaErrorCallback,c):(n.payload=e,n.payloadSchema=t.getTypeFromSchema(r),this.logOperation(o,!0),i(n)):(s.setMessageException(n,{exceptionType:a.ExceptionType.NoOutput}),this.logOperation(o,!0,"NoOutput"),c(n))},e.prototype.executeCustomLambdaStep=function(e,t,n,o,r,i){var c=this;if(null==n.func)s.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),i(e);else{try{n.func(e.payload,n.config,o,(function(o){c.handleLambdaOutput(o,e,t,n.outputSchema,r,i)}),(function(n,o){c.handleLambdaOutput(n,e,t,o,i,i)}))}catch(n){this.handleLambdaError(n,e,t,a.ExceptionType.LambdaThrow,i)}}},e.prototype.executeLocalLambdaStep=function(e,t,n,o,r){var i=this;null==this.hostCallbacks.executeLocalLambda?(s.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",s.getMessageExceptionDescription(e)),r(e)):this.hostCallbacks.executeLocalLambda(n.inputSchema,e.payload,n.outputSchema).then((function(s){i.handleLambdaOutput(s,e,t,n.outputSchema,o,r)})).catch((function(n){i.handleLambdaError(n,e,t,a.ExceptionType.LambdaThrow,r)}))},e.prototype.executeRemoteLambdaStep=function(e,n,o,r,i,u){var l=this;if(this.serviceUrl){n.resourceId+="."+this.serviceProtocol;var p=function(t,r){t?l.handleLambdaError(t,e,n,t.exceptionType||a.ExceptionType.LambdaErrorCallback,u):l.handleLambdaOutput(r,e,n,o.outputSchema,i,u)};if(r.authTickets=o.authTickets,o.source===c.LambdaSource.Remote)this.executeRemoteLambda(this.serviceUrl,e,t.getTypeFromSchema(o.inputSchema),t.getTypeFromSchema(o.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,r,p);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new m.BatchManager((function(e,n,o){var r=n.context,s=r.remoteLambda,i=r.lambdaContext;l.executeRemoteLambda(l.serviceUrl,{messageType:a.MessageType.Input,correlationVector:{id:n.cv},payload:e,payloadSchema:t.getTypeFromSchema(s.inputSchema),clientMetadata:l.clientMetadata},t.getTypeFromSchema(s.remoteInputSchema),t.getTypeFromSchema(s.remoteOutputSchema),{id:n.cv},l.clientMetadata,l.hostCallbacks,i,o)}),(function(e,t,n){var o=n.lambdaContext;l.updateResultCacheForReduceWorkflows("docId",o.docId,e,t)})));var h=o.batchOptions,f=this.normalizeBatchOptions(h),d=f.groupingKeyExtractor;f.groupingKeyExtractor=function(e){return o.name+"-"+d(e)};var g={name:o.name,remoteLambda:o,lambdaContext:r};this.batchedRemoteLambdaManager.addBatchItem(e.payload,f,g,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,p)}}else s.setMessageException(e,{exceptionType:a.ExceptionType.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(n,!1,"Error",s.getMessageExceptionDescription(e)),u(e)},e.prototype.createLambdaExecutionStep=function(e,t,n,o,r){var u=this;return function(l){var p=new i.Operation({cv:l.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});p.start(),t.source===c.LambdaSource.Custom?u.executeCustomLambdaStep(l,p,t,n,o,r):t.source===c.LambdaSource.Local?u.executeLocalLambdaStep(l,p,t,o,r):t.source===c.LambdaSource.Remote||t.source===c.LambdaSource.BatchedRemote?u.executeRemoteLambdaStep(l,p,t,n,o,r):(s.setMessageException(l,{exceptionType:a.ExceptionType.LambdaThrow,message:"Unknown/No lambda location set"}),u.logOperation(p,!1,"Error",s.getMessageExceptionDescription(l)),r(l))}},e.prototype.normalizeBatchOptions=function(e){if(!e)throw new Error("Expected batchConfig");var t=o({},e);return e.estimateSize||(t.estimateSize=v.estimateSize),t},e}();t.ClientRuntime=A,t.runtime=new A,t.createRuntime=function(){return new A}},15167:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserType=t.AuthTokenType=void 0,function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacAutoClpUserInfo=8]="WacAutoClpUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege"}(t.AuthTokenType||(t.AuthTokenType={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(t.UserType||(t.UserType={}))},15168:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isLogicalCondition=t.isComparisonCondition=t.isArrayCondition=void 0;var o=n(10628),r=n(10629),s=n(10630);t.isArrayCondition=function(e){return e.operator in o.arrayOperators},t.isComparisonCondition=function(e){return e.operator in r.comparisonOperators},t.isLogicalCondition=function(e){return e.operator in s.logicalOperators}},15169:function(e,t,n){"use strict";var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,r++)o[r]=s[i];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.getTypesFromLambdas=t.functionReviver=t.functionReplacer=void 0;var r=function(e,t,n){var r=this;this.reviver=function(e,t){if("string"==typeof t){var n=t.match(/function[^\(]*\(([^\)]*)\)\s*{([\w\W]*?)}$/)||t.match(/\(([^\)]*)\)\s*=>\s*{([\w\W]*?)}$/);if(n){var s=n[1].split(",").map((function(e){return e.replace(/\s+/,"")})),i=r.functionName?n[2].concat("//# sourceURL="+r.functionName+".js"):n[2];return r.debuggable&&(i="debugger;".concat(i)),r.dependencyArguments&&(s=s.concat(Array.from(r.dependencyArguments))),Function.apply(void 0,o(s,[i]))}}return t},this.functionName=e,this.debuggable=n,this.dependencyArguments=t};t.functionReplacer=function(e,t){return"function"==typeof t?t.toString():t},t.functionReviver=function(e,t,n){return void 0===t&&(t=null),void 0===n&&(n=!1),new r(e,t,n).reviver},t.getTypesFromLambdas=function(e){for(var t=[],n=0,o=e;n<o.length;n++){var r=o[n];r.inputSchema&&t.push(r.inputSchema),r.outputSchema&&t.push(r.outputSchema),r.configSchema&&t.push(r.configSchema)}return t}},15170:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvironmentNameTranslation=t.Environment=void 0,function(e){e.dev="dev",e.int="int",e.test="test",e.dogfood="dogfood",e.prod="prod",e.gcc="gcc",e.dod="dod",e.gccHigh="gcchigh"}(t.Environment||(t.Environment={})),t.EnvironmentNameTranslation={gcc:"fairfax"}},15171:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingLevel=void 0,function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug"}(t.LoggingLevel||(t.LoggingLevel={}))},15172:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isStopWorkflowMessage=t.setStopAndFilterWorkflowMessage=t.isExceptionMessage=t.setMessageException=t.getMessageExceptionType=t.getMessageExceptionDescription=t.filterWorkflowSchema=t.exceptionSchema=void 0;var o=n(5492);t.exceptionSchema={category:o.TypeCategory.Schema,schema:{name:"Exception",path:"message-schema.proto"}},t.filterWorkflowSchema={category:o.TypeCategory.Schema,schema:{name:"Filter",path:"message-schema.proto"}},t.getMessageExceptionDescription=function(e,t){if(void 0===t&&(t=!1),null==e)return"Invalid message passed";if(null==e.payload)return o.ExceptionType[o.ExceptionType.NoOutput]+": Payload is null";if(null==e.payload.exceptionType)return"Payload is not an exception";var n=o.ExceptionType[e.payload.exceptionType];return n+=e.payload.message?": "+e.payload.message:": No description",n+=t&&e.payload.data?"\n"+e.payload.data.toString():""},t.getMessageExceptionType=function(e){return null==e||null==e.payload||null==e.payload.exceptionType?o.ExceptionType.Unknown:e.payload.exceptionType},t.setMessageException=function(e,n){if(null==e)throw new Error("Cannot set exception on null message");e.payload=n,e.payloadSchema=t.exceptionSchema,e.messageType=o.MessageType.Exception},t.isExceptionMessage=function(e){return null==e||null==e.messageType||e.messageType==o.MessageType.Exception},t.setStopAndFilterWorkflowMessage=function(e,n){if(null==e)throw new Error("Cannot set filter on null message");var r={condition:n};e.payload=r,e.payloadSchema=t.filterWorkflowSchema,e.messageType=o.MessageType.StopAndFilterWorkflow},t.isStopWorkflowMessage=function(e){return(e||{}).messageType==o.MessageType.StopAndFilterWorkflow}},15173:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityProvider=void 0,function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(t.IdentityProvider||(t.IdentityProvider={}))},15174:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WaitOnStrategy=void 0,function(e){e[e.All=0]="All",e[e.Any=1]="Any"}(t.WaitOnStrategy||(t.WaitOnStrategy={}))},15175:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExceptionType=t.MessageType=void 0,function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(t.MessageType||(t.MessageType={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(t.ExceptionType||(t.ExceptionType={}))},15176:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Oart=void 0,function(e){!function(e){e[e.shape=0]="shape",e[e.groupShape=1]="groupShape",e[e.graphicFrame=2]="graphicFrame",e[e.connector=3]="connector",e[e.picture=4]="picture",e[e.ink=5]="ink"}(e.DrawingElementType||(e.DrawingElementType={}))}(t.Oart||(t.Oart={}))},15177:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Ppt=void 0,function(e){!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.SlideTileEventType||(e.SlideTileEventType={}))}(t.Ppt||(t.Ppt={}))},15178:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JobState=void 0,function(e){e[e.Submitted=0]="Submitted",e[e.Pending=1]="Pending",e[e.Running=2]="Running",e[e.Completed=3]="Completed",e[e.Failed=4]="Failed",e[e.Aborted=5]="Aborted"}(t.JobState||(t.JobState={}))},15179:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tiling=void 0,function(e){!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(e.TextTileEventType||(e.TextTileEventType={}))}(t.Tiling||(t.Tiling={}))},15180:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypeCategory=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(t.TypeCategory||(t.TypeCategory={}))},15181:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SerializationProfile=t.Pattern=void 0,function(e){e[e.PubSub=0]="PubSub",e[e.RequestReply=1]="RequestReply"}(t.Pattern||(t.Pattern={})),function(e){e[e.JSONB=0]="JSONB",e[e.JSON=1]="JSON",e[e.JSOND=2]="JSOND",e[e.Disabled=3]="Disabled",e[e.COMPRESSEDJSON=4]="COMPRESSEDJSON"}(t.SerializationProfile||(t.SerializationProfile={}))},15182:function(e,t,n){"use strict";var o=this&&this.__assign||function(){return(o=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.elementTypeFrom=t.arrayTypeFrom=t.isArrayType=t.schemaRefToString=t.typeToString=t.areTypesEqual=t.isTypePrimitive=t.MessageSchema=t.TypeSchema=t.FunctionType=t.BufferType=t.StringType=t.NumberType=t.BooleanType=t.UndefinedType=void 0;var r=n(5492);t.UndefinedType={category:r.TypeCategory.Undefined},t.BooleanType={category:r.TypeCategory.Boolean},t.NumberType={category:r.TypeCategory.Number},t.StringType={category:r.TypeCategory.String},t.BufferType={category:r.TypeCategory.Buffer},t.FunctionType={category:r.TypeCategory.Function},t.TypeSchema={category:r.TypeCategory.Schema,schema:{name:"Type",path:"type-schema.proto"}},t.MessageSchema={category:r.TypeCategory.Schema,schema:{name:"BufferMessage",path:"message-schema.proto"}},t.isTypePrimitive=function(e){if(null==e)return!1;switch(e.category){case r.TypeCategory.Boolean:case r.TypeCategory.Number:case r.TypeCategory.String:return!0;default:return!1}};t.areTypesEqual=function(e,n){return t.typeToString(e)===t.typeToString(n)},t.typeToString=function(e){if(void 0===e)return"";if(null===e)return"null";var t,n=Object.keys(e).sort().map((function(t){return i(t,e[t])})).filter((function(e){return!!e}));return t="{".concat(n.join(",")).concat("}"),Number(t),t};var s=function(e){if(void 0===e)return"";if(null===e)return"null";var t=Object.keys(e).sort().map((function(t){return i(t,e[t])})).filter((function(e){return!!e}));return"{".concat(t.join(",")).concat("}")},i=function(e,t){return"schema"===e?'"'+e+'":'+s(t):"path"===e?"":"nestedArrayLevel"===e?t?'"'+e+'":'+t:"":void 0===t?"":"string"==typeof t?'"'+e+'":"'+t+'"':'"'+e+'":'+t};t.schemaRefToString=s,t.isArrayType=function(e){return!!e&&e.nestedArrayLevel>0},t.arrayTypeFrom=function(e){var n=o({},e);return n.nestedArrayLevel=t.isArrayType(e)?e.nestedArrayLevel+1:1,n},t.elementTypeFrom=function(e){var n=o({},e);return n.nestedArrayLevel=t.isArrayType(e)?e.nestedArrayLevel-1:0,n}},15183:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WorkflowKind=void 0,function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid"}(t.WorkflowKind||(t.WorkflowKind={}))},15184:function(e,t,n){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),t.gatewayType=t.matchmakerType=t.executeOnStopWorkflow=t.isBuiltInLambda=t.BuiltInLambdaType=void 0,function(e){e.Expression="Expression",e.MessageOutput="MessageOutput",e.Edge="Edge",e.EnterWorkflow="EnterWorkflow",e.ExitWorkflow="ExitWorkflow",e.Join="Join",e.SerializePayload="SerializePayload",e.DeserializePayload="DeserializePayload",e.Inline="Inline"}(o=t.BuiltInLambdaType||(t.BuiltInLambdaType={})),t.isBuiltInLambda=function(e){return!!o[e]},t.executeOnStopWorkflow=function(e){return t.isBuiltInLambda(e)&&e!=o.Inline||e==t.matchmakerType},t.matchmakerType="Matchmaker",t.gatewayType="Gateway"},15185:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CorrelationVector=void 0;var o=function(){function e(e){this.childCount=0,this.id=e||function(){for(var e=0;e<s;e++)i[e]=r[Math.floor(Math.random()*r.length)];return i.join("")}()}return e.fromString=function(t,n){if(!t)throw new Error("Received invalid correlation vector string");var o;return o=-1===t.indexOf(".0",t.length-2)?new e(t):new e(t.substring(0,t.length-2)),n&&(o.childCount=n),o},e.prototype.newChild=function(){return++this.childCount,new e(this.id+"."+this.childCount.toString())},e.prototype.toString=function(){return this.id.length>127?this.id.substr(0,127)+"!":this.id},e}();t.CorrelationVector=o;var r=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],s=22,i=new Array(s)},15186:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.LogCategory=t.Log=void 0;var o,r,s=n(6877),i=void 0!==e&&e.env?e.env.SERVICE_NAME:"client",a="abcdefghijklmnopqrstuvwxyz0123456789",c={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35},u=[],l=new Map,p=new Map,h=new Map;!function(e){e.defineCoreLogCategory=function(e){return{root:"Core",name:e}},e.defineWorkflowLogCategory=function(e){return{root:"Workflow",name:e}},e.clearLoggers=function(){u=[],p.clear()},e.addLogger=function(e){u.push(e),Object.keys(s.LoggingLevel).map((function(e){return s.LoggingLevel[e]})).filter((function(t){return t<=e.level})).forEach((function(t){p.has(t)?p.get(t).push(e):p.set(t,[e])}))},e.setCorrelationContextCallback=function(e){o=e},e.addAggregator=function(e){e.init((function(e,t){y(e,t)})),l.set(e.eventName,e)},e.flushAggregators=function(e){l.forEach((function(t){t.flush(e)}))},e.setTagLevelOverride=function(e,t){var n=v(e);h.set(n,t)},e.resetTagLevelOverrides=function(){h.clear()},e.error=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];g(e,t,s.LoggingLevel.error,n)},e.warn=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];g(e,t,s.LoggingLevel.warn,n)},e.info=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];g(e,t,s.LoggingLevel.info,n)},e.verbose=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];g(e,t,s.LoggingLevel.verbose,n)},e.debug=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];g(e,t,s.LoggingLevel.debug,n)},e.metric=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];g(e,t,s.LoggingLevel.metric,n)},e.dynamic=function(e){y(e)}}(r=t.Log||(t.Log={}));var f=function(e){return e.map((function(e){return e instanceof Error?JSON.stringify({message:e.message,name:e.name,stack:e.stack}):"object"==typeof e?JSON.stringify(e):e})).join(" ")},d=function(e){return void 0!==e?p.get(e)||[]:u},g=function(e,t,n,o){n=h.get(e)||n;var r=d(n);if(0!=r.length){var s=m(e),i=function(e){return e.map((function(e){return"function"==typeof e?e():e}))}(o);if(1==i.length&&"object"==typeof i[0]){var a=i[0];a.tagId=s,"Operation"===a.eventName&&"Workflow"===t.root&&(a.eventName="WorkflowOperation"),a.traceLevel=n;var c=l.get(a.eventName);c?c.add(a):y(a,!1,r)}else y({eventName:"Log",tagId:s,category:t.root+"."+t.name,traceLevel:n,message:f(i)},!1,r)}},y=function(e,t,n){var r,s,a;if(void 0===t&&(t=!1),null==n&&(n=d(e.traceLevel)),n.length>0){if(e.serviceName=i,!t&&o){var c=o();if(c){e.cv=e.cv?e.cv:c.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:c.sessionKey,e.workflow=e.workflow?e.workflow:c.workflow;var u=null===(r=c.clientMetadata)||void 0===r?void 0:r.appName;e.clientAppName=e.clientAppName?e.clientAppName:u;var l=null===(s=c.clientMetadata)||void 0===s?void 0:s.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:l;var p=null===(a=c.clientMetadata)||void 0===a?void 0:a.releaseAudienceGroup;e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:p}}for(var h=0,f=n;h<f.length;h++){f[h].log(e)}}},m=function(e){return a[e>>24&63]+a[e>>18&63]+a[e>>12&63]+a[e>>6&63]+a[e>>0&63]},v=function(e){return e&&5===e.length?c[e.charCodeAt(0)]<<24|c[e.charCodeAt(1)]<<18|c[e.charCodeAt(2)]<<12|c[e.charCodeAt(3)]<<6|c[e.charCodeAt(4)]:-1},S=function(){function e(){}return e.CoreDefault=r.defineCoreLogCategory("Default"),e.WorkflowDefault=r.defineWorkflowLogCategory("Default"),e}();t.LogCategory=S}).call(this,n(136))},15187:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoggingAggregator=void 0;var o="|",r="b~",s="b~true",i="n~",a=/\|\~/g,c="_",u=function(){this.count=0,this.measureSums=new Map},l=function(e,t,n,l,p){var h=this;this.buckets=new Map,this.init=function(e){h.log=e},this.add=function(e){if(h.condition&&h.condition(e)){for(var t=[],n=0,s=h.dimensions;n<s.length;n++){var l=s[n];if(void 0===e[l])t.push(null);else{var p="";"boolean"==typeof e[l]?p=r:"number"==typeof e[l]&&(p=i),t.push(""+p+e[l].toString().replace(a,c))}}var f=t.join(o),d=h.buckets.get(f);if(!d){(d=new u).traceLevel=e.traceLevel;for(var g=0,y=h.avgMeasures;g<y.length;g++){var m=y[g];d.measureSums.set(m,0)}h.buckets.set(f,d)}d.count++;for(var v=0,S=h.avgMeasures;v<S.length;v++)e[m=S[v]]&&d.measureSums.set(m,d.measureSums.get(m)+e[m])}else h.log(e,!1)},this.flush=function(e){void 0===e&&(e=!1),h.buckets.forEach((function(e,t){for(var n={traceLevel:e.traceLevel,eventName:h.eventName,count:e.count},a=t.split(o),c=0;c<h.dimensions.length;c++){var u=h.dimensions[c],l=a[c];0===l.indexOf(r)?n[u]=l===s:0===l.indexOf(i)?n[u]=parseInt(l.slice(i.length),10):n[u]=l}for(var p=0,f=h.avgMeasures;p<f.length;p++){var d=f[p];n[d]=Math.round(e.measureSums.get(d)/e.count)}h.log(n,!0)})),h.buckets.clear(),e&&(h.condition=null,clearInterval(h.interval))},this.eventName=e,this.condition=t,this.dimensions=n,this.avgMeasures=l,p>0&&(this.interval=setInterval(this.flush,1e3*p))};t.LoggingAggregator=l},15188:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.Operation=void 0;var s=n(15189),i=n(10631),a=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.eventName="Operation",t&&null!=t.count||(r.count=1),n&&r.setClientMetadata(n),o&&r.setUserContext(o),r}return r(t,e),t.prototype.setClientMetadata=function(e){e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDeviceId=e.deviceId)},t.prototype.setUserContext=function(e){e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString())},t.prototype.start=function(){return this.startTime=i.now(),this},t.prototype.stop=function(){var e=i.now();return this.durationMs=Math.round(e-this.startTime),this},t}(s.OperationEvent);t.Operation=a},15189:function(e,t){var n={util:{},roots:{default:{}}},o=(n.util,n.roots.default||(n.roots.default={}));o.OperationEvent=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.userType="",e.prototype.userId="",e}(),e.exports=o},15190:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.executeRemoteLambda=t.clearTokenCache=void 0;var o,r=n(3521),s=n(5492),i=n(15191),a=n(10633);t.clearTokenCache=function(){o=new a.TokenCache},t.clearTokenCache();var c=function(e,t,n,a,u,l,p,h,f,d){var g={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":u},body:JSON.stringify({payload:t.payload,payloadSchema:n,requestedSchema:a,clientMetadata:l,tokens:o.getAuthTokenEntries(p,f.docId)})};i.internalFetch(e,g,(function(i,g){i?d(new Error("Fetch error in remote lambda request to "+e+": "+i)):401===g.status?h>0?(r.Log.info(595915806,r.LogCategory.CoreDefault,"Auth token required for remote lambda request"),g.json().then((function(e){return o.updateAuthToken(p,{Tickets:[e],DocId:f.docId})})).then((function(){c(e,t,n,a,u,l,p,h-1,f,d)})).catch((function(e){d({exceptionType:s.ExceptionType.Authentication,message:e.message})}))):d({exceptionType:s.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"}):g.ok?g.json().then((function(e){if(Array.isArray(e))if(e.length>0)for(var n=0,o=0,r=e;o<r.length;o++){var s=r[o];t.moreResults=++n<e.length,d(null,s)}else d(new Error("No output"));else d(new Error("Did not receive a valid response for remote lambda request"))})).catch((function(e){d({exceptionType:s.ExceptionType.LambdaThrow,message:e.message})})):d(new Error("Remote lambda request failed with status "+g.status))}))};t.executeRemoteLambda=function(e,t,n,r,i,a,u,l,p){Array.isArray(l.authTickets)?o.updateAuthToken(u,{Tickets:l.authTickets,DocId:l.docId}).then((function(){c(e,t,n,r,i.id,a,u,1,l,p)})).catch((function(e){p({exceptionType:s.ExceptionType.Authentication,message:e.message})})):c(e,t,n,r,i.id,a,u,1,l,p)}},15191:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.internalFetch=void 0;var o=n(15192),r=n(15193);t.internalFetch=function(e,t,n){var o=new r.Request(e,t);return s.add(o,n)};var s=new o.SequentialFetchQueue(r,2e4,12e4)},15192:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SequentialFetchQueue=void 0;var o=function(){function e(e,t,n){if(this.requestInProgress=!1,this.queuedRequests=[],null==e)throw new Error("No request.");this.fetch=e,this.fetchTimeout=t,this.queueTimeout=n}return e.prototype.tryProcessNextRequest=function(){if(this.requestInProgress=!1,this.queuedRequests.length>0){var e=this.queuedRequests.shift(),t=e[0],n=e[1],o=e[2];clearTimeout(o),this.add(t,n)}},e.prototype.add=function(e,t){var n=this;if(this.requestInProgress){var o=setTimeout((function(){t(new Error("Timed out waiting in queue"),null),n.queuedRequests.shift()}),this.queueTimeout);this.queuedRequests.push([e,t,o])}else{this.requestInProgress=!0,new Promise((function(t,o){var r=!1,s=setTimeout((function(){r=!0,o(new Error("Fetch timed out"))}),n.fetchTimeout);n.fetch(e).then((function(e){r||(clearTimeout(s),t(e))})).catch((function(e){r||(clearTimeout(s),o(e))}))})).then((function(e){t(null,e),n.tryProcessNextRequest()})).catch((function(e){t(e,null),n.tryProcessNextRequest()}))}},e}();t.SequentialFetchQueue=o},15193:function(e,t,n){var o=function(e){function t(){this.fetch=!1}return t.prototype=e,new t}("undefined"!=typeof self?self:this);(function(e){!function(e){if(!e.fetch){var t={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(t.arrayBuffer)var n=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],o=function(e){return e&&DataView.prototype.isPrototypeOf(e)},r=ArrayBuffer.isView||function(e){return e&&n.indexOf(Object.prototype.toString.call(e))>-1};l.prototype.append=function(e,t){e=a(e),t=c(t);var n=this.map[e];this.map[e]=n?n+","+t:t},l.prototype.delete=function(e){delete this.map[a(e)]},l.prototype.get=function(e){return e=a(e),this.has(e)?this.map[e]:null},l.prototype.has=function(e){return this.map.hasOwnProperty(a(e))},l.prototype.set=function(e,t){this.map[a(e)]=c(t)},l.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},l.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),u(e)},l.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},l.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),u(e)},t.iterable&&(l.prototype[Symbol.iterator]=l.prototype.entries);var s=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];y.prototype.clone=function(){return new y(this,{body:this._bodyInit})},g.call(y.prototype),g.call(v.prototype),v.prototype.clone=function(){return new v(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new l(this.headers),url:this.url})},v.error=function(){var e=new v(null,{status:0,statusText:""});return e.type="error",e};var i=[301,302,303,307,308];v.redirect=function(e,t){if(-1===i.indexOf(t))throw new RangeError("Invalid status code");return new v(null,{status:t,headers:{location:e}})},e.Headers=l,e.Request=y,e.Response=v,e.fetch=function(e,n){return new Promise((function(o,r){var s=new y(e,n),i=new XMLHttpRequest;i.onload=function(){var e,t,n={status:i.status,statusText:i.statusText,headers:(e=i.getAllResponseHeaders()||"",t=new l,e.split(/\r?\n/).forEach((function(e){var n=e.split(":"),o=n.shift().trim();if(o){var r=n.join(":").trim();t.append(o,r)}})),t)};n.url="responseURL"in i?i.responseURL:n.headers.get("X-Request-URL");var r="response"in i?i.response:i.responseText;o(new v(r,n))},i.onerror=function(){r(new TypeError("Network request failed"))},i.ontimeout=function(){r(new TypeError("Network request failed"))},i.open(s.method,s.url,!0),"include"===s.credentials&&(i.withCredentials=!0),"responseType"in i&&t.blob&&(i.responseType="blob"),s.headers.forEach((function(e,t){i.setRequestHeader(t,e)})),i.send(void 0===s._bodyInit?null:s._bodyInit)}))},e.fetch.polyfill=!0}function a(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function c(e){return"string"!=typeof e&&(e=String(e)),e}function u(e){var n={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return t.iterable&&(n[Symbol.iterator]=function(){return n}),n}function l(e){this.map={},e instanceof l?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function p(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function h(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function f(e){var t=new FileReader,n=h(t);return t.readAsArrayBuffer(e),n}function d(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function g(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(t.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(t.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(t.arrayBuffer&&t.blob&&o(e))this._bodyArrayBuffer=d(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!t.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!r(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=d(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):t.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},t.blob&&(this.blob=function(){var e=p(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?p(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(f)}),this.text=function(){var e,t,n,o=p(this);if(o)return o;if(this._bodyBlob)return e=this._bodyBlob,t=new FileReader,n=h(t),t.readAsText(e),n;if(this._bodyArrayBuffer)return Promise.resolve(function(e){for(var t=new Uint8Array(e),n=new Array(t.length),o=0;o<t.length;o++)n[o]=String.fromCharCode(t[o]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},t.formData&&(this.formData=function(){return this.text().then(m)}),this.json=function(){return this.text().then(JSON.parse)},this}function y(e,t){var n,o,r=(t=t||{}).body;if(e instanceof y){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new l(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new l(t.headers)),this.method=(n=t.method||this.method||"GET",o=n.toUpperCase(),s.indexOf(o)>-1?o:n),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function m(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),o=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(o),decodeURIComponent(r))}})),t}function v(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new l(t.headers),this.url=t.url||"",this._initBody(e)}}(void 0!==e?e:this)}).call(o,void 0);var r=o.fetch;r.Response=o.Response,r.Request=o.Request,r.Headers=o.Headers;e.exports&&(e.exports=r)},15194:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testWebSocketConnection=t.executeRemoteLambda=t.clearTokenCache=void 0;var o,r=n(3521),s=n(5492),i=n(15195),a=n(10633),c=n(10634);t.clearTokenCache=function(){o=new a.TokenCache},t.clearTokenCache();var u=new i.WebSocketRequestManager(3e4,(function(){return new c.WebSocketWorker}),50),l=function(e,t,n,i,a,c,p,h,f,d){var g={payload:t.payload,payloadSchema:n,requestedSchema:i,clientMetadata:c,tokens:o.getAuthTokenEntries(p,f.docId)},y="";i&&i.schema&&(y=i.schema.name);var m=!1;u.addRequest(e,g,a,y,(function(u,g,y){if(!m)if(m=!0,null!=g)if(g.exceptionType===s.ExceptionType.Authentication)try{var v=JSON.parse(g.data);h>0?(r.Log.info(593892171,r.LogCategory.CoreDefault,"Auth token required for remote lambda WebSocket request"),o.updateAuthToken(p,{Tickets:[v],DocId:f.docId}).then((function(){l(e,t,n,i,a,c,p,h-1,f,d)})).catch((function(e){d({exceptionType:s.ExceptionType.Authentication,message:e.message})}))):d({exceptionType:s.ExceptionType.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(e){d({exceptionType:s.ExceptionType.Authentication,message:e.message})}else d(new Error("Error in remote lambda WebSocket request to "+e+": "+g));else t.moreResults=!1,d(null,u)}))};t.executeRemoteLambda=function(e,t,n,r,i,a,c,u,p){Array.isArray(u.authTickets)?o.updateAuthToken(c,{Tickets:u.authTickets,DocId:u.docId}).then((function(){l(e,t,n,r,i.id,a,c,1,u,p)})).catch((function(e){p({exceptionType:s.ExceptionType.Authentication,message:e.message})})):l(e,t,n,r,i.id,a,c,1,u,p)},t.testWebSocketConnection=function(e,t){return u.testConnection(e,t)}},15195:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketRequestManager=void 0;var o=n(3521),r=n(5492),s=n(4630),i=function(){function e(e,t,n,o,r,s){this.requestId=e,this.correlationId=t,this.schemaName=n,this.data=o,this.callback=r,this.requestTimeoutInMs=s,this.ended=!1,this.startTime=0}return e.prototype.startRequest=function(){this.startTime=s.Utils.getCurrentTimeMs()},e.prototype.getMsUntilTimeout=function(){var e=s.Utils.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e},e.prototype.endRequest=function(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)},e.prototype.addResponseData=function(e){this.invokeCallback(e,null,!1)},e.prototype.invokeCallback=function(e,t,n){var o=this;new Promise((function(){return o.callback(e,t,n)})).catch((function(e){}))},e}(),a=function(){function e(e,t,n){this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=e,this.workerFactory=t,this.maxActiveRequests=n}return e.prototype.testConnection=function(e,t){var n=this,s=!1,i=new o.Operation({cv:(new o.CorrelationVector).toString(),operationName:"WebSocketTest",resourceId:e});return i.success=!0,i.start(),new Promise((function(a){var c={payload:{},payloadSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:r.TypeCategory.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:t};n.addRequest(e,c,i.cv,"HealthCheckRequest",(function(e,t,n){t&&(i.success=!1,i.resultSignature="Error",i.resultDescription=t.message||t),e&&"OK"===e.status&&(s=!0),n&&(i.success&&!s&&(i.success=!1,i.resultSignature="NoResponseData"),i.stop(),o.Log.info(593892170,o.LogCategory.CoreDefault,i),a(i.success))}))}))},e.prototype.addRequest=function(e,t,n,o,r){var s=(this.requestCounter++).toString(),a=new i(s,n,o,t,r,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(a),this.egressPendingRequests()},e.prototype.egressPendingRequests=function(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){var e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){var t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress(this.createRequestMessage(e.data,e.requestId,e.correlationId))}},e.prototype.createRequestMessage=function(e,t,n){return JSON.stringify({correlationId:n,requestId:t,body:e})},e.prototype.onTimeout=function(){for(;this.activeRequests.length>0;){var e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);var n=new Error("Request timed out");e.endRequest(n),this.activeRequests.shift(),this.egressPendingRequests()}},e.prototype.onMessage=function(e){try{for(var t=JSON.parse(e),n=0;n<this.activeRequests.length;n++){var r=this.activeRequests[n];if(r.requestId===t.requestId){t.end?(this.activeRequests.splice(n,1),r.endRequest(t.error),this.egressPendingRequests()):t.body&&r.addResponseData(t.body);break}}}catch(e){o.Log.error(588787978,o.LogCategory.CoreDefault,e)}},e.prototype.onClose=function(e){for(var t=new Error("Connection closed: "+e),n=0,o=this.activeRequests;n<o.length;n++){o[n].endRequest(t)}this.activeRequests=[];for(var r=0,s=this.pendingRequests;r<s.length;r++){s[r].endRequest(t)}this.pendingRequests=[],this.worker=void 0},e.prototype.getWorker=function(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),this.onClose.bind(this))),this.worker},e}();t.WebSocketRequestManager=a},15196:function(e,t,n){(function(t){var n=null;"undefined"!=typeof WebSocket?n=WebSocket:"undefined"!=typeof MozWebSocket?n=MozWebSocket:void 0!==t?n=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?n=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(n=self.WebSocket||self.MozWebSocket),e.exports=n}).call(this,n(122))},15197:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReduceTimerCache=void 0;var o=function(){function e(){this.cache=new Map}return e.prototype.setReduceTimer=function(e,t,n,o){var r=this;void 0===o&&(o=500),this.cache.has(e)||this.cache.set(e,new Map);var s=this.cache.get(e);s.has(t)&&clearTimeout(s.get(t)),s.set(t,setTimeout((function(){s.size>1?s.delete(t):r.cache.delete(e),n()}),o))},e.prototype.clear=function(e){this.cache.forEach((function(t,n){e&&e!==n||t.forEach((function(e){clearTimeout(e)}))})),this.cache.clear()},e}();t.ReduceTimerCache=o},15198:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ResultCache=void 0;var o=function(){function e(){this.cache=new Map,this.bucketSizes=new Map}return e.prototype.setBucketSize=function(e,t){this.bucketSizes.set(e,t)},e.prototype.setResult=function(e,t,n){if(t.primary){var o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));var r=o.get(t.primary);if(r||(r=t.secondary?new Map:[],o.set(t.primary,r)),t.secondary){r.set(t.secondary,n)}else{var s=r;s.length==this.getBucketSize(e)&&s.shift(),s.push(n)}}},e.prototype.getResults=function(e,t){var n=this.cache.get(e);if(n){var o=n.get(t.primary);if(o){if(!t.secondary)return o;var r=Array.from(o.values());if(r.length>0)return r}}return[]},e.prototype.clear=function(e,t){e?this.cache.delete(e):t?this.cache.forEach((function(e){if(t.secondary){var n=e.get(t.primary);n&&n.delete(t.secondary)}else e.delete(t.primary)})):this.cache.clear()},e.prototype.getBucketSize=function(e){return this.bucketSizes.get(e)||10},e}();t.ResultCache=o},15199:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TelemetryLogger=void 0;var o=n(6877),r=function(){function e(e){this.level=o.LoggingLevel.info,this.hostCallbacks=e}return e.prototype.log=function(e){var t=this;if(null!=this.hostCallbacks&&null!=this.hostCallbacks.sendTelemetryEvent){var n=function(e,n){var o=n.charAt(0).toUpperCase()+n.slice(1);t.hostCallbacks.sendTelemetryEvent(null,"Office_AugLoop_Client_"+o,{ResourceId:e.resourceId,ResultDescription:e.resultDescription,ResultSignature:e.resultSignature,Dimension0:e.dimension0,Dimension1:e.dimension1,Dimension2:e.dimension2,Dimension3:e.dimension3},"Office.System.Activity",{CV:e.cv,Duration:1e3*e.durationMs,Count:e.count,AggMode:2,Success:e.success},!1)};if("Operation"===e.eventName){n(e,e.operationName)}else if("SessionHealth"===e.eventName){n(e,e.sessionHealthEventName)}}},e}();t.TelemetryLogger=r},15200:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketSessionManager=void 0;var s=n(3521),i=n(10635),a=n(4997),c=n(3150),u=n(9184),l=n(4630),p=n(15206),h=n(15207),f=n(15208),d=function(e){function t(t,n,o,r,i){var c,u=e.call(this)||this;return u.cvParent=new s.CorrelationVector,u.logOp=new s.Operation({operationName:"SessionState",success:!0}).start(),u.sessionStateChangeLogCountLimiter=new l.LogCountLimiter("SessionState"),u.stats=n,u.allStates=((c={})[h.SessionState.Initing]=new h.InitingState(u),c[h.SessionState.Running]=new h.RunningState(u),c[h.SessionState.Disconnected]=new h.DisconnectedState(u),c[h.SessionState.Closed]=new h.ClosedState(u),c),u.setState(h.SessionState.Initing),u.messageEndpoint=new a.MessageEndpoint("c"),u.messageEndpoint.setClientMetadata(i),u.messageEndpoint.setEgress(u.egress.bind(u)),u.messageEndpoint.onMessage(a.SessionCloseMessage.getTypeName(),u.onSessionClose.bind(u)),u.webSocketWorkerManager=new f.WebSocketWorkerManager(t,o,r,u.ingress.bind(u),u.onConnectionClose.bind(u)),u.messageQueue=new p.MessageQueue({sendMessage:function(e,t,n){return u.state.sendMessage(e,t,n)},sendBytes:u.sendBytes.bind(u),canSendMessage:function(){return u.state.canSendMessage()}}),r.on("connect",(function(e,t,n,o,r){u.emit("connect",e,n,o,r),u.onSessionInitialized(e&&t)})),r.on("reconnect",(function(){return u.emit("reconnect")})),u.resetNextSyncSequenceId=function(){return u.emit("resetNextSyncSequenceId")},u}return r(t,e),t.prototype.setState=function(e,t,n){var o=this;if(!this.state||e!==this.state.stateName){var r="undefined";this.state&&(r=h.SessionState[this.state.stateName]);var i="undefined"===r&&e===h.SessionState.Initing||this.state.possibleNextStates.indexOf(e)>=0;this.sessionStateChangeLogCountLimiter.log((function(){o.logOp.stop(),o.logOp.resourceId="New state: "+(i?h.SessionState[e]:r),o.logOp.resultDescription="Previous state: "+r,o.logOp.resultSignature=t+(o.state&&!i?"Unexpected state change":""),o.logOp.success=i,s.Log.info(594551965,s.LogCategory.CoreDefault,o.logOp)})),i&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(n))}},t.prototype.init=function(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.webSocketWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)},t.prototype.sendMessage=function(e,n){this.retrySendMessage(e,n,t.maxRetries)},t.prototype.sendBytes=function(e){this.state.sendBytes(e)},t.prototype.onMessage=function(e,t){this.messageEndpoint.onMessage(e,t)},t.prototype.getCorrelationVector=function(){return this.cvParent},t.prototype.forceReconnect=function(e){return this.extensionConfigs=e||this.extensionConfigs,this.webSocketWorkerManager.close(!1),this.webSocketWorkerManager.init(this.extensionConfigs)},t.prototype.closeSession=function(){this.sendMessage(new a.SessionCloseMessage),this.webSocketWorkerManager.close(!0),this.onSessionClose(void 0,(function(){}))},t.prototype.onSessionInitialized=function(e){this.setState(h.SessionState.Running,"",{isSessionReseedingStarted:e})},t.prototype.ingress=function(e){var t,n=this;try{t=JSON.parse(e)}catch(e){s.Log.error(595886723,s.LogCategory.CoreDefault,new i.SessionHealth({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:e.message,durationMs:0,source:i.SessionHealthSource.ClientRuntime,reason:i.SessionHealthReason.Client,impact:i.SessionHealthImpact.MissingOutput,affectedWorkflows:["All"],message:""}))}t&&this.messageEndpoint.ingress(t,(function(e,t){return n.egress(e||t,(function(){}))}))},t.prototype.egress=function(e,t){e&&this.webSocketWorkerManager.egress(e).then((function(){return t()})).catch((function(e){return t(e)}))},t.prototype.onSessionClose=function(e,t){this.setState(h.SessionState.Closed),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e),t()},t.prototype.onConnectionClose=function(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=l.Utils.getCurrentTimeMs(),this.emit("disconnect",e)},t.prototype.retrySendMessage=function(e,n,o){var r=this,s=t.maxRetries-o;this.state.sendMessage(e,(function(t,s){t&&o>0&&r.canBeRetried(e)&&r.isTransientError(t)?r.retrySendMessage(e,n,o-1):n&&n(t,s)}),s)},t.prototype.canBeRetried=function(e){return!c.SchemaObject.matchesTypesFor(e,[a.SessionInitMessage.getTypeName(),a.MicroSyncMessage.getTypeName()])},t.prototype.isTransientError=function(e){var t=e.error;return t!==a.SendMessageErrorReason.SyncMessageUnsupportedBatch&&t!==a.SendMessageErrorReason.UnexpectedSeedMessage&&t!==a.SendMessageErrorReason.UnsupportedSyncMessage&&t!==a.SendMessageErrorReason.AnnotationTokenNotFound&&t!==p.ClientSendMessageErrorReason.ArrivedBeforeReseeding&&t!==p.ClientSendMessageErrorReason.DroppedAsOldestInQueue},t.maxRetries=2,t}(u.EventEmitter);t.WebSocketSessionManager=d},15201:function(e,t){var n={util:{},roots:{default:{}}},o=(n.util,n.roots.default||(n.roots.default={}));o.SessionHealthEvent=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.userType="",e.prototype.userId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e}(),e.exports=o},15202:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageEndpoint=t.extractMessageNameFromTypeName=t.ProcessMessageErrorReason=t.SendMessageErrorReason=void 0;var o,r,s=n(3521),i=n(10635),a=n(3150),c=n(10636),u=n(15203);function l(e){for(var t,n=0,o=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];n<o.length;n++){var r=o[n];if(0===e.indexOf(r)){t=r;break}}if(!t)return"MalformedMessageName";var s=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(t.length,s?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found"}(o=t.SendMessageErrorReason||(t.SendMessageErrorReason={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation."}(r=t.ProcessMessageErrorReason||(t.ProcessMessageErrorReason={})),t.extractMessageNameFromTypeName=l;var p=5e3,h=function(){function e(e){this.nextMessageId=1,this.pendingResponseCallbacks=new u.Cache({sweepInterval:p}),this.pendingMessageCallbacks=new u.Cache({sweepInterval:p}),this.messageCallbacks=new Map,this.messageIdPrefix=e,this.source="c"===e?i.SessionHealthSource.ClientRuntime:i.SessionHealthSource.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}return e.prototype.setClientMetadata=function(e){this.clientMetadata=e},e.prototype.setEgress=function(e){this.egress=e},e.prototype.ingress=function(e,t){var n=a.SchemaObject.getBaseTypesFor(e),o=a.SchemaObject.getTypeNameFor(e);o===c.Response.getTypeName()||n&&n.indexOf(c.Response.getTypeName())>=0?(this.processResponse(e),t()):this.processMessage(e,t),o===c.SessionCloseMessage.getTypeName()&&this.clearAllPendingResponses()},e.prototype.sendMessage=function(e,t,n,o){var r=this;void 0===o&&(o=0);var u=new i.SessionHealth({sessionHealthEventName:"SendMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingInput:i.SessionHealthImpact.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:l(a.SchemaObject.getTypeNameFor(e)),dimension0:o.toString()}).start(),p=function(){if(u.setClientMetadata(r.clientMetadata),u.success)s.Log.info(590485084,s.LogCategory.CoreDefault,u.stop());else{var e="ErrorWithoutPendingResponse"===u.resultSignature||"ResponseCallbackException"===u.resultSignature||"We called into done callback"!==u.message;u.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),s.Log.error(590485085,s.LogCategory.CoreDefault,u.stop())}};e.messageId=""+this.messageIdPrefix+this.nextMessageId++;var h=a.SchemaObject.getTypeNameFor(e)===c.SessionCloseMessage.getTypeName();if(!n&&!h){var f=function(n,o){var s;if(n?(u.success=!1,u.resultSignature="Error",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):(u.resultSignature="Success",u.resultDescription="Sent "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId),t)try{u.message="We called into done callback",t(n,o)}catch(e){u.success=!1,u.resultSignature="ResponseCallbackException",u.resultDescription="Web"===(null===(s=r.clientMetadata)||void 0===s?void 0:s.appPlatform)?JSON.stringify({message:e.message,stack:e.stack}):JSON.stringify({message:e.message})}r.pendingMessageCallbacks.del(e.messageId),p(),r.updateSendMessageStats(u.success,u.durationMs,n?new Error(n.error):void 0)};this.pendingResponseCallbacks.put(e.messageId,f,1e4,(function(){f(new c.TimeoutErrorResponse({error:"Timeout waiting for response"}),void 0)}))}this.egress(e,(function(t){var n,o;if(t){var s=r.pendingResponseCallbacks.get(e.messageId);s?(r.pendingResponseCallbacks.del(e.messageId),s(new c.ErrorResponse({error:t.message}))):h?(u.success=null!==(o=null===(n=t.message)||void 0===n?void 0:n.endsWith("Client disconnected."))&&void 0!==o&&o,u.resultSignature="ErrorSendingSessionCloseMessage",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,p()):(u.success=!1,u.resultSignature="ErrorWithoutPendingResponse",u.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+t.message,p())}}))},e.prototype.onMessage=function(e,t){this.messageCallbacks.set(e,t)},e.prototype.getStats=function(){return this.stats},e.prototype.hasMessageCallback=function(e){return this.messageCallbacks.has(e)},e.prototype.cancelPendingResponseCallbacks=function(){var e=this;this.pendingResponseCallbacks.forEach((function(t,n){t&&(e.pendingResponseCallbacks.del(n),t(new c.ErrorResponse({error:"Cancelled"})))}))},e.prototype.clearAllPendingResponses=function(){if(0!=this.pendingResponseCallbacks.size()){var e=new s.Operation({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size.toString(),success:!0});s.Log.info(595855050,s.LogCategory.CoreDefault,e),this.pendingResponseCallbacks.clear()}},e.prototype.processMessage=function(e,t){var n,o=this,r=new i.SessionHealth({sessionHealthEventName:"ProcessMessage",source:this.source,reason:i.SessionHealthReason.Client,impact:this.source===i.SessionHealthSource.ClientRuntime?i.SessionHealthImpact.MissingOutput:i.SessionHealthImpact.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),u=function(){if(r.setClientMetadata(o.clientMetadata),r.success)s.Log.info(590485086,s.LogCategory.CoreDefault,r.stop());else{var e="UnsupportedMessage"===r.resourceId||"Timeout"===r.resultSignature||"OnResponseInvokedMoreThanOnce"===r.resultSignature||"MessageCallbackException"===r.resultSignature||"We called into messageCallback"!==r.message;r.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),s.Log.error(590485087,s.LogCategory.CoreDefault,r.stop())}},p=this.messageCallbacks.get(a.SchemaObject.getTypeNameFor(e));p?r.resourceId=l(a.SchemaObject.getTypeNameFor(e)):p=function(t,n){r.resourceId="UnsupportedMessage",n(new c.ErrorResponse({error:"Message type "+a.SchemaObject.getTypeNameFor(e)+" is not supported"}))};this.pendingMessageCallbacks.put(e.messageId,void 0,1e4,(function(){r.success=!1,r.resultSignature="Timeout",r.resultDescription="Timeout processing message callback",u(),s.Log.error(595736336,s.LogCategory.CoreDefault,"Timeout processing "+r.resourceId),o.updateProcessMessageStats(!1,r.durationMs,new Error("timeout"))}));var h=!1;try{r.message="We called into messageCallback",p(e,(function(n,s){o.pendingMessageCallbacks.del(e.messageId),h?(r.success=!1,r.resultSignature="OnResponseInvokedMoreThanOnce",r.resultDescription="Invoked onResponse for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+" more than once"):n?(r.success=!1,r.resultSignature="Error",r.resultDescription="Error for "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId+": "+n.error):(r.resultSignature="Success",r.resultDescription="Processed "+a.SchemaObject.getTypeNameFor(e)+" message "+e.messageId),h=!0,u(),n&&!a.SchemaObject.matchesTypesFor(n,[c.ErrorResponse.getTypeName()])&&(n=new c.ErrorResponse({error:"Internal Server Error"})),o.updateProcessMessageStats(r.success,r.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):s?(s.messageId=e.messageId,t(void 0,s)):t()}))}catch(o){this.pendingMessageCallbacks.del(e.messageId),r.success=!1,r.resultSignature="MessageCallbackException",r.resultDescription="Web"===(null===(n=this.clientMetadata)||void 0===n?void 0:n.appPlatform)?JSON.stringify({message:o.message,stack:o.stack}):JSON.stringify({message:o.message}),u(),this.updateProcessMessageStats(!1,r.durationMs,o),t()}},e.prototype.processResponse=function(e){var t,n=new s.Operation({operationName:"ProcessResponse"});n.success=!0,n.setClientMetadata(this.clientMetadata),n.start();var o=this.pendingResponseCallbacks.get(e.messageId);o?(this.pendingResponseCallbacks.del(e.messageId),a.SchemaObject.matchesTypesFor(e,[c.ErrorResponse.getTypeName()])?o(e):o(void 0,e)):(n.resultSignature="NoPendingMessage",n.resultDescription=""+e.messageId,n.success=!1),"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)&&(n.resourceId=l(a.SchemaObject.getTypeNameFor(e)),s.Log.info(595855051,s.LogCategory.CoreDefault,n.stop()))},e.prototype.updateSendMessageStats=function(e,t,n){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||n?e&&n&&s.Log.warn(592513158,s.LogCategory.CoreDefault,"Succeeded send message provided error object."):s.Log.warn(592513157,s.LogCategory.CoreDefault,"Failed send message did not provide error object."),e||(n&&n.message===o.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)},e.prototype.updateProcessMessageStats=function(e,t,n){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||n?e&&n&&s.Log.warn(592513160,s.LogCategory.CoreDefault,"Succeeded process message provided error object."):s.Log.warn(592513159,s.LogCategory.CoreDefault,"Failed process message did not provide error object."),e||(n&&n.message===r.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)},e}();t.MessageEndpoint=h},15203:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(15204);Object.defineProperty(t,"Cache",{enumerable:!0,get:function(){return o.Cache}})},15204:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Cache=void 0;var o=function(){function e(e){if(this.cache=new Map,this.options=e||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}return e.prototype.put=function(e,t,n,o,r){if(null==n||n<=0)throw new Error("Cache timeout must be a positive number");(null==r||r<=0)&&(r=this.options.idleDurationMs);var s={value:t,lastUsed:r?Date.now():void 0,expire:n+Date.now(),idleDurationMs:r,expireCallback:o};return this.cache.set(e,s),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t},e.prototype.del=function(e){if(this.options.delCallback){var t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}var n=this.cache.delete(e);return 0===this.size()&&this.clear(),n},e.prototype.clear=function(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()},e.prototype.get=function(e){var t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value},e.prototype.keys=function(){return this.cache.keys()},e.prototype.forEach=function(e){this.cache.forEach((function(t,n){e(t.value,n)}))},e.prototype.size=function(){return this.cache.size},e.prototype.updateExpireTime=function(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)},e.prototype.onInterval=function(){var e=this,t=Date.now();this.cache.forEach((function(n,o){if(n.idleDurationMs&&n.lastUsed<t-n.idleDurationMs)return e.del(o),void(e.options.idleCallback&&e.options.idleCallback(o,n.value));n.expire<t&&(e.del(o),n.expireCallback&&n.expireCallback(o,n.value))}))},e}();t.Cache=o},15205:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationResultState=t.currentProtocolVersion=void 0,t.currentProtocolVersion=2,function(e){e[e.Idle=0]="Idle",e[e.Pending=1]="Pending"}(t.AnnotationResultState||(t.AnnotationResultState={}))},15206:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageQueue=t.ClientSendMessageErrorReason=void 0;var o,r=n(4997),s=n(3150),i=n(1230),a=n(4630),c=n(3521);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue"}(o=t.ClientSendMessageErrorReason||(t.ClientSendMessageErrorReason={}));var u=1e3,l=function(){function e(e){this.logOp=new c.Operation({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new a.LogCountLimiter("MessageQueue"),this.queue=new i(u),this.callbacks=e}return e.prototype.push=function(e,t,n){var s=this,i=this.queue;if(i.length===u){this.messageQueueLogCountLimiter.log((function(){s.logOp.resourceId="QueueFull",s.logOp.durationMs=0,c.Log.warn(594362819,c.LogCategory.CoreDefault,s.logOp)}));var l=i.shift();l.onResponse&&l.onResponse(new r.ErrorResponse({error:o.DroppedAsOldestInQueue}))}i.push({message:e,onResponse:t,timeQueued:a.Utils.getCurrentTimeMs(),attemptNumber:n})},e.prototype.sendOnSessionInitialized=function(e){var t=this,n=this.queue.length,i=0;if(n>0){for(var u=a.Utils.getCurrentTimeMs()-this.queue.get(0).timeQueued;this.queue.length>0&&this.callbacks.canSendMessage();){var l=this.queue.shift();e&&l.message instanceof r.SyncMessage&&s.SchemaObject.matchesTypesFor(l.message,[r.SyncMessage.getTypeName()])?(i++,l.onResponse&&l.onResponse(new r.ErrorResponse({error:o.ArrivedBeforeReseeding}))):l.message instanceof Uint8Array?this.callbacks.sendBytes(l.message):this.callbacks.sendMessage(l.message,l.onResponse,l.attemptNumber)}this.messageQueueLogCountLimiter.log((function(){t.logOp.resourceId="SendOnSessionInitialized",t.logOp.resultDescription="Queue size before: "+n+", after: "+t.queue.length+". droppedSyncMessages: "+i,t.logOp.durationMs=u,c.Log.warn(594362821,c.LogCategory.CoreDefault,t.logOp)}))}},e}();t.MessageQueue=l},15207:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.ClosedState=t.DisconnectedState=t.RunningState=t.InitingState=t.BaseState=t.queueBytes=t.queueMessage=t.sendMessageNow=t.SessionState=void 0;var s,i=n(4997),a=n(3150);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(s=t.SessionState||(t.SessionState={})),t.sendMessageNow=function(e,t,n,o){t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(function(t,o){t||a.SchemaObject.getTypeNameFor(o)!==i.SyncResponse.getTypeName()||(e.stats.lastSyncMessage=Date.now()),n&&n(t,o)}),void 0,o))},t.queueMessage=function(e,t,n,o){t&&(e.messageQueue.push(t,n,o),e.webSocketWorkerManager.init(void 0,e.customInitPromise))},t.queueBytes=function(e,t){t&&(e.messageQueue.push(t),e.webSocketWorkerManager.init(void 0,e.customInitPromise))};var c=function(){function e(e){this.context=e}return e.prototype.onEnter=function(e){},e.prototype.sendMessage=function(e,t,n){},e.prototype.sendBytes=function(e){},e.prototype.canSendMessage=function(){return!1},e.prototype.onConnectionClose=function(){},e}();t.BaseState=c;var u=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Initing,t.possibleNextStates=[s.Running,s.Disconnected,s.Closed],t}return r(n,e),n.prototype.sendMessage=function(e,n,o){a.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?t.sendMessageNow(this.context,e,n,o):t.queueMessage(this.context,e,n)},n.prototype.sendBytes=function(e){t.queueBytes(this.context,e)},n.prototype.onConnectionClose=function(){this.context.setState(s.Disconnected)},n}(c);t.InitingState=u;var l=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Running,t.possibleNextStates=[s.Disconnected,s.Closed],t}return r(n,e),n.prototype.onEnter=function(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)},n.prototype.sendMessage=function(e,n,o){t.sendMessageNow(this.context,e,n,o)},n.prototype.sendBytes=function(e){e&&this.context.webSocketWorkerManager.egressBytes(e)},n.prototype.canSendMessage=function(){return!0},n.prototype.onConnectionClose=function(){this.context.setState(s.Disconnected)},n}(c);t.RunningState=l;var p=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.stateName=s.Disconnected,t.possibleNextStates=[s.Initing,s.Closed],t}return r(n,e),n.prototype.onEnter=function(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()},n.prototype.sendMessage=function(e,n,o){a.SchemaObject.matchesTypesFor(e,[i.SessionInitMessage.getTypeName()])?(this.context.setState(s.Initing),t.sendMessageNow(this.context,e,n,o)):t.queueMessage(this.context,e,n,o)},n.prototype.sendBytes=function(e){t.queueBytes(this.context,e)},n}(c);t.DisconnectedState=p;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=s.Closed,t.possibleNextStates=[],t}return r(t,e),t}(c);t.ClosedState=h},15208:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketWorkerManager=t.calculateTimeToWaitForNextTry=void 0;var o=n(3150),r=n(4997),s=n(3521),i=n(4630),a=n(15209);t.calculateTimeToWaitForNextTry=function(e,t){var n=0,o=i.Utils.getCurrentTimeMs()?i.Utils.getCurrentTimeMs()-t:0,r=[1e3,2e3,5e3,1e4,6e4];return n=r[Math.max(0,Math.min(r.length-1,e-1))],n=Math.max(n-o,1e3)};var c=function(){function e(t,n,o,r,s){this.logCountLimiter=new i.LogCountLimiter(e.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.alreadyLoggedReconnectAttempt=!1,this.globalUrl=t,this.workerFactory=n,this.sessionInitializer=o,this.ingress=r,this.onClose=s}return e.prototype.init=function(t,n,o){var r=this;if(void 0===o&&(o=!1),this.permanentlyClosed)return Promise.reject("permanentlyClosed");if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=t||this.extensionConfigs;var i=function(){if(o||!r.alreadyLoggedReconnectAttempt){var t=o?e.initialAttemptTimeout:e.reconnectAttemptTimeout;r.connTimeout=setTimeout((function(){var e=new s.Operation({operationName:"ConnectionFailingOrSlow",dimension0:o?"Initial":"Reconnect",dimension1:t.toString(),dimension2:r.currentReconnectAttempt.toString()});s.Log.info(590448259,s.LogCategory.CoreDefault,e),r.alreadyLoggedReconnectAttempt=!o,r.connTimeout=void 0}),t)}};return n?this.pendingInitPromise=n().catch((function(e){s.Log.error(593835868,s.LogCategory.CoreDefault,"Error occurred during calling the custom init promise: "+e)})).then((function(){i(),r.initInternal()})):(this.pendingInitPromise=Promise.resolve(),i(),this.initInternal()),this.pendingInitPromise},e.prototype.egress=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressInternal(e)})):(this.egressInternal(e),Promise.resolve())},e.prototype.egressBytes=function(e){var t=this;return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then((function(){t.egressBytesInternal(e)})):(this.egressBytesInternal(e),Promise.resolve())},e.prototype.close=function(e){this.worker&&this.worker.close(),this.isWorkerReady=!1,this.worker=null,this.permanentlyClosed=e||this.permanentlyClosed},e.prototype.initInternal=function(){var e=this;this.isWorkerReady=!1,this.permanentlyClosed||(this.currentReconnectAttempt>0?setTimeout((function(){e.tryToConnectAndInitializeSession()}),t.calculateTimeToWaitForNextTry(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs)):this.tryToConnectAndInitializeSession())},e.prototype.egressInternal=function(e){var t;this.isWorkerReady||o.SchemaObject.matchesTypesFor(e,[r.SessionInitMessage.getTypeName()])?(o.SchemaObject.matchesTypesFor(e,[r.MicroSyncMessage.getTypeName()])?(this.castBinaryData(e),t=a.JSOND.serialize(e)):t=JSON.stringify(e),this.worker.egress(t)):o.SchemaObject.matchesTypesFor(e,[r.Response.getTypeName()])||s.Log.error(594551963,s.LogCategory.CoreDefault,new s.Operation({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.egressBytesInternal=function(e){this.isWorkerReady?this.worker.egress(e):s.Log.error(594551964,s.LogCategory.CoreDefault,new s.Operation({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))},e.prototype.tryToConnectAndInitializeSession=function(){var e=this;this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=i.Utils.getCurrentTimeMs();var t=function(n){e.permanentlyClosed||(e.connect(e.sliceUrl?e.sliceUrl:e.globalUrl),e.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!e.sliceUrl,extensionConfigs:e.extensionConfigs,onResponse:function(o,r){if(e.logCountLimiter.log((function(){n.success=!o,n.resultDescription=o?o.error:"",n.resourceId=r?r.sliceUrl:"",n.stop(),s.Log.info(594642311,s.LogCategory.CoreDefault,n)})),o||!e.worker)e.sliceUrl=void 0,e.close(),e.initInternal();else if(r.forceReconnect){e.close();var i=new s.Operation({operationName:"ForcedReconnect"}).start();i.resultSignature="globalUrl: "+e.globalUrl+". sliceUrl: "+e.sliceUrl,e.sliceUrl=void 0,setTimeout((function(){t(i)}),1e3)}else void 0!==e.connTimeout&&clearTimeout(e.connTimeout),e.sliceUrl=r.sliceUrl,e.ready()}}))},n=new s.Operation({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #"+this.currentReconnectAttempt}).start();t(n)},e.prototype.connect=function(e){var t=this;this.worker=this.workerFactory(),this.worker.init(e,this.ingress,(function(e){t.onClose(e),t.close()}))},e.prototype.ready=function(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0},e.prototype.castBinaryData=function(e){if(e){if(Array.isArray(e.__binaryMembers__))for(var t=0,n=e.__binaryMembers__;t<n.length;t++){var o=n[t];ArrayBuffer.isView(e[o])||(e[o]=new Uint8Array(e[o]))}for(var r=0,s=Object.keys(e);r<s.length;r++){var i=s[r];"object"==typeof e[i]&&null!==e[i]&&this.castBinaryData(e[i])}}},e.initialAttemptTimeout=1e5,e.reconnectAttemptTimeout=2e4,e.className="WebSocketWorkerManager",e}();t.WebSocketWorkerManager=c},15209:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(15210);Object.defineProperty(t,"JSOND",{enumerable:!0,get:function(){return o.JSOND}})},15210:function(e,t,n){"use strict";(function(e){var o=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(t,"__esModule",{value:!0}),t.JSOND=void 0,n(9185);var r=function(){function t(){}return t.deserialize=function(n,o){if(void 0===o&&(o=function(e){return e}),n[0]!==t.IDENTIFIERBYTE)throw"Invalid Binary: Incorrect Identifier";for(var r=1,s=[],i=new DataView(n.buffer,n.byteOffset,n.byteLength);r<n.byteLength;){if(r+4>n.byteLength)throw"Invalid Binary: Error reading fragment length";var a=i.getUint32(r);if(r+a+4>n.byteLength)throw"Invalid Binary: Fragment out of range";void 0!==e&&e.from?s.push(e.from(n.buffer,n.byteOffset+r+4,a)):s.push(new Uint8Array(n.buffer,n.byteOffset+r+4,a)),r+=4+a}if(s.length<1)throw"Invalid Binary: No fragments found";var c=t.textDecoder.decode(s[0]);return JSON.parse(c,(function(e,n){if("string"==typeof n){if(n.substring(0,t.BINARYKEYWORD.length)===t.BINARYKEYWORD){var r=parseInt(n.substring(t.BINARYKEYWORD.length),10);if("number"!=typeof r||r>=s.length-1)throw"Invalid Binary: Binary index out of range";return o(s[r+1])}if(n.substring(0,t.ESCAPEKEYWORD.length)===t.ESCAPEKEYWORD)return n.substring(t.ESCAPEKEYWORD.length)}return n}))},t.serialize=function(e){var n,r,s=[void 0],i=JSON.stringify(e,(function(e,n){return ArrayBuffer.isView(n)?(s.push(n),""+t.BINARYKEYWORD+(s.length-2)):n&&"Buffer"===n.type&&Array.isArray(n.data)?(s.push(new Uint8Array(n.data)),""+t.BINARYKEYWORD+(s.length-2)):"string"==typeof n&&n.substring(0,t.ESCAPEKEYWORD.length)===t.ESCAPEKEYWORD?t.ESCAPEKEYWORD+n:n}));s[0]=t.textEncoder.encode(i);var a=s.reduce((function(e,t){return e+4+t.byteLength}),0),c=new Uint8Array(a+1);c[0]=t.IDENTIFIERBYTE;var u=1,l=new DataView(c.buffer,c.byteOffset,c.byteLength);try{for(var p=o(s),h=p.next();!h.done;h=p.next()){var f=h.value;l.setUint32(u,f.byteLength),c.set(f,u+4),u+=4+f.byteLength}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=p.return)&&r.call(p)}finally{if(n)throw n.error}}return c},t.IDENTIFIERBYTE=3,t.BINARYKEYWORD=":b",t.ESCAPEKEYWORD=":",t.textDecoder=new TextDecoder,t.textEncoder=new TextEncoder,t}();t.JSOND=r}).call(this,n(1874).Buffer)},15211:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExecutionWithThrottling=void 0;var o=n(4630),r=function(){function e(){this.throttleInfoMap=new Map}return e.prototype.execute=function(e,t,n){var r=this;if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){var s=this.getWorkflowThrottleInfo(t.name);if(null==s.currentTileId)s.currentTileId=e,s.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n();else if(s.currentTileId===e){var i=o.Utils.getCurrentTimeMs(),a=this.delayTime(s,i,t.throttleSettings.throttlingInterval);a>0?(s.latestCallback=n,null==s.lastTimeout&&(s.lastTimeout=setTimeout((function(){var e=r.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),e.latestCallback()}),a))):(s.timeOfPreviousStartedEvent=i,n())}else null!=s.lastTimeout&&(clearTimeout(s.lastTimeout),s.latestCallback(),s.lastTimeout=void 0),s.currentTileId=e,s.timeOfPreviousStartedEvent=o.Utils.getCurrentTimeMs(),n()}else n()},e.prototype.delayTime=function(e,t,n){var o=t-e.timeOfPreviousStartedEvent;return Math.max(n-o,0)},e.prototype.getWorkflowThrottleInfo=function(e){var t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:function(){},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t},e}();t.ExecutionWithThrottling=r},15212:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;var o=n(4997),r=n(3150),s=n(15213),i=n(10637),a=n(10638),c=n(15214),u=n(15215),l=function(){function e(e){this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.isSessionConnected=!1,this.hostCallbacks=e.hostCallbacks,this.sessionManager=e.sessionManager,this.operationBatchConfig=e.batchOptions?this.getOperationBatchConfig(e.batchOptions):void 0,this.extensionConfigs=e.extensionConfigs,this.clientMetadata=e.clientMetadata,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.onMessage(o.AnnotationResultsMessage.getTypeName(),this.onAnnotationResults.bind(this)),this.sessionManager.onMessage(o.AnnotationResultStateMessage.getTypeName(),this.onAnnotationResultStateMessage.bind(this))}return e.prototype.initialize=function(){var e=this;return this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0).then((function(){return e}))},Object.defineProperty(e.prototype,"isConnected",{get:function(){return this.isSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasConnected",{get:function(){return this.hasSessionConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.isSessionClosed},enumerable:!1,configurable:!0}),e.prototype.registerLocalWorkflow=function(e){this.localWorkflowManager||(this.localWorkflowManager=new u.LocalWorkflowExecutionManager(this)),this.localWorkflowManager.registerLocalWorkflow(e)},e.prototype.activateAnnotation=function(e,t){var n,o=new s.AnnotationActivationTracker(this.getSessionManager.bind(this),e,t);if(t&&t.callback){var r=this.annotationCallbacks.get(e);r||(r=new Map,this.annotationCallbacks.set(e,r)),r.set(o.token,t.callback)}var i=null!==(n=this.tokensByAnnotationType.get(e))&&void 0!==n?n:[];return-1===i.indexOf(o.token)&&i.push(o.token),this.tokensByAnnotationType.set(e,i),this.annotationActivationTrackers.set(o.token,o),o.activate(!1),o.asPromise()},e.prototype.updateAnnotationConfig=function(e,t){throw new Error("Not Yet Implemented")},e.prototype.releaseAnnotation=function(e){var t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);var n=this.annotationCallbacks.get(t.annotationType);return n&&(n.delete(e),0==n.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)},e.prototype.setAnnotationState=function(e,t,n){var o={state:n};this.submitOperation(new r.UpdateAnnotationMetaDataOperation({parentPath:e,items:[{id:t}],M_:o}))},e.prototype.submitOperation=function(e,t){this.submitOperations([e],t)},e.prototype.submitOperations=function(e,t){var n=this;if(this.operationBatchConfig){if(!this.batchedOperationsManager){this.batchedOperationsManager=new i.BatchManager((function(e,t,r){n.getSessionManager().sendMessage(new o.SyncMessage({cv:t.cv,seq:n.nextSyncSequenceId++,ops:e}),(function(e){r(e?new Error(e.error):void 0)}))}))}this.batchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:this.nextSyncSequenceId++,ops:e}));this.localWorkflowManager&&this.localWorkflowManager.runLocalWorkflows(e)},e.prototype.submitSeedOperations=function(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");this.allowSeed=!1,this.allowGroupSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!0,t):this.getSessionManager().sendMessage(new o.SyncMessage({cv:t,seq:0,ops:e}))},e.prototype.submitSeedGroupOperations=function(e,t,n){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");t&&(this.allowGroupSeed=!1),this.allowSeed=!1,this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(e,!!t,n):(this.seedGroupSize++,this.getSessionManager().sendMessage(new o.SyncMessage({cv:n,seq:0,ops:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))},e.prototype.submitCustomMessage=function(e){var t=this;return new Promise((function(n,o){t.getSessionManager().sendMessage(e,(function(e,t){e?o(e):n(t)}))}))},e.prototype.requestCacheDump=function(e){var t=this;if(e)throw new Error("NYI");return new Promise((function(e,n){t.getSessionManager().sendMessage(new o.CacheDumpRequestMessage,(function(t,o){t?n(t):e(o)}))}))},e.prototype.forceReconnect=function(e){return this.extensionConfigs=e,this.getSessionManager().forceReconnect(e)},e.prototype.close=function(){this.isSessionClosed=!0,this.getSessionManager().closeSession()},e.prototype.getClientMetadata=function(){return this.clientMetadata},e.prototype.setSessionCloseCallback=function(e){this.sessionCloseCallback=e},e.prototype.setConnectCallback=function(e){this.connectCallback=e},e.prototype.setDisconnectCallback=function(e){this.disconnectCallback=e},e.prototype.setReconnectCallback=function(e){this.reconnectCallback=e},e.prototype.onAnnotationResults=function(e,t){t(void 0,new o.Response);for(var n=0,r=e.ops;n<r.length;n++){var s=r[n];this.callAnnotationCallbacks(s,e.annotationType),this.hostCallbacks.onAnnotationResult&&this.hostCallbacks.onAnnotationResult(s)}},e.prototype.onAnnotationResultStateMessage=function(e,t){var n;t(void 0,new o.Response);for(var r=0,s=e.updates;r<s.length;r++){var i=s[r],a=i.annotationType,c=i.state;if(this.tokensByAnnotationType.has(a)){var u=void 0;u=this.annotationResultStates.has(a)?this.annotationResultStates.get(a):c===o.AnnotationResultState.Idle?o.AnnotationResultState.Pending:o.AnnotationResultState.Idle;for(var l=0,p=this.tokensByAnnotationType.get(a);l<p.length;l++){var h=p[l],f=this.annotationActivationTrackers.get(h);(null===(n=f.options)||void 0===n?void 0:n.stateUpdateCallback)&&f.options.stateUpdateCallback(u,c)}}}},e.prototype.resetNextSyncSequenceId=function(){this.nextSyncSequenceId=1},e.prototype.onReconnect=function(){this.isSessionConnected=!0,this.annotationActivationTrackers.forEach((function(e){e.activate(!0)})),this.reconnectCallback&&this.reconnectCallback()},e.prototype.onSessionClose=function(e){this.isSessionClosed=!0,this.isSessionConnected=!1,this.sessionCloseCallback&&this.sessionCloseCallback(e)},e.prototype.onConnect=function(e,t,n,o){this.hasSessionConnected&&(this.allowSeed=e,e&&(this.allowGroupSeed=!0,this.seedGroupSize=0)),this.isSessionConnected=!0,this.hasSessionConnected=!0,this.connectCallback&&this.connectCallback(e,t,n,o)},e.prototype.onDisconnect=function(e){this.isSessionConnected=!1,this.disconnectCallback&&this.disconnectCallback(e)},e.prototype.getSessionManager=function(){return this.sessionManager||(this.sessionManager=new c.EmptySessionManager),this.sessionManager},e.prototype.callAnnotationCallbacks=function(e,t){if(0!==this.annotationCallbacks.size){var n=this.annotationCallbacks.get(t);n&&n.forEach((function(t){t(e)}))}},e.prototype.getOperationBatchConfig=function(e){return{delayMs:e.delayMs,maxInputSize:e.maxInputSize,estimateSize:a.estimateSize,groupingKeyExtractor:function(){return"operations"},multiplex:function(e){return{input:e.filter((function(e){return e.length})).reduce((function(e,t){return e.concat(t)}),[]),demultiplex:function(){return[[]]}}},split:function(e){if(!(e.length<=1))return{inputs:e.reduce((function(e,t){return e.push([t]),e}),[]),join:function(){return[]}}}}},e.prototype.sendSeedMessagesViaBatchManager=function(e,t,n){var r=this;if(!this.seedBatchedOperationsManager){var s=e.length,a=0;this.seedBatchedOperationsManager=new i.BatchManager((function(e,n,i){r.seedGroupSize++,a+=e.length;var c=t&&a===s;r.getSessionManager().sendMessage(new o.SyncMessage({cv:n.cv,seq:0,ops:e,groupId:"Seed",groupSize:c?r.seedGroupSize:void 0,groupComplete:c||void 0}),(function(e){i(e?new Error(e.error):void 0)}))}))}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},n)},e}();t.Session=l},15213:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationActivationTracker=void 0;var o=n(4997),r=function(){function e(t,n,o){var r=this;this.sessionManager=t,this.annotationType=n,this.options=o,this.token=n+"-"+e.nextActivationResultBatchId++,this.promise=new Promise((function(e,t){r.resolve=e,r.reject=t}))}return e.prototype.asPromise=function(){return this.promise},e.prototype.activate=function(e){var t=this;this.sessionManager().sendMessage(new o.AnnotationActivationMessage({annotationType:this.annotationType,token:this.token,config:this.options?this.options.config:void 0,ignoreExistingAnnotations:e}),(function(e,n){t.complete(e?new Error(e.error):void 0)}))},e.prototype.release=function(){var e=this;return new Promise((function(t,n){e.sessionManager().sendMessage(new o.AnnotationReleaseMessage({token:e.token}),(function(e,o){e?n(new Error(e.error)):t(o.lastRelease)}))}))},e.prototype.complete=function(e){this.isComplete||(this.isComplete=!0,e?this.reject(e):this.resolve({token:this.token}))},e.nextActivationResultBatchId=1,e}();t.AnnotationActivationTracker=r},15214:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.EmptySessionManager=void 0;var s=n(3521),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.init=function(){return Promise.resolve()},t.prototype.sendMessage=function(e,t){},t.prototype.onMessage=function(e,t){},t.prototype.forceReconnect=function(){return Promise.resolve()},t.prototype.closeSession=function(){},t.prototype.sendBytes=function(e){},t.prototype.getCorrelationVector=function(){return new s.CorrelationVector},t.prototype.setState=function(e){},t}(n(9184).EventEmitter);t.EmptySessionManager=i},15215:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalWorkflowExecutionManager=void 0;var o=n(3150),r=n(6877),s=n(3521),i=n(4997),a=function(){function e(e){this.localWorkflows=[],this.session=e,this.nextAnnotationId=1,this.nextSignalId=1}return e.prototype.getNextClientAnnotationId=function(){return"#AC"+this.nextAnnotationId++},e.prototype.getNextClientSignalId=function(){return"#SC"+this.nextSignalId++},e.prototype.registerLocalWorkflow=function(e){var t=new s.Operation({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");this.localWorkflows.push({workflow:e,workflowLambda:e.factory()}),t.success=!0,s.Log.info(579150560,s.LogCategory.CoreDefault,t.stop())},e.prototype.runLocalWorkflows=function(e){for(var t=0,n=e;t<n.length;t++){var r=n[t];if(o.SchemaObject.getTypeNameFor(r)!==o.DeleteOperation.getTypeName())for(var i=0,a=r.items;i<a.length;i++){var c=a[i];if(c.body)for(var u=0,l=this.localWorkflows;u<l.length;u++){var p=l[u];if(o.SchemaObject.matchesTypesFor(c.body,p.workflow.inputTypes)){var h={parentPath:r.parentPath,id:c.id,body:c.body,revId:c.revId,source:c.source};this.executeLocalWorkflow(p,[h],this.session.getClientMetadata()).catch((function(e){s.Log.error(578614468,s.LogCategory.CoreDefault,e)}))}}}}},e.prototype.executeLocalWorkflow=function(e,t,n){var a=this;return new Promise((function(c,u){var l=e.workflow,p=new s.Operation({operationName:"ExecuteWorkflow",resourceId:l.id});p.start();var h=function(e){return e?(p.resultDescription=e,p.resultSignature="Exception",s.Log.error(579150561,s.LogCategory.CoreDefault,p.stop())):(p.success=!0,s.Log.info(579150562,s.LogCategory.CoreDefault,p.stop())),e},f={getToken:function(){},clientMetadata:n},d={setAnnotations:function(e,n,r,s){if(t[0].body===e){var c,p=t[0];if(Array.isArray(r))if(l.outputTypes&&l.outputTypes.includes(n))if(p)for(var f=0,d=r;f<d.length;f++){var g=d[f];o.SchemaObject.matchesTypesFor(g,[o.Annotation.getTypeName()])?o.SchemaObject.getTypeNameFor(g)!==n&&(c="Workflow produced inconsistent annotation types in setAnnotations call ("+o.SchemaObject.getTypeNameFor(g)+" did not match expected "+n+")"):c="Workflow produced an output that is not an annotation "+o.SchemaObject.getTypeNameFor(g)}else c="No item provided";else c="Workflow said it would output one of ["+l.outputTypes+"] but instead output "+n;else c="Workflow produced an invalid annotation array";if(c)u(h(c));else{var y;y=s&&s.isSessionAnnotation?["session"]:s&&s.ancestorType?p.parentPath:p.parentPath.concat(p.id);for(var m=[],v=0,S=r;v<S.length;v++){g=S[v];m.push({id:a.getNextClientAnnotationId(),source:l.id,body:g})}a.session.onAnnotationResults(new i.AnnotationResultsMessage({annotationType:n,ops:[{parentPath:y,items:m}]}),(function(){}))}}else u(h("Expected obj to be "+t[0].body+" but instead it was "+e))},submitSignals:function(e){var t=e.map((function(e){return{id:a.getNextClientSignalId(),source:l.id,body:e}})),n=new o.SignalOperation({parentPath:["session"],items:t});a.session.submitOperations([n])},done:function(e){h(e?e.message:null),e?u(e):c()},addAnnotation:function(){throw Error("Not implemented")},addSiblingAnnotation:function(){throw Error("Not implemented")},addSessionAnnotation:function(){throw Error("Not implemented")}},g=e.workflowLambda;if(l.kind===r.WorkflowKind.SingleItem){1!==t.length&&h("Single item workflows expect a single input"),f.delta=t[0].delta;try{g.execute(t[0].body,f,d)}catch(e){h(e)}}else h("Only single item workflows supported currently")}))},e}();t.LocalWorkflowExecutionManager=a},15216:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStats=void 0;var o=function(){};t.SessionStats=o},15217:function(e,t,n){"use strict";var o,r=this&&this.__extends||(o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0}),t.SessionInitializer=void 0;var s=n(3521),i=n(4997),a=n(4630),c=n(10639),u=function(e){function t(t,n,o,r,s){var i=e.call(this)||this;return i.getSessionStats=t,i.clientMetadata=n,i.tokenRefreshManager=o,i.sendMessage=r,i.options=s||{},i.options.overrideSessionInitMessage=i.options.overrideSessionInitMessage||function(e){return e},i}return r(t,e),t.prototype.initSession=function(e){var t=this;e.onResponse=e.onResponse||function(){};var n=a.Utils.getCurrentTimeMs(),o=this.getSessionStats().lastConnectionClose&&n-this.getSessionStats().lastConnectionClose,r=this.getSessionStats().lastSyncMessage&&n-this.getSessionStats().lastSyncMessage,c=new s.Operation({operationName:"SessionInit"}),u={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:o,timeSinceLastSyncMessage:r,isTokenRefresh:e.isTokenRefresh},l=this.options.overrideSessionInitMessage(new i.SessionInitMessage({protocolVersion:i.currentProtocolVersion,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs}));this.sendMessage(l,(function(n,o){if(c.success=!n,c.resultSignature=t.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",c.resourceId=null==o?void 0:o.sliceUrl,(null==o?void 0:o.sessionKey)&&u.sessionKey!==o.sessionKey&&(u.sessionKey=o.sessionKey),c.resultDescription=JSON.stringify(u),s.Log.info(594875485,s.LogCategory.CoreDefault,c),e.onResponse(n,o),!(n||e.isReconnectOnSameSlice&&o.forceReconnect)){if(!o.anonymousToken||!o.tokenExpirationSeconds)return void s.Log.error(594875486,s.LogCategory.CoreDefault,"AL Anonymous token was not generated for the session");t.anonymousToken=o.anonymousToken,t.onSuccessfulSessionInitOnServerSide(o)}}))},t.prototype.onSuccessfulSessionInitOnServerSide=function(e){this.tokenRefreshManager.scheduleRefresh(c.TokenType.Anonymous,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0})),this.initHostAuthToken();var t=!!this.sessionKey,n=this.sessionKey!==e.sessionKey;this.emit("connect",n,t,e.sessionUrlBase+"/"+e.sessionKey,e.origin,this.anonymousToken),this.sessionKey=e.sessionKey,this.origin=e.origin,t&&this.emit("reconnect")},t.prototype.initHostAuthToken=function(){var e=this;this.options.getAuthToken&&this.options.getAuthToken().then((function(t){t?e.sendTokenProvisionMessage(t):s.Log.info(594834502,s.LogCategory.CoreDefault,"Host auth token provision failed")})).catch((function(e){s.Log.error(594834503,s.LogCategory.CoreDefault,"Error happened while attempting to fetch host token: "+e)}))},t.prototype.sendTokenProvisionMessage=function(e){var t=new i.TokenProvisionMessage({authToken:e});this.sendMessage(t,this.onTokenProvisionResponse.bind(this))},t.prototype.onTokenProvisionResponse=function(e,t){!e&&t&&t.tokenExpirationSeconds&&this.tokenRefreshManager.scheduleRefresh(c.TokenType.Host,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))},t}(n(9184).EventEmitter);t.SessionInitializer=u},15218:function(e){e.exports=JSON.parse('{"version":"2.16.304"}')},15219:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SingleItemWorkflow=void 0;var o=n(6877),r=function(){function e(e,t){var n,r;this.kind=o.WorkflowKind.SingleItem,this.id=e,t&&(this.inputTypes=null!==(n=t.inputTypes)&&void 0!==n?n:this.inputTypes,this.outputTypes=null!==(r=t.outputTypes)&&void 0!==r?r:this.outputTypes)}return e.create=function(t){return new e(t)},e.prototype.setInputTypes=function(e){return this.inputTypes=e,this},e.prototype.setOutputTypes=function(e){return this.outputTypes=e,this},e.prototype.setLambdaType=function(e){return this.factory=function(){return new e},this},e.prototype.setLambda=function(e){return this.factory=function(){return{execute:e,dispose:function(){}}},this},e}();t.SingleItemWorkflow=r},3056:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var o="EditorProofing_UpsellClicked"},3150:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(6865),t),r(n(6866),t),r(n(6867),t),r(n(6868),t),r(n(6869),t),r(n(3151),t),r(n(6870),t),r(n(6871),t)},3151:function(e,t,n){"use strict";var o=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var o=Array(e),r=0;for(t=0;t<n;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,r++)o[r]=s[i];return o};Object.defineProperty(t,"__esModule",{value:!0}),t.SchemaObject=void 0;var r=function(){function e(t){e.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_SchemaObject"},e.getBaseTypes=function(){return[]},e.getTypeNameFor=function(e){return e&&e.H_?e.H_.T_:void 0},e.getBaseTypesFor=function(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]},e.getAllTypesFor=function(t){var n=e.getTypeNameFor(t);return n?o([n],e.getBaseTypesFor(t)):[]},e.matchesTypesFor=function(t,n){if(!Array.isArray(n)||0===n.length)return!0;for(var o=e.getTypeNameFor(t),r=t&&t.H_&&t.H_.B_?t.H_.B_:void 0,s=0,i=n;s<i.length;s++){var a=i[s];if(a===o)return!0;if(r&&r.indexOf(a)>=0)return!0}return!1},e.assign=function(e,t,n){if(n)for(var o=0,r=Object.keys(n);o<r.length;o++){var s=r[o];t[s]=n[s]}return t.H_=e.H_,t},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SchemaObject=r},3224:function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"i",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"g",(function(){return l})),n.d(t,"c",(function(){return p})),n.d(t,"b",(function(){return h})),n.d(t,"e",(function(){return f}));var o=n(44),r=(n(3056),n(2878));n.d(t,"a",(function(){return r.a}));var s=new o.c((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(4),n.e(5),n.e(8),n.e(14),n.e(37),n.e(183),n.e(287),n.e(697)]).then(n.bind(null,5907))})),i=new o.a(s,(function(e){return e.showEditorOptions})),a=new o.a(s,(function(e){return e.getUserOptions})),c=new o.a(s,(function(e){return e.updateSettingDirectly})),u=new o.a(s,(function(e){return e.tryStartTrial})),l=new o.a(s,(function(e){return e.startPremiumPreviewTimeBased})),p=new o.a(s,(function(e){return e.getDefaultOptions})),h=new o.a(s,(function(e){return e.getAllOverriddenOptions})),f=new o.a(s,(function(e){return e.openUpsellUrlFromSettingsDialog}))},3521:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(15185);Object.defineProperty(t,"CorrelationVector",{enumerable:!0,get:function(){return o.CorrelationVector}});var r=n(15186);Object.defineProperty(t,"Log",{enumerable:!0,get:function(){return r.Log}}),Object.defineProperty(t,"LogCategory",{enumerable:!0,get:function(){return r.LogCategory}});var s=n(15187);Object.defineProperty(t,"LoggingAggregator",{enumerable:!0,get:function(){return s.LoggingAggregator}});var i=n(15188);Object.defineProperty(t,"Operation",{enumerable:!0,get:function(){return i.Operation}})},4630:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogCountLimiter=t.Utils=void 0;var o=n(3521),r=function(){function e(){}return e.convertServiceUrlToWebSocket=function(e){var t=e.split(":"),n=t[0].toLowerCase();return 0==n.indexOf("http")?(n=n.replace("http","ws"),t[0]=n,t.join(":")):e},e.getCurrentTimeMs=function(){return Date.now?Date.now():(new Date).getTime()},e}();t.Utils=r;var s=function(){function e(e){this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=e}return e.prototype.log=function(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){var t=new o.Operation({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:"Limit for number of logs for id: "+this.id+" reached - all next logs will be dropped"});o.Log.warn(594834508,o.LogCategory.CoreDefault,t)}},e}();t.LogCountLimiter=s},4997:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(15202),t),r(n(15205),t),r(n(10636),t)},5492:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(15173),t),r(n(15174),t);var s=n(15175);Object.defineProperty(t,"ExceptionType",{enumerable:!0,get:function(){return s.ExceptionType}}),Object.defineProperty(t,"MessageType",{enumerable:!0,get:function(){return s.MessageType}}),r(n(15176),t),r(n(15177),t),r(n(15178),t),r(n(15179),t),r(n(15180),t)},6865:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnnotationState=void 0,function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(t.AnnotationState||(t.AnnotationState={}))},6866:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},6867:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridConstants=t.OpenType=t.BlobRefType=void 0,function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl"}(t.BlobRefType||(t.BlobRefType={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(t.OpenType||(t.OpenType={}));var o=function(){function e(){}return e.lowerIndexBound=1,e.maxNumberOfRows=1048576,e.maxNumberOfColumns=16384,e.firstColumnName="A",e.lastColumnName="XFD",e}();t.GridConstants=o},6868:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BinaryClassificationAnnotation=t.Annotation=void 0;var o=n(3151),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Annotation"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Annotation=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_BinaryClassificationAnnotation"},e.getBaseTypes=function(){return["AugLoop_Core_Annotation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.BinaryClassificationAnnotation=s},6869:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SignalOperation=t.MicroSyncOperation=t.DeltaUpdateOperation=t.VisibilityOperation=t.FocusOperation=t.PurgeOperation=t.DeleteOperation=t.UpdateOperation=t.UpdateAnnotationMetaDataOperation=t.MoveOperation=t.AddOperation=t.OperationWithSiblingContext=t.Operation=t.ItemDelta=void 0;var o=n(3151),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_ItemDelta"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.ItemDelta=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Operation"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Operation=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_OperationWithSiblingContext"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.OperationWithSiblingContext=i;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_AddOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.AddOperation=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MoveOperation"},e.getBaseTypes=function(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MoveOperation=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateAnnotationMetaDataOperation=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_UpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.UpdateOperation=l;var p=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeleteOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeleteOperation=p;var h=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_PurgeOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.PurgeOperation=h;var f=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_FocusOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.FocusOperation=f;var d=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_VisibilityOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.VisibilityOperation=d;var g=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_DeltaUpdateOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.DeltaUpdateOperation=g;var y=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_MicroSyncOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.MicroSyncOperation=y;var m=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_SignalOperation"},e.getBaseTypes=function(){return["AugLoop_Core_Operation"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.SignalOperation=m},6870:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Signal=void 0;var o=n(3151),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Signals_Signal"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Signal=r},6871:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GridNeighborhoodContext=t.GridCell=t.Document=t.Session=t.TileGroup=t.Binary=t.Blob=void 0;var o=n(3151),r=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Blob"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Blob=r;var s=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Binary"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Binary=s;var i=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_TileGroup"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.TileGroup=i;var a=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Session"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Session=a;var c=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_Document"},e.getBaseTypes=function(){return["AugLoop_Core_TileGroup"]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.Document=c;var u=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridCell"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridCell=u;var l=function(){function e(t){o.SchemaObject.assign(e,this,t)}return e.getTypeName=function(){return"AugLoop_Core_GridNeighborhoodContext"},e.getBaseTypes=function(){return[]},e.H_={T_:e.getTypeName(),B_:e.getBaseTypes()},e}();t.GridNeighborhoodContext=l},6877:function(e,t,n){"use strict";var o=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n),Object.defineProperty(e,o,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),r=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),r(n(10628),t),r(n(15167),t),r(n(10629),t),r(n(15168),t),r(n(15169),t),r(n(15170),t),r(n(15171),t),r(n(15172),t),r(n(15181),t),r(n(15182),t),r(n(15183),t),r(n(15184),t),r(n(10630),t)},911:function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],o=t[1];return 3*(n+o)/4-o},t.toByteArray=function(e){var t,n,o=u(e),i=o[0],a=o[1],c=new s(function(e,t,n){return 3*(t+n)/4-n}(0,i,a)),l=0,p=a>0?i-4:i;for(n=0;n<p;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,r=n%3,s=[],i=0,a=n-r;i<a;i+=16383)s.push(l(e,i,i+16383>a?a:i+16383));1===r?(t=e[n-1],s.push(o[t>>2]+o[t<<4&63]+"==")):2===r&&(t=(e[n-2]<<8)+e[n-1],s.push(o[t>>10]+o[t>>4&63]+o[t<<2&63]+"="));return s.join("")};for(var o=[],r=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=i.length;a<c;++a)o[a]=i[a],r[i.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var r,s,i=[],a=t;a<n;a+=3)r=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),i.push(o[(s=r)>>18&63]+o[s>>12&63]+o[s>>6&63]+o[63&s]);return i.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},9184:function(e,t,n){"use strict";var o=Object.prototype.hasOwnProperty,r="~";function s(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,o,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new i(n,o||e,s),c=r?r+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function u(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)o.call(e,t)&&n.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},u.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var o=0,s=n.length,i=new Array(s);o<s;o++)i[o]=n[o].fn;return i},u.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},u.prototype.emit=function(e,t,n,o,s,i){var a=r?r+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],p=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),p){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,n),!0;case 4:return l.fn.call(l.context,t,n,o),!0;case 5:return l.fn.call(l.context,t,n,o,s),!0;case 6:return l.fn.call(l.context,t,n,o,s,i),!0}for(u=1,c=new Array(p-1);u<p;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,f=l.length;for(u=0;u<f;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),p){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,n);break;case 4:l[u].fn.call(l[u].context,t,n,o);break;default:if(!c)for(h=1,c=new Array(p-1);h<p;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},u.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},u.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},u.prototype.removeListener=function(e,t,n,o){var s=r?r+e:e;if(!this._events[s])return this;if(!t)return c(this,s),this;var i=this._events[s];if(i.fn)i.fn!==t||o&&!i.once||n&&i.context!==n||c(this,s);else{for(var a=0,u=[],l=i.length;a<l;a++)(i[a].fn!==t||o&&!i[a].once||n&&i[a].context!==n)&&u.push(i[a]);u.length?this._events[s]=1===u.length?u[0]:u:c(this,s)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&c(this,t)):(this._events=new s,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u},9185:function(e,t,n){(function(e,t){!function(e){function n(){}function o(e,t){if(e=void 0===e?"utf-8":e,t=void 0===t?{fatal:!1}:t,-1===s.indexOf(e.toLowerCase()))throw new RangeError("Failed to construct 'TextDecoder': The encoding label provided ('"+e+"') is invalid.");if(t.fatal)throw Error("Failed to construct 'TextDecoder': the 'fatal' option is unsupported.")}function r(e){for(var t=0,n=Math.min(65536,e.length+1),o=new Uint16Array(n),r=[],s=0;;){var i=t<e.length;if(!i||s>=n-1){if(r.push(String.fromCharCode.apply(null,o.subarray(0,s))),!i)return r.join("");e=e.subarray(t),s=t=0}if(0==(128&(i=e[t++])))o[s++]=i;else if(192==(224&i)){var a=63&e[t++];o[s++]=(31&i)<<6|a}else if(224==(240&i)){a=63&e[t++];var c=63&e[t++];o[s++]=(31&i)<<12|a<<6|c}else if(240==(248&i)){65535<(i=(7&i)<<18|(a=63&e[t++])<<12|(c=63&e[t++])<<6|63&e[t++])&&(i-=65536,o[s++]=i>>>10&1023|55296,i=56320|1023&i),o[s++]=i}}}if(e.TextEncoder&&e.TextDecoder)return!1;var s=["utf-8","utf8","unicode-1-1-utf-8"];Object.defineProperty(n.prototype,"encoding",{value:"utf-8"}),n.prototype.encode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to encode: the 'stream' option is unsupported.");t=0;for(var n=e.length,o=0,r=Math.max(32,n+(n>>>1)+7),s=new Uint8Array(r>>>3<<3);t<n;){var i=e.charCodeAt(t++);if(55296<=i&&56319>=i){if(t<n){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,i=((1023&i)<<10)+(1023&a)+65536)}if(55296<=i&&56319>=i)continue}if(o+4>s.length&&(r+=8,r=(r*=1+t/e.length*2)>>>3<<3,(a=new Uint8Array(r)).set(s),s=a),0==(4294967168&i))s[o++]=i;else{if(0==(4294965248&i))s[o++]=i>>>6&31|192;else if(0==(4294901760&i))s[o++]=i>>>12&15|224,s[o++]=i>>>6&63|128;else{if(0!=(4292870144&i))continue;s[o++]=i>>>18&7|240,s[o++]=i>>>12&63|128,s[o++]=i>>>6&63|128}s[o++]=63&i|128}}return s.slice?s.slice(0,o):s.subarray(0,o)},Object.defineProperty(o.prototype,"encoding",{value:"utf-8"}),Object.defineProperty(o.prototype,"fatal",{value:!1}),Object.defineProperty(o.prototype,"ignoreBOM",{value:!1});var i=r;"function"==typeof t&&t.from?i=function(e){return t.from(e.buffer,e.byteOffset,e.byteLength).toString("utf-8")}:"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&(i=function(e){var t=URL.createObjectURL(new Blob([e],{type:"text/plain;charset=UTF-8"}));try{var n=new XMLHttpRequest;return n.open("GET",t,!1),n.send(),n.responseText}catch(t){return r(e)}finally{URL.revokeObjectURL(t)}}),o.prototype.decode=function(e,t){if((t=void 0===t?{stream:!1}:t).stream)throw Error("Failed to decode: the 'stream' option is unsupported.");return e=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),i(e)},e.TextEncoder=n,e.TextDecoder=o}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,n(122),n(1874).Buffer)}}]);
//# sourceMappingURL=owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js.map
self.scriptsLoaded['owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~OwaRoamingDictionary~ProofingPlugin.js'] = (new Date()).getTime();