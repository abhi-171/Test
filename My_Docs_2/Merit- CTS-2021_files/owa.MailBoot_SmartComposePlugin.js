self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.MailBoot~SmartComposePlugin.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[743],{10515:function(e){e.exports=JSON.parse('{"a":"m_a","b":"n_a","l":"o_a","k":"p_a","j":"q_a","h":"r_a","i":"s_a","c":"t_a","d":"u_a","e":"v_a","f":"w_a","g":"x_a"}')},10516:function(e){e.exports=JSON.parse('{"b":"A_a","a":"B_a"}')},10517:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SigsSmartComposeSignalInfo=class{getSignalInformation(e){const t=new Date,s=t.getTime()-e.date.getTime();return e.smartComposeInteractionList=this.dedup(e.smartComposeInteractionList),{SignalType:"SmartComposeSummarized",StartTime:e.date,EndTime:t,Compliance:"CustomerContent",Application:{AadAppId:e.sessionInfo.application.aadAppId,AppName:e.sessionInfo.application.appName,AppVer:e.sessionInfo.application.appVer},Actor:{ActorType:e.sessionInfo.actor.actorType,ActorId:e.sessionInfo.actor.actorId,ActorIdType:e.sessionInfo.actor.actorIdType,AadTenantId:e.sessionInfo.actor.aadTenantId},Device:{Os:e.sessionInfo.device.os,OsVer:e.sessionInfo.device.osVer,UserAgent:e.sessionInfo.device.userAgent},CustomProperties:{dsatReported:0,satReported:0,SessionId:e.sessionId,SessionDuration:s,SmartComposeType:e.sessionInfo.composeType,ModelVersion:e.modelVersion,SmartComposeInteractionList:e.smartComposeInteractionList}}}dedup(e){let t=new Map;for(let s of e)if(t.has(s.suggestionTraceId)){t.get(s.suggestionTraceId).merge(s)}else t.set(s.suggestionTraceId,s);let s=[];for(let e of t.values())s.push(e);return s}}},14517:function(e,t,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UserMailbox=1]="UserMailbox",e[e.GroupMailbox=2]="GroupMailbox",e[e.Unknown=3]="Unknown"}(n=t.MailboxType||(t.MailboxType={}));let i=["PublicDL","PrivateDL","GroupMailbox","PublicFolder"],o=["User","Contact","InternalMailbox","ExternalMailbox","OneOff","Mailbox","Guest","ImplicitContact","ChatImplicitContact"];t.getType=function(e){return-1!=i.indexOf(e)?n.GroupMailbox:-1!=o.indexOf(e)?n.UserMailbox:n.Unknown}},14518:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(14519);!function(e){e[e.New=0]="New",e[e.Reply=1]="Reply",e[e.ReplyAll=2]="ReplyAll",e[e.Forward=3]="Forward",e[e.EditDraft=4]="EditDraft",e[e.Approve=5]="Approve",e[e.Reject=6]="Reject"}(t.ComposeType||(t.ComposeType={}));t.Attachment=class{constructor(e,t){this.fileName=e,this.fileType=t}};t.Constraint=class{constructor(e,t){this.key=e,this.value=t}};t.UrlParam=class{constructor(e,t){this.name=e,this.value=t}};t.Recipient=class{constructor(e,t,s){this.address=e,this.name=t,s&&(this.mailboxType=n.getType(s))}};t.Email=class{constructor(e,t,s,n,i,o,r){this.subject=e,this.sender=t,this.to=s,this.cc=n,this.bcc=i,this.date=o,this.body=r}};t.Envelope=class{constructor(e,t,s,n,i){this.subject=e,this.to=t,this.cc=s,this.bcc=n,this.attached=i}};t.Actor=class{constructor(e,t,s,n="User"){this.actorId="PUID:"+e,this.actorIdType=t,this.aadTenantId=s,this.actorType=n}};t.Application=class{constructor(e,t,s){this.aadAppId=e,this.appName=t,this.appVer=s}};t.Device=class{constructor(e,t,s){this.os=e,this.osVer=t,this.userAgent=s}};t.SessionInfo=class{constructor(e,t,s,n){this.actor=e,this.application=t,this.device=s,this.composeType=n}}},14519:function(e,t,s){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.UserMailbox=1]="UserMailbox",e[e.GroupMailbox=2]="GroupMailbox",e[e.Unknown=3]="Unknown"}(n=t.MailboxType||(t.MailboxType={}));let i=["PublicDL","PrivateDL","GroupMailbox","PublicFolder"],o=["User","Contact","InternalMailbox","ExternalMailbox","OneOff","Mailbox","Guest","ImplicitContact","ChatImplicitContact"];t.getType=function(e){return-1!=i.indexOf(e)?n.GroupMailbox:-1!=o.indexOf(e)?n.UserMailbox:n.Unknown}},14520:function(e,t,s){"use strict";function n(e){for(var s in e)t.hasOwnProperty(s)||(t[s]=e[s])}Object.defineProperty(t,"__esModule",{value:!0}),n(s(6838)),n(s(2886)),n(s(10517)),n(s(14521))},14521:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(6838),i=s(10517),o=s(14522);class r{constructor(e,t,s,i,o,a,c,u){this.backspaceNum=0,this.callbackfunction=a,this.callbackLogging=c,this.curReceived=!0,this.date=e.dateTime,this.e2ePreLatency=0,this.lastUpdatedEmailBody="",this.envelope=e,this.frameNumber=0,this.offset=0,this.requireSessionUpdate=!1,this.requestNumber=0,this.requestsMap=new Map,this.sessionId=u,this.sessionInfo=s,this.smartComposeInteractionList=[],this.state=n.States.UnStarted,this.reconnectAttempts=0,this.urlParams=o,this.userAuthToken=i,t||(t=r.DEFAULT_URL),this.url=t,this.ws=this.createWS(this.url),this.setupWSHandler(this.ws,this.envelope,this.userAuthToken,n.States.Started)}createWS(e){return e||(e=r.DEFAULT_URL),new o(e+"?"+r.PROTOCOL_VERSION,r.PROTOCOL_NAME)}setupWSHandler(e,t,s,i){let o={a:"Bearer "+s,s:t.subject,u:t.user,t:t.to,n:Array.from(t.constraints.keys()),v:Array.from(t.constraints.values())};e.onopen=()=>{e.send(JSON.stringify(o)),this.state=i,this.state==n.States.WSBOpen?(this.wsBackup=e,this.ws=this.wsBackup,this.wsBackup=void 0):this.ws=e},e.onclose=e=>{if(this.callbackLogging&&this.callbackLogging("Websocket close event code"+e.code),1002==e.code||1008==e.code)this.state=n.States.Faulted;else if(1e3==e.code)this.state=n.States.Complete;else{if(this.state==n.States.Complete||this.state==n.States.Inactive)return;if(this.state!=n.States.UnStarted&&(this.state=n.States.Restarting),this.reconnectAttempts>=r.MAX_RECONNECT_ATTEMPTS)return;this.reconnectAttempts++;let e=r.RECONNECT_INTERVAL*Math.pow(2,this.reconnectAttempts)+500*Math.random();setTimeout(()=>{this.state==n.States.UnStarted?this.reconnectWS(this.envelope,this.url,this.userAuthToken,n.States.Started):this.reconnectWS(this.envelope,this.url,this.userAuthToken,n.States.Restarted)},e)}},e.onerror=e=>{this.state!=n.States.UnStarted&&(this.state=n.States.Faulted)},e.onmessage=e=>{let t=void 0;this.state==n.States.Open||this.state==n.States.Started||this.state==n.States.BuildingWSB?(t=this.processResponse(e),!this.toSendRequest||this.state!=n.States.Open&&this.state!=n.States.BuildingWSB||(this.sendRequest(this.toSendRequest[0],!0,this.toSendRequest[1]),this.toSendRequest=void 0)):this.state!=n.States.Restarted&&this.state!=n.States.WSBOpen||(t=this.processResponse(e)),t&&this.callbackfunction(t)}}reconnectWS(e,t,s,n){let i=this.createWS(t);this.setupWSHandler(i,e,s,n)}buildBackupWS(){this.state=n.States.BuildingWSB,this.reconnectWS(this.envelope,this.url,this.userAuthToken,n.States.WSBOpen)}requestSuggestion(e,t,s,i,o){this.requestNumber+=1;let a=new n.SuggestionRequest(t,this.e2ePreLatency,s,this.requestNumber,o);if(this.state==n.States.Open||this.state==n.States.Started||this.state==n.States.BuildingWSB){if(e.length>=this.lastUpdatedEmailBody.length&&e.startsWith(this.lastUpdatedEmailBody)){if(e.length==this.lastUpdatedEmailBody.length)return;let t=e.substring(this.lastUpdatedEmailBody.length);this.backspaceNum+=t.length,a.a=t.substr(-2048)}else if(e.length<this.lastUpdatedEmailBody.length&&this.lastUpdatedEmailBody.startsWith(e)){let t=this.lastUpdatedEmailBody.length-e.length;this.backspaceNum-=t,this.backspaceNum<=0?(a.b=e.substr(-r.PREFIX_MAX),this.backspaceNum=Math.min(e.length,r.BACKSPACE_MAX)):a.r=t}else a.b=e.substr(-r.PREFIX_MAX),this.backspaceNum=Math.min(e.length,r.BACKSPACE_MAX);this.requireSessionUpdate&&(a.s=this.envelope.subject,a.t=this.envelope.to,this.requireSessionUpdate=!1),this.curReceived?this.sendRequest(a,!1,i):this.toSendRequest=[a,i]}else this.state!=n.States.Restarted&&this.state!=n.States.WSBOpen||(a.b=e.substr(-2048),this.sendRequest(a,!1,i))}requestSuggestionForChar(e,t,s,i,o){this.requestNumber+=1;let r=new n.SuggestionRequest(t,this.e2ePreLatency,s,this.requestNumber,o);r.a=e,this.requireSessionUpdate&&(r.s=this.envelope.subject,r.t=this.envelope.to,this.requireSessionUpdate=!1),this.state==n.States.Open||this.state==n.States.Started||this.state==n.States.BuildingWSB?this.curReceived?this.sendRequest(r,!1,i):this.toSendRequest=[r,i]:this.state!=n.States.Restarted&&this.state!=n.States.WSBOpen||this.sendRequest(r,!1,i)}sendRequest(e,t,s){let i=e.i,o=JSON.stringify(e);if(o.length<=r.MAX_MESSAGE_SIZE){if(this.requestsMap.set(i,new n.RequestsInfo((new Date).getTime(),s)),this.ws.send(o),e.b)this.lastUpdatedEmailBody=e.b;else if(e.a)this.lastUpdatedEmailBody+=e.a;else if(e.r){let t=this.lastUpdatedEmailBody.length;this.lastUpdatedEmailBody=this.lastUpdatedEmailBody.substr(0,t-e.r)}this.e2ePreLatency=0,t||(this.curReceived=!1)}}processResponse(e){let t=(new Date).getTime(),s=JSON.parse(e.data);if(s&&s.f&&s.i){let e=this.requestsMap.get(s.f);e&&(this.e2ePreLatency=t-e.time,s.context=e.context,this.requestsMap.delete(s.f)),s.t=s.i+"."+s.f}return this.state==n.States.Started||null==this.sessionId?this.sessionId=s.i:s.i=this.sessionId,this.curReceived=!0,this.state!=n.States.BuildingWSB&&(this.state=n.States.Open),-1==s.x&&this.ws.close(1e3,"BlockedMSG Disconnection"),1==s.r&&this.reconnectAttempts<r.MAX_RECONNECT_ATTEMPTS&&(this.reconnectAttempts++,this.buildBackupWS()),s}deactivateSession(){this.state=n.States.Inactive}activateSession(){this.reconnectWS(this.envelope,this.url,this.userAuthToken,n.States.Restarted)}updateSession(e,t){this.envelope.subject=e,t.length>n.Envelope.MAX_RECIPIENT_NUM&&(t=t.slice(0,3)),this.envelope.to=t,this.requireSessionUpdate=!0}updateAuthToken(e){this.userAuthToken=e}addSuggestionInfo(e){this.smartComposeInteractionList.push(e)}getSignalInformation(){return(new i.SigsSmartComposeSignalInfo).getSignalInformation(this)}terminateSession(){this.ws.readyState===o.OPEN&&this.ws.close(1e3,"Deliberate disconnection"),this.state=n.States.Complete}}r.BACKSPACE_MAX=20,r.DEFAULT_URL="wss://fe-26.qas.bing.net/compose",r.MAX_MESSAGE_SIZE=4096,r.MAX_RECONNECT_ATTEMPTS=3,r.PREFIX_MAX=2048,r.PROTOCOL_VERSION="v=1",r.PROTOCOL_NAME="sc1",r.RECONNECT_INTERVAL=4e3,t.createSmartComposeSession=function(e,t,s,n,i,o,a){return new r(e,t,s,n,i,o,a)}},14522:function(e,t,s){(function(t){var s=null;"undefined"!=typeof WebSocket?s=WebSocket:"undefined"!=typeof MozWebSocket?s=MozWebSocket:void 0!==t?s=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?s=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(s=self.WebSocket||self.MozWebSocket),e.exports=s}).call(this,s(122))},14523:function(e){e.exports=JSON.parse('{"b":"y_a","a":"z_a"}')},17104:function(e,t,s){"use strict";s.r(t);var n={};s.r(n),s.d(n,"default",(function(){return et})),s.d(n,"updateRecipientsForSmartCompose",(function(){return b}));var i=s(0),o=s(3),r=Object(o.action)("clearRecipientListChangedFlagAction",(function(){return{}})),a=Object(o.action)("setCurrentlyShownSuggestion",(function(e){return{suggestion:e}})),c=Object(o.action)("removeCurrentlyShownSuggestionFromEditor",(function(e){return{editor:e}})),u=Object(o.action)("modifyCurrentlyShowSuggestionInEditor",(function(e){return{newText:e}})),l=Object(o.action)("addRecentlyRejectedSuggestionsTelemetry",(function(e){return{suggestionTelemetry:e}})),d=Object(o.action)("clearRecentlyRejectedSuggestionsTelemetry"),g=Object(o.action)("addAllSuggestionsTelemetry",(function(e){return{suggestionTelemetry:e}})),h=Object(o.action)("fetchPersonalization"),p=Object(o.action)("reportUsageForPersonalization",(function(e){return{sessionTelemetry:e}})),m=Object(o.action)("cacheSuggestion",(function(e,t,s){return{context:e,suggestion:t,suggestionTelemetry:s}})),f=Object(o.action)("clearSuggestionCache"),S=Object(o.action)("tryRemoveFirstCharacterFromSuggestion",(function(e,t){return{editor:e,session:t}})),v=Object(o.action)("setTabPersonalizationSuggestion",(function(e){return{tabPersonalizationSuggestion:e}})),b=Object(o.action)("updateRecipientsForSmartCompose",(function(e){return{recipients:e}})),y="ShowTab",T="HideTab";var C={viewState:{recipientNames:[],recipientListChanged:!1,currentlyShownSuggestion:null,currentlyAnnouncedSuggestion:null},recentlyRejectedSuggestionsTelemetry:[],allSuggestionsTelemetry:[],personalizationSuggestions:{tabHintSuggestion:{prefer:T,confidenceLevel:"Low"}},suggestionCache:[]},O=Object(o.createStore)("smartCompose",C),R=s(34),w=50;function A(e,t){return e.length<=t?e:e.slice(e.length-t)}Object(o.mutator)(b,(function(e){O().viewState.recipientNames=e.recipients.map((function(e){return e.persona.EmailAddress})),O().viewState.recipientListChanged=!0})),Object(o.mutator)(r,(function(e){O().viewState.recipientListChanged=!1})),Object(o.mutator)(a,(function(e){var t;O().viewState.currentlyShownSuggestion=e.suggestion,O().viewState.currentlyAnnouncedSuggestion=null===(t=e.suggestion)||void 0===t?void 0:t.suggestionText})),Object(o.mutator)(l,(function(e){O().recentlyRejectedSuggestionsTelemetry.push(e.suggestionTelemetry)})),Object(o.mutator)(d,(function(e){O().recentlyRejectedSuggestionsTelemetry=[]})),Object(o.mutator)(g,(function(e){O().allSuggestionsTelemetry.push(e.suggestionTelemetry)})),Object(o.mutator)(v,(function(e){O().personalizationSuggestions.tabHintSuggestion.prefer=e.tabPersonalizationSuggestion})),Object(o.mutator)(m,(function(e){var t=e.context,s=e.suggestion,n=e.suggestionTelemetry,i=A(t,w);R.g.info("[SmartComposePlugin]. Caching new suggestion. Context: '"+i+"'. Suggestion: '"+s+"'");var o=O().suggestionCache;o.push({context:i,suggestion:s,suggestionTelemetry:n}),o.length>20&&o.shift()})),Object(o.mutator)(f,(function(e){O().suggestionCache=[]})),Object(o.mutator)(u,(function(e){var t,s,n,i,o,r,a=O().viewState.currentlyShownSuggestion;a.suggestionText=e.newText;var c=document.createTextNode(e.newText);(null===(s=null===(t=a.suggestionNode)||void 0===t?void 0:t.suggestionTextNode)||void 0===s?void 0:s.parentNode)===(null===(n=a.suggestionNode)||void 0===n?void 0:n.suggestionNode)&&(null===(o=null===(i=a.suggestionNode)||void 0===i?void 0:i.suggestionNode)||void 0===o||o.replaceChild(c,null===(r=a.suggestionNode)||void 0===r?void 0:r.suggestionTextNode),a.suggestionNode.suggestionTextNode=c)}));var j=Object(o.mutatorAction)("removeFirstCharacterFromSuggestion",(function(){var e=O().viewState.currentlyShownSuggestion;if(e.suggestionText.length>1){var t=e.suggestionText.substring(1);e.suggestionText=t,e.suggestionNode.suggestionTextNode.nodeValue=t}else 1===e.suggestionText.length&&(e.suggestionText="",e.suggestionNode.suggestionTextNode.nodeValue="")})),I=s(40);var E=s(134),x=s(5),k="SmartComposeSessionStart",N="SmartComposeSessionCreationFailed",M="SmartComposeSessionEnd",P="SmartComposeRequestSuggestion",L="SmartComposeShowSuggestion",B="SmartComposeAcceptSuggestion",_="SmartComposeRejectSuggestion",D="SmartComposePersonalizationError",U="SmartComposeSuggestionNotRendered";function F(e,t,s){R.g.info("[smartcompose dp] suggestion accepted: "+JSON.stringify(e)),Object(E.r)(B,[e.sessionId,e.suggestionTraceId,e.suggestionAcceptanceTime?e.suggestionAcceptanceTime.toISOString():null,e.acceptanceReason,e.suggestionLength,e.numberOfMatchingCharactersTyped,s,0],{isCore:!0,isCosmosDatapoint:!0}),t&&t.addSuggestionInfo(e)}function q(e){Object(E.r)(D,{detail:e},{logEvery:1})}var W=s(178),z="ows/v1.0/Personalization/suggestions/Mail/SmartCompose";function V(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e;return Object(i.__generator)(this,(function(t){switch(t.label){case 0:return[4,Object(W.b)(z,void 0,!0,void 0,void 0,void 0,"fetchSmartComposePersonalization")];case 1:e=t.sent(),t.label=2;case 2:return t.trys.push([2,6,,7]),e.ok?[4,e.json()]:[3,4];case 3:return[2,t.sent()];case 4:return q("error getting signals"),R.g.info("fetchSmartComposePersonalization: server reported error"),[2,null];case 5:return[3,7];case 6:return t.sent(),q("error parsing signals"),R.g.info("fetchSmartComposePersonalization: exception parsing response"),[2,null];case 7:return[2]}}))}))}var G=s(5967);var J=s(3076),X=s(2886);function H(e,t,s){var n=new Date;e.suggestionAcceptanceTime=n,e.acceptedSuggestion=t,e.acceptanceReason=s}function K(e,t,s,n){var i,o,r=O().viewState.currentlyShownSuggestion;r&&(H(r.suggestionTelemetry,r.suggestionText,t),i=r.suggestionText,(o=O().recentlyRejectedSuggestionsTelemetry)&&o.forEach((function(e){e.charactersAcceptedAfterRejection+=i})),F(r.suggestionTelemetry,s,n),function(e,t){if((null==t?void 0:t.suggestionNode)&&t.suggestionNode.childNodes.length>0){var s,n=t.suggestionNode,i=n.childNodes.item(0).textContent.replace(" ","Â "),o=document.createDocumentFragment(),r=i.split("\n");r.forEach((function(e,t){var n=document.createTextNode(e);if(o.appendChild(n),s=n,t<r.length-1){var i=document.createElement("br");o.appendChild(i)}})),e.addUndoSnapshot(),e.deleteNode(n),e.insertNode(o,{position:3,updateCursor:!1,replaceSelection:!0,insertOnNewLine:!1}),e.addUndoSnapshot(),e.select(s,-1)}}(e,r.suggestionNode),a(null))}X.SmartComposeInteraction;Object(o.orchestrator)(c,(function(e){var t,s,n=O().viewState.currentlyShownSuggestion;J.d.disable=!1,n&&(t=e.editor,(s=n.suggestionNode)&&t?t.deleteNode(s.suggestionNode):R.g.info("[Smart Compose] Could not remove suggestion from editor"),a(null))})),Object(o.orchestrator)(h,(function(e){return Object(i.__awaiter)(void 0,void 0,void 0,(function(){var e;return Object(i.__generator)(this,(function(t){switch(t.label){case 0:return[4,V()];case 1:return null===(e=t.sent())?v(T):0===e.length?v(y):e.forEach((function(e){e.action!==y&&e.action!==T||v(e.action)})),[2]}}))}))})),Object(o.orchestrator)(p,(function(e){var t=e.sessionTelemetry,s=t.suggestionsAccepted,n=t.suggestionsRejected,o=t.dsatReported,r=t.satReported,a=[],c=[];a.SuggestionAccepted=s||0,a.SAT=r||0,c.SuggestionRejected=n||0,c.DSAT=o||0,Object(I.i)("mc-personalization")&&function(e,t,s,n){Object(i.__awaiter)(this,void 0,void 0,(function(){return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return[4,G.c.importAndExecute(e,t,s,n)];case 1:return i.sent(),[2]}}))}))}(a,c,"Mail","SmartCompose")})),Object(o.orchestrator)(S,(function(e){var t=e.editor,s=e.session,n=O().viewState.currentlyShownSuggestion;n.suggestionText.length>1?j():1===n.suggestionText.length&&(j(),R.g.info("[smartCompose] implicit acceptance of the suggestion"),K(t,X.AcceptanceReason.TypedEverything,s,0))}));var Z="suggestedCompletion";var Y=s(208),Q=s(85);var $=s(321);function ee(e,t,s){var n=new Date;e.suggestionRejectionTime=n,e.rejectionReason=t,e.nonMatchingCharacterTyped=s,e.charactersTypedAfterRejection="",e.charactersAcceptedAfterRejection=""}X.SmartComposeInteraction;var te=s(8999),se=s(6838),ne=s(62),ie=s(2),oe=s(296);function re(e,t,s){return{suggestionText:e,suggestionNode:t,suggestionTelemetry:s}}var ae=50;function ce(e,t,s){var n,i,o,r=O().viewState.currentlyShownSuggestion;if(r){if(r.suggestionText&&r.suggestionText.length>0&&r.suggestionText[0]===t)return R.g.info("[smartCompose] typed matching character"),r.suggestionTelemetry.numberOfMatchingCharactersTyped++,S(e,s),!0;R.g.info("[smartCompose] typed non-matching character"),l(r.suggestionTelemetry),ee(r.suggestionTelemetry,(n=r,i=Date.now(),o=n.suggestionTelemetry.initialRenderTime?n.suggestionTelemetry.initialRenderTime.valueOf():0,i-o<ae?(R.g.info("[smartCompose] Suggestion rejected by typing non-matching character, but it was visible for very little time"),X.RejectionReason.NotSeen):(R.g.info("[smartCompose] Suggestion rejected by typing non-matching character, and it was visible long enough"),X.RejectionReason.TypeNotMatchingCharacter)),t)}return!1}s(14518);function ue(e){return new se.Recipient(e.EmailAddress,e.Name,e.MailboxType)}var le=s(7),de=s(10515),ge=s(10516),he={composeAssistanceCategory1:"Not relevant",composeAssistanceCategory2:"Don't sound like me",composeAssistanceCategory3:"Offensive or rude",composeAssistanceCategory4:"Didn't save me time",composeAssistanceCategory5:"Too frequent",feedbackDialogOtherOption:"Other"};var pe=0,me=1,fe=2;function Se(e){return(null==e?void 0:e.recipients)?e.recipients.map((function(e){return e.persona.EmailAddress})):[]}var ve=44,be=3,ye=/\r\n|\n|\r/g;function Te(e,t){var s=e.length+t.length;return s>ve?"..."+e.substring(Math.max(s-ve,0)):e}function Ce(e,t,s,n){var i,o;if(g(n),e){var r=void 0,a=void 0,c=void 0,u=void 0,l=void 0,d=void 0;return e.suggestion||e.modelVersion?(r=e.traceId,a=e.serviceLatency,c=e.suggestion,u=null===(i=null==e?void 0:e.suggestionSource)||void 0===i?void 0:i.toString(),l=e.modelVersion):(r=e.t,a=e.l,c=e.s,u=null===(o=null==e?void 0:e.x)||void 0===o?void 0:o.toString(),l=e.m,d=e.i),function(e,t,s,n,i,o,r){var a=new Date;e.suggestionTraceId=t||Object(Y.a)(),e.serviceLatency=s,e.totalResponseLatency=a.getTime()-e.suggestionRequestTime.getTime(),e.suggestionReturned=n,r&&(e.sessionId=r),i&&(e.suggestion=i,e.suggestionLength=i.length,e.suggestionSource=o,e.suggestionReturned=!0)}(n,r,a,!!c,c,e&&u,d),function(e,t,s){e.modelVersion=t,s&&(e.sessionId=s)}(t,l,d),function(e,t){R.g.info("[smartcompose dp] request suggestion: "+JSON.stringify(e)),e.suggestionReturned&&Object(E.r)(P,[e.sessionId,e.suggestionTraceId,e.suggestionRequestTime?e.suggestionRequestTime.toISOString():null,e.totalResponseLatency,e.serviceLatency,e.suggestionReturned,e.suggestionLength,e.suggestionSource,0],{isCore:!0,isCosmosDatapoint:!0}),t&&e.suggestionReturned&&t.addSuggestionInfo(e)}(n,s),re(c,null,n)}return R.g.info("[SmartComposePlugin] no suggestion response"),null}var Oe=s(63);function Re(e){return e===Oe.a.space||e>=Oe.a.zero&&e<=Oe.a.nine||e>=Oe.a.a&&e<=Oe.a.z||e>=Oe.a.zero_numpad&&e<=Oe.a.nine_numpad||e>=Oe.a.semicolon&&e<=Oe.a.graveAccent||e>=Oe.a.openBracket&&e<=Oe.a.singleQuote}function we(){var e=O().viewState.currentlyShownSuggestion;e&&(ee(e.suggestionTelemetry,X.RejectionReason.ImplicitRejection),l(e.suggestionTelemetry))}function Ae(e){O().recentlyRejectedSuggestionsTelemetry.forEach((function(t){!function(e,t){R.g.info("[smartcompose dp] suggestion rejected: "+JSON.stringify(e)),Object(E.r)(_,[e.sessionId,e.suggestionTraceId,e.suggestionRejectionTime?e.suggestionRejectionTime.toISOString():null,e.rejectionReason,e.numberOfMatchingCharactersTyped,0],{isCore:!0,isCosmosDatapoint:!0}),t&&t.addSuggestionInfo(e)}(t,e)})),d()}new RegExp("\x3c!--owa-smart-compose-start--\x3e.*?\x3c!--owa-smart-compose-end--\x3e","gim");var je=s(9e3);var Ie=s(12);function Ee(){return O().personalizationSuggestions.tabHintSuggestion.prefer===y}var xe=Ie.DefaultPalette.neutralSecondary,ke=Ie.DefaultPalette.neutralTertiary;function Ne(e,t,s,n,i,o,r){if(!e)return null;var a=document.createElement("span");a.style.whiteSpace="pre-wrap";var c=document.createElement("span");c.textContent=Object(le.b)(ge.b),c.style.width="49px",c.style.height="19px",c.style.borderRadius="2px",c.style.borderStyle="solid",c.style.borderWidth="1px",c.style.borderColor=xe,c.style.whiteSpace="nowrap",c.style.fontSize="0.7em",c.style.paddingLeft="3px",c.style.paddingRight="3px",c.style.paddingTop="1px",c.style.marginLeft="4px",c.style.position="relative",c.style.top="-2px",a.className=Z,a.setAttribute("contenteditable","false");var u=document.createTextNode(t);return a.appendChild(u),Ee()&&a.appendChild(c),a.style.color=o?ke:xe,function(e,t,s){var n=new Date;e.initialRenderTime=n,e.charactersTypedInSessionAtShownTime=t,e.numberOfCharactersRendered=s}(s,n,r),function(e,t){R.g.info("[smartcompose dp] suggestion shown: "+JSON.stringify(e)),Object(E.r)(L,[e.sessionId,e.suggestionTraceId,e.initialRenderTime?e.initialRenderTime.toISOString():null,0,e.numberOfCharactersRendered,0],{isCore:!0,isCosmosDatapoint:!0}),t&&t.addSuggestionInfo(e)}(s,i),e.addUndoSnapshot(),e.insertNode(a,{position:3,updateCursor:!1,replaceSelection:!0,insertOnNewLine:!1}),J.d.disable=!0,{suggestionNode:a,suggestionTextNode:u}}function Me(e,t,s,n,i,o){c(e),a(t),t.suggestionNode=Ne(e,t.suggestionText,t.suggestionTelemetry,s,n,i,o)}var Pe=s(3224),Le=s(439),Be=s(375),_e=s(14520);function De(e){for(var t=A(e,w),s=O().suggestionCache,n=0;n<s.length;n++){var i=s[n],o=i.context+i.suggestion,r=o.lastIndexOf(t);if(-1!==r){var a=o.substring(r+t.length);if(e.length<w&&0!==r)break;if((null==a?void 0:a.length)<=i.suggestion.length)return{context:i.context,suggestion:a,suggestionTelemetry:i.suggestionTelemetry}}}return null}var Ue=s(4894),Fe=s(1),qe=s(32),We=s(14523),ze=Object(qe.a)((function(e){var t=e.suggestion,s="";if(t){var n=Object(le.b)(We.b),i=Object(le.b)(We.a);s=Ee()?n+t+i:n+t}return Fe.createElement("div",{role:"status","aria-live":"polite","aria-label":s,"aria-atomic":"true"})})),Ve=Object(qe.a)((function(e){var t,s,n=e.viewState,i=n.feedbackRibbonDetails,o=n.shouldShowFeedbackRibbon,r=n.isFeedbackProvided,a=null===(s=null===(t=O())||void 0===t?void 0:t.viewState)||void 0===s?void 0:s.currentlyAnnouncedSuggestion;return Fe.createElement(Fe.Fragment,null,Fe.createElement(Ue.a,{feedbackRibbonDetails:i,shouldShowFeedbackRibbon:o,isFeedbackProvided:r}),Fe.createElement(ze,{suggestion:a}))})),Ge=s(79),Je=s(7505),Xe=s(3210),He="unknown",Ke=/[\u200B-\u200D\uFEFF]/g,Ze=/[\xC2\xA0]/g,Ye=4e3,Qe=" ",$e=5e3,et=function(){function e(e,t,s,n,i){var o=this;this.adapter=e,this.editorAdapter=t,this.getAllRecipientsWells=s,this.getSubject=n,this.composeOperation=i,this.endSmartComposeSession=function(){var e;if(we(),Ae(o.currentSmartComposeSession),o.sessionTelemetry&&(!function(e,t,s,n){var i=Object(x.Qb)();e.sessionEndTime=i,e.sessionEndReason=s;var o=0,r=0,a=0,c=0,u=0;t.forEach((function(t){if(t.sessionId===e.sessionId){if(o++,t.sessionId!==e.sessionId)return;t.suggestionReturned&&r++,t.initialRenderTime&&a++,t.suggestionAcceptanceTime?c++:t.suggestionRejectionTime&&t.rejectionReason!==X.RejectionReason.NotSeen&&u++}})),e.suggestionsRequested=o,e.suggestionsReceived=r,e.suggestionsShown=a,e.suggestionsAccepted=c,e.suggestionsRejected=u,e.charactersTypedInSession=n}(o.sessionTelemetry,O().allSuggestionsTelemetry,He,o.charactersTypedInSession),e=o.sessionTelemetry,R.g.info("[smartcompose dp] start session: "+JSON.stringify(e)),R.g.info("[smartcompose dp] end session: "+JSON.stringify(e)),Object(E.r)(k,[e.sessionId,e.composeType,e.sessionStartTime?Object(x.tb)(e.sessionStartTime):null,e.showSuggestions,e.userCulture,0],{isCore:!0,isCosmosDatapoint:!0}),Object(E.r)(M,[e.sessionId,e.sessionEndTime?Object(x.tb)(e.sessionEndTime):null,e.suggestionsRequested,e.suggestionsReceived,e.suggestionsShown,e.suggestionsAccepted,e.suggestionsRejected,e.modelVersion,0,e.requestsSentWithNoDelay,e.requestsSentAfterDelay,e.requestsAborted,0],{isCore:!0,isCosmosDatapoint:!0}),p(o.sessionTelemetry)),o.refreshAuthTokenTimer&&(clearInterval(o.refreshAuthTokenTimer),o.refreshAuthTokenTimer=null),o.currentSmartComposeSession){var t=o.currentSmartComposeSession.getSignalInformation();t.CustomProperties.dsatReported=o.sessionTelemetry.dsatReported?o.sessionTelemetry.dsatReported:0,t.CustomProperties.satReported=o.sessionTelemetry.satReported?o.sessionTelemetry.satReported:0,E.o.importAndExecute("SmartComposeSummarized",{start:t.StartTime,compliance:"CustomerContent",customProperties:t.CustomProperties}),o.currentSmartComposeSession.terminateSession(),o.currentSmartComposeSession=null}},this.deactivateSessionBecauseIdle=function(){var e;R.g.info("[SmartComposePlugin] deactivate smart compose session because of idle"),null===(e=o.currentSmartComposeSession)||void 0===e||e.deactivateSession(),o.sessionDeactivatedBecauseOfIdle=!0},this.processCEDContentChanged=function(e){e&&e.length>0&&(o.charactersBeforeCursor||(R.g.info("[SmartComposePlugin] CED content changed and there is no cached characters before cursor, so refetch"),o.charactersBeforeCursor=o.getCharactersBeforeCursor(Ye)))},this.onSuggestionReceived=function(e){var t,s,n;if(o.isCachedSuggestion(e))s=o.charactersBeforeCursor,t=re(e.suggestion,null,e.suggestionTelemetry);else if(e){if(!e.context)return R.g.info("[SmartComposePlugin] Suggestion context is missing"),void c(o.editor);t=Ce(e,o.sessionTelemetry,o.currentSmartComposeSession,e.context.currentSuggestionTelemetry),s=e.context.charactersBeforeCursorAtTimeOfRequest;var i=t.suggestionText;i&&m(s,i,e.context.currentSuggestionTelemetry)}if((null==t?void 0:t.suggestionText)&&o.shouldRenderSuggestions){if(R.g.info("[SmartComposePlugin] onSuggestionReceived "+(null==t?void 0:t.suggestionText)),o.showFeedbackRibbon(),tt())return n=t.suggestionTelemetry,R.g.info("[smartcompose dp] suggestion not shown: "+JSON.stringify(n)),void Object(E.r)(U,[n.sessionId,n.suggestionTraceId,0,0],{isCore:!0,isCosmosDatapoint:!0});var r=o.getCharactersBeforeCursor(Ye);!function(e,t,s,n,i,o,r){var a,u,d;if(s){var g=!1;if(t==n)Me(e,s,i,o,r,null===(a=s.suggestionText)||void 0===a?void 0:a.length),g=!0;else{var h=Object(je.a)(t,n);if(h.length>0&&(u=s.suggestionText,(null==(d=h)?void 0:d.length)<=(null==u?void 0:u.length)?0===u.indexOf(d):0===d.indexOf(u))){var p=s.suggestionText.length;s.suggestionText=function(e,t){return e.substring(t.length)}(s.suggestionText,h),0===s.suggestionText.length?(s.suggestionTelemetry.numberOfMatchingCharactersTyped=p,H(s.suggestionTelemetry,"",X.AcceptanceReason.TypedEverything),F(s.suggestionTelemetry,o,0)):(Me(e,s,i,o,r,p-h.length),g=!0)}}g||(ee(s.suggestionTelemetry,X.RejectionReason.NotSeen),l(s.suggestionTelemetry))}else c(e)}(o.editor,s,t,r,o.charactersTypedInSession,o.currentSmartComposeSession,o.editor.isDarkMode())}else c(o.editor)},this.showFeedbackRibbon=function(){var e,t=function(e,t){return{subCategories:e,categories:[{logString:he.composeAssistanceCategory1,uiString:Object(le.b)(de.c)},{logString:he.composeAssistanceCategory2,uiString:Object(le.b)(de.d)},{logString:he.composeAssistanceCategory3,uiString:Object(le.b)(de.e)},{logString:he.composeAssistanceCategory4,uiString:Object(le.b)(de.f)},{logString:he.composeAssistanceCategory5,uiString:Object(le.b)(de.g)},{logString:he.feedbackDialogOtherOption,uiString:Object(le.b)(ge.a)}],title:Object(le.b)(de.l),subTitle:Object(le.b)(de.k),ghostText:Object(le.b)(de.j),donationText:Object(le.b)(de.h),donationToolTip:Object(le.b)(de.i),donationJson:{messageBody:t},submitCallBack:void 0,cancelCallBack:void 0,createUVTicket:!1}}(function(e){var t=O().allSuggestionsTelemetry,s=[];t.forEach((function(t){t.suggestionReturned&&t.sessionId==e&&s.push({firstString:Te(t.context,t.suggestion).replace(ye," "),secondString:t.suggestion.replace(ye," ")})}));for(var n,i=(n=[],s.forEach((function(e){0===n.filter((function(t){return t.firstString+t.secondString===e.firstString+e.secondString})).length&&n.push(e)})),n);i.length>be;)i.shift();return i}(o.sessionTelemetry.sessionId),null===(e=o.editor)||void 0===e?void 0:e.getContent(3));Object(I.i)("mc-smartComposeFeedback")&&Ue.d.importAndExecute(o.adapter(),{ribbonMessage:Object(le.b)(de.a),thankYouMessage:Object(le.b)(de.b),subFeature:"SmartCompose",noFeedbackDialogParams:t,onFeedbackSubmitted:o.onFeedbackSubmitted})},this.onFeedbackSubmitted=function(e){Ae(o.currentSmartComposeSession),function(e,t){t?e.satReported?e.satReported++:e.satReported=1:e.dsatReported?e.dsatReported++:e.dsatReported=1}(o.sessionTelemetry,e),setTimeout((function(){Ue.c.importAndExecute(o.adapter())}),$e)},this.getCharactersBeforeCursor=function(e){if(null!==o.editor){var t="",s=o.editor.getContentSearcherOfCursor();s&&(t=s.getSubStringBefore(e));var n=o.editor.getBlockTraverser(),i=null==n?void 0:n.currentBlockElement;if(i)for(var r=o.editor.getBodyTraverser(i.getStartNode());t.length<e&&(i=r.getPreviousBlockElement());){var a=i.getTextContent();a&&(t=a+"\n"+t)}return t=(t=t.replace(Ke,"")).replace(Ze,Qe)}return""},this.handleBlur=function(){c(o.editor)},this.shouldRenderSuggestions=0!=(Object(Xe.d)()&Xe.a)}return e.prototype.getName=function(){return"SmartCompose"},e.prototype.initialize=function(e){this.shouldRenderSuggestions&&h(),r(),this.charactersTypedInSession=0,this.previousSuggestionAccepted=!1,this.editor=e,this.recipients={toRecipients:[],ccRecipients:[],bccRecipients:[]},this.updateRecpientListIfNecessary(!0),this.initializeSmartComposeSession(),this.disposer=this.editor.addDomEventHandler({blur:this.handleBlur}),Pe.d.importAndExecute(),f()},e.prototype.dispose=function(){this.disposer(),this.disposer=null,this.editor=null,J.d.disable=!1,this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null),this.endSmartComposeSession(),this.observerDisposer&&(this.observerDisposer(),this.observerDisposer=null)},e.prototype.onPluginEvent=function(e){var t;if(Object(Je.a)()){var s=e;if(0===e.eventType){if(this.updateIdleTimerAndReactivateSessionIfNeeded(),(i=s.rawEvent).isComposing||229===i.keyCode)return;var n=tt();n&&(i.keyCode===Oe.a.tab||i.keyCode===Oe.a.right?(e.rawEvent.preventDefault(),e.rawEvent.stopImmediatePropagation()):i.keyCode===Oe.a.enter||i.keyCode===Oe.a.del?(we(),c(this.editor)):i.keyCode===Oe.a.escape&&(e.rawEvent.preventDefault(),e.rawEvent.stopImmediatePropagation(),this.explicitRejection(n))),Re(i.keyCode)?(this.charactersTypedInSession++,this.charactersBeforeCursor&&(this.charactersBeforeCursor+=i.key,this.checkForSuggestion(s,i.key))):i.keyCode===Oe.a.backspace&&(i.ctrlKey||i.metaKey||i.altKey?(this.explicitRejection(n),this.charactersBeforeCursor=null):(this.charactersBeforeCursor=null===(t=this.getCharactersBeforeCursor(Ye))||void 0===t?void 0:t.slice(0,-1),this.checkForSuggestion(s,i.key,!0)))}else if(2===e.eventType){var i=s.rawEvent;tt()&&(i.keyCode===Oe.a.tab||i.keyCode===Oe.a.right?(K(this.editor,X.AcceptanceReason.ExplicitAccept,this.currentSmartComposeSession,i.keyCode),this.previousSuggestionAccepted=!0,e.rawEvent.preventDefault(),e.rawEvent.stopImmediatePropagation(),this.charactersBeforeCursor=null):i.keyCode!==Oe.a.left&&i.keyCode!==Oe.a.up&&i.keyCode!==Oe.a.down||(we(),c(this.editor),this.charactersBeforeCursor=null)),Re(i.keyCode)||i.keyCode===Oe.a.shift||i.keyCode===Oe.a.backspace||(Ae(this.currentSmartComposeSession),this.charactersBeforeCursor=null),this.cleanOrphanedSuggestionIfNecessary()}else if(8===e.eventType){!function(e){if(e)for(var t=e.querySelectorAll("."+Z),s=0;s<(null==t?void 0:t.length);s++){var n=t[0];(null==n?void 0:n.parentNode)&&n.parentNode.removeChild(n)}}(e.clonedRoot)}else 5===e.eventType||7===e.eventType||10===e.eventType?(we(),c(this.editor),Ae(this.currentSmartComposeSession),this.charactersBeforeCursor=null):6===e.eventType&&(this.charactersBeforeCursor=this.getCharactersBeforeCursor(Ye),this.checkForSuggestion(s,""))}},e.prototype.updateIdleTimerAndReactivateSessionIfNeeded=function(){this.idleTimer&&clearTimeout(this.idleTimer),this.idleTimer=setTimeout(this.deactivateSessionBecauseIdle,12e4),this.sessionDeactivatedBecauseOfIdle&&this.currentSmartComposeSession&&(R.g.info("[SmartComposePlugin] reactivate smart compose session after idle"),this.currentSmartComposeSession.activateSession(),this.sessionDeactivatedBecauseOfIdle=!1)},e.prototype.explicitRejection=function(e){e&&(ee(e.suggestionTelemetry,X.RejectionReason.ExplicitRejection),l(e.suggestionTelemetry),c(this.editor))},e.prototype.willHandleEventExclusively=function(e){return tt()&&0===e.eventType&&(e.rawEvent.keyCode===Oe.a.tab||e.rawEvent.keyCode===Oe.a.right)},e.prototype.setPluginUtils=function(e){this.pluginUtils=e,this.pluginUtils&&(this.observerDisposer=this.pluginUtils.observeMutation(this.processCEDContentChanged,{subtree:!0,childList:!1,characterData:!0,characterDataOldValue:!1}))},e.prototype.getUIComponentClass=function(){return Ve},e.prototype.updateRecpientListIfNecessary=function(e){return!(!O().viewState.recipientListChanged&&!e||!this.getAllRecipientsWells)&&(r(),this.recipients={toRecipients:Se((t=this.getAllRecipientsWells())[pe]),ccRecipients:Se(t[me]),bccRecipients:Se(t[fe])},!0);var t},e.prototype.initializeSmartComposeSession=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e,t,s,n=this;return Object(i.__generator)(this,(function(o){switch(o.label){case 0:return this.sessionTelemetry=(r=this.composeOperation,a=this.shouldRenderSuggestions,c=Object(x.Qb)(),{sessionId:Object(Y.a)(),sessionStartTime:c,composeType:r,showSuggestions:a,userCulture:Object(Q.j)(),requestsSentWithNoDelay:0,requestsSentAfterDelay:0,requestsAborted:0,dsatReported:0,satReported:0}),e=new Map,Object(I.i)("mc-smartComposeEnWW")||Object(I.i)("mc-smartComposeEs")?(e.set("scww","1"),Object(I.i)("mc-smartComposeEnWW")&&e.set("enww_prod","1"),Object(I.i)("mc-smartComposeEs")&&e.set("es_prod","1"),Object(te.b)(e)):(e.set("compliant","1"),Object(te.a)(e)),t=function(e){var t=Object(Q.h)(),s=Object(ne.c)();return{actor:new se.Actor(t.SessionSettings.UserPuid,Object(oe.a)()?"MSA":"AAD",t.SessionSettings.TenantGuid,"User"),application:{aadAppId:Object(ie.o)(),appName:"WAC_Outlook",appVer:Object(ie.p)()},device:{os:s.os,osVer:s.osVersion,userAgent:(null===navigator||void 0===navigator?void 0:navigator.userAgent)?navigator.userAgent:""},composeType:e}}(this.composeOperation),[4,this.getAuthTokenForSmartCompose()];case 1:return s=o.sent(),this.currentSmartComposeSession=Object(_e.createSmartComposeSession)(function(e,t,s,n){return{subject:e,to:t.toRecipients.map((function(e){return ue(e)})),user:s,dateTime:new Date(Date.now()),constraints:n}}(this.getSubject(),this.recipients,new se.Recipient(Object(Q.l)(),Object(Q.k)()),e),"wss://fe-26.qas.bing.net/compose",t,s,[],this.onSuggestionReceived),this.currentSmartComposeSession&&(this.refreshAuthTokenTimer=setInterval((function(){return Object(i.__awaiter)(n,void 0,void 0,(function(){var e;return Object(i.__generator)(this,(function(t){switch(t.label){case 0:return[4,this.getAuthTokenForSmartCompose()];case 1:return(e=t.sent())&&this.currentSmartComposeSession&&this.currentSmartComposeSession.updateAuthToken(e),[2]}}))}))}),12e4)),this.currentSmartComposeSession||(R.g.info("[smartcompose dp] session creation failed"),Object(E.r)(N)),[2]}var r,a,c}))}))},e.prototype.getAuthTokenForSmartCompose=function(){return Object(i.__awaiter)(this,void 0,void 0,(function(){var e;return Object(i.__generator)(this,(function(t){switch(t.label){case 0:return Object(oe.a)()?[2,Object(Be.getDelegationTokenForOwa)("Compose.Send")]:[3,1];case 1:return[4,Object(Le.a)("https://fe-26.qas.bing.net/compose",Object(Y.a)())];case 2:return(e=t.sent())?[2,e.AccessToken]:[2,void 0]}}))}))},e.prototype.getNewSuggestion=function(e,t,s){if(e&&e.length>1){var n=this.updateRecpientListIfNecessary(!1);this.getSuggestionsFromService(e,t,n,s)}},e.prototype.findAndShowNewSuggestion=function(e,t){var s=this;if(this.charactersBeforeCursor){var n=this.charactersBeforeCursor,i=this.areCharactersAfterCursor(e),o=De(n);o?setTimeout((function(){s.onSuggestionReceived(o)}),1):this.getNewSuggestion(n,i,Ce)}else R.g.info("[SmartComposePlugin] Context not already available when finding suggestion. So, stopping")},e.prototype.isCachedSuggestion=function(e){return void 0!==e.context&&void 0!==e.suggestionTelemetry},e.prototype.checkForSuggestion=function(e,t,s){return Object(i.__awaiter)(this,void 0,void 0,(function(){var n,o;return Object(i.__generator)(this,(function(i){return tt()&&s&&(n=De(this.charactersBeforeCursor))?(u(n.suggestion),[2]):(o=ce(this.editor,t,this.currentSmartComposeSession),function(e){var t=O().recentlyRejectedSuggestionsTelemetry;t&&t.forEach((function(t){t.charactersTypedAfterRejection+=e}))}(t),o?(function(){var e,t=null===(e=document.getSelection())||void 0===e?void 0:e.anchorNode,s=3===(null==t?void 0:t.nodeType)?t.parentElement:null;(null==s?void 0:s.className)===Z&&R.g.warn("[SmartComposePlugin] attempting to add text inside of suggestion span")}(),document.execCommand("insertText",!1,t),e.rawEvent.preventDefault(),[2]):(tt()&&c(this.editor),this.isThereACharacterAfterCursor(e)?[2]:(this.findAndShowNewSuggestion(e,t),[2])))}))}))},e.prototype.getSuggestionsFromService=function(e,t,s,n){var i,o,r,a;if(this.currentSmartComposeSession){s&&(this.currentSmartComposeSession.updateSession(this.getSubject(),this.recipients.toRecipients.map(ue)),f());var c=(o=this.sessionTelemetry,r=e,a=new Date,$(new X.SmartComposeInteraction,{sessionId:o.sessionId,suggestionTraceId:void 0,suggestionRequestTime:a,context:r,numberOfMatchingCharactersTyped:0})),u=this.getCharacterTypedDelta(e);this.charactersBeforeCursorOnPreviousRequest=e;var l=t?0:1;u&&(null===(i=this.currentSmartComposeSession)||void 0===i||i.requestSuggestion(e,l,this.previousSuggestionAccepted?1:0,{charactersBeforeCursorAtTimeOfRequest:e,currentSuggestionTelemetry:c},Object(Ge.b)())),this.previousSuggestionAccepted=!1}},e.prototype.getCharacterTypedDelta=function(e){var t=e.lastIndexOf(this.charactersBeforeCursorOnPreviousRequest);if(-1!==t&&this.charactersBeforeCursorOnPreviousRequest)return e.substring(t+this.charactersBeforeCursorOnPreviousRequest.length)},e.prototype.areCharactersAfterCursor=function(e){var t;if(null!==this.editor){var s=this.editor.getContentSearcherOfCursor(e),n=null==s?void 0:s.getInlineElementAfter();if(n){var i=n.getTextContent();if((null==i?void 0:i.length)>0)return!0}else{var o=this.editor.getFocusedPosition();if(o){var r=this.editor.getBodyTraverser(o.element),a=null;try{for(;a=r.getNextBlockElement();)if((null===(t=null==a?void 0:a.getTextContent())||void 0===t?void 0:t.length)>0)return!0}catch(e){R.g.warn("[SmartComposePlugin] error getting characters after cursor")}}}}return!1},e.prototype.isThereACharacterAfterCursor=function(e){var t=this.editor.getContentSearcherOfCursor(e),s=null==t?void 0:t.getInlineElementAfter();return!!(null==s?void 0:s.getTextContent())},e.prototype.cleanOrphanedSuggestionIfNecessary=function(){var e;if(this.shouldRenderSuggestions){var t=tt(),s=null===(e=null==t?void 0:t.suggestionNode)||void 0===e?void 0:e.suggestionNode,n=this.editor.queryElements("."+Z,0);n&&n.forEach((function(e){if(e!==s)try{e.parentElement.removeChild(e)}catch(e){R.g.warn("[SmartComposePlugin] error removing orphaned child node")}}))}},e}();function tt(){return O().viewState.currentlyShownSuggestion}s.d(t,"Plugin",(function(){return n}))},195:function(e,t,s){"use strict";function n(){var e=Object.create(null),t=0,s=0,n=0,i=!1;function o(t){n--,delete e[t]}this.put=function(t,s,i,r){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==r&&"function"!=typeof r)throw new Error("Cache timeout callback must be a function");var a=e[t];a?clearTimeout(a.timeout):n++;var c={value:s,expire:i+Date.now()};return isNaN(c.expire)||(c.timeout=setTimeout(function(){o(t),r&&r(t,s)}.bind(this),i)),e[t]=c,s},this.del=function(t){var s=!0,n=e[t];return n?(clearTimeout(n.timeout),!isNaN(n.expire)&&n.expire<Date.now()&&(s=!1)):s=!1,s&&o(t),s},this.clear=function(){for(var o in e)clearTimeout(e[o].timeout);n=0,e=Object.create(null),i&&(t=0,s=0)},this.get=function(o){var r=e[o];if(void 0!==r){if(isNaN(r.expire)||r.expire>=Date.now())return i&&t++,r.value;i&&s++,n--,delete e[o]}else i&&s++;return null},this.size=function(){return n},this.memsize=function(){var t,s=0;for(t in e)s++;return s},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return s},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var s in e){var n=e[s];t[s]={value:n.value,expire:n.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,s){var n=JSON.parse(t),i=Date.now(),o=s&&s.skipDuplicates;for(var r in n)if(n.hasOwnProperty(r)){if(o)if(e[r])continue;var a=n[r],c=a.expire-i;if(c<=0){this.del(r);continue}c=c>0?c:void 0,this.put(r,a.value,c)}return this.size()}}e.exports=new n,e.exports.Cache=n},2421:function(e,t,s){"use strict";var n=s(3808),i=s(16),o=s(3);t.a=Object(o.createStore)("proofingConfig",{defaultOptions:new i.ObservableMap,optionsLoadState:n.a.NotLoaded,critiqueTypeCategoryNames:new i.ObservableMap,userOptions:{overriddenOptions:new i.ObservableMap,overriddenCategories:new i.ObservableMap,spellCheckEnabled:void 0,grammarEnabled:void 0,proofingLocale:void 0,textPredictionEnabled:void 0,writingRefinementsEnabled:void 0,premiumDemoActivatedCount:void 0,finalDatePremiumDemo:void 0},settingsDialogViewState:{overriddenOptions:new i.ObservableMap,overriddenCategories:new i.ObservableMap,spellCheckEnabled:void 0,grammarEnabled:void 0,proofingLocale:void 0,textPredictionEnabled:void 0,writingRefinementsEnabled:void 0,premiumDemoActivatedCount:void 0,finalDatePremiumDemo:void 0},premiumTemporarilyEnabled:!1})},2762:function(e,t,s){"use strict";s.d(t,"b",(function(){return g})),s.d(t,"a",(function(){return S}));var n=s(134),i=s(2),o=s(40),r=s(16),a="fabricFocus",c="owaFocus",u="addFocusOutline",l=["Tab"],d=["ArrowDown","ArrowLeft","ArrowRight","ArrowUp"],g={disable:!1};function h(e){this.classList.remove(u)}function p(e){return"INPUT"==e.tagName||"TEXTAREA"==e.tagName||e.contentEditable&&"true"==e.contentEditable}function m(e){l.indexOf(e.key)>=0&&!g.disable||d.indexOf(e.key)>=0&&!p(e.target)?this.classList.add(u):p(e.target)&&this.classList.remove(u)}function f(e){e.preventDefault()}function S(){Object(i.w)()===i.c&&document.body.addEventListener("contextmenu",f),null===window||void 0===window||window.addEventListener("appinstalled",(function(){Object(n.r)("PwaInstalled")})),Object(r.autorun)((function(){Object(o.i)("fwk-fabricFocus")?(document.documentElement.classList.add(a),document.documentElement.classList.remove(c),document.body.classList.remove(u),document.body.removeEventListener("mousedown",h,!0),document.body.removeEventListener("keydown",m,!0)):(document.body.addEventListener("mousedown",h,!0),document.body.addEventListener("keydown",m,!0),document.documentElement.classList.add(c),document.documentElement.classList.remove(a))}))}},2878:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=["am-ET","ar-AE","ar-BH","ar-DZ","ar-EG","ar-IL","ar-IQ","ar-JO","ar-KW","ar-LB","ar-LY","ar-MA","ar-OM","ar-QA","ar-SA","ar-SY","ar-TN","ar-YE","bg-BG","bn-BD","bn-IN","bs-Latn-BA","ca-ES","ca-ES-valencia","cs-CZ","cy-GB","da-DK","de-AT","de-CH","de-DE","de-LI","de-LU","el-GR","en-029","en-AU","en-BZ","en-CA","en-GB","en-ID","en-IE","en-JM","en-NZ","en-PH","en-SG","en-TT","en-US","en-ZA","en-ZW","es-AR","es-BO","es-CL","es-CO","es-CR","es-DO","es-EC","es-ES","es-GT","es-HN","es-MX","es-NI","es-PA","es-PE","es-PR","es-PY","es-SV","es-US","es-UY","es-VE","et-EE","eu-ES","fa-IR","fi-FI","fr-BE","fr-CA","fr-CH","fr-FR","fr-LU","fr-MC","ga-IE","gd-GB","gl-ES","gu-IN","ha-Latn-NG","he-IL","hi-IN","hr-BA","hr-HR","hu-HU","hy-AM","id-ID","is-IS","it-CH","it-IT","ja-JP","ka-GE","kk-KZ","kn-IN","ko-KR","kok-IN","ky-KG","lb-LU","lt-LT","lv-LV","mi-NZ","mk-MK","ml-IN","mr-IN","ms-BN","ms-MY","mt-MT","nb-NO","ne-IN","ne-NP","nl-BE","nl-NL","nn-NO","or-IN","pa-IN","pl-PL","pt-PT","ro-MD","ro-RO","ru-MD","ru-RU","si-LK","sk-SK","sl-SI","sq-AL","sr-Cyrl-BA","sr-Latn-CS","sv-FI","sv-SE","sw-KE","ta-IN","te-IN","tr-TR","tt-RU","uk-UA","ur-IN","ur-PK","uz-Latn-UZ","vi-VN"];function i(e){return e?-1!==n.indexOf(e):null}},2886:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NotSeen=0]="NotSeen",e[e.TypeNotMatchingCharacter=1]="TypeNotMatchingCharacter",e[e.ExplicitRejection=2]="ExplicitRejection",e[e.ImplicitRejection=3]="ImplicitRejection"}(t.RejectionReason||(t.RejectionReason={})),function(e){e[e.ExplicitAccept=0]="ExplicitAccept",e[e.TypedEverything=1]="TypedEverything"}(t.AcceptanceReason||(t.AcceptanceReason={}));t.SmartComposeInteraction=class{merge(e){void 0!==e.suggestionRequestTime&&(this.suggestionRequestTime=e.suggestionRequestTime),void 0!==e.initialRenderTime&&(this.initialRenderTime=e.initialRenderTime),void 0!==e.suggestionRejectionTime&&(this.suggestionRejectionTime=e.suggestionRejectionTime),void 0!==e.suggestionAcceptanceTime&&(this.suggestionAcceptanceTime=e.suggestionAcceptanceTime),void 0!==e.totalResponseLatency&&(this.totalResponseLatency=e.totalResponseLatency),void 0!==e.serviceLatency&&(this.serviceLatency=e.serviceLatency),void 0!==e.suggestionReturned&&(this.suggestionReturned=e.suggestionReturned),void 0!==e.suggestionLength&&(this.suggestionLength=e.suggestionLength),void 0!==e.rejectionReason&&(this.rejectionReason=e.rejectionReason),void 0!==e.acceptanceReason&&(this.acceptanceReason=e.acceptanceReason),void 0!==e.numberOfMatchingCharactersTyped&&(this.numberOfMatchingCharactersTyped=e.numberOfMatchingCharactersTyped),void 0!==e.modelversion&&(this.modelversion=e.modelversion),void 0!==e.modelpayload&&(this.modelpayload=e.modelpayload),void 0!==e.suggestionSource&&(this.suggestionSource=e.suggestionSource),void 0!==e.charactersTypedInSessionAtShownTime&&(this.charactersTypedInSessionAtShownTime=e.charactersTypedInSessionAtShownTime),void 0!==e.suggestion&&(this.suggestion=e.suggestion),void 0!==e.acceptedSuggestion&&(this.acceptedSuggestion=e.acceptedSuggestion),void 0!==e.context&&(this.context=e.context),void 0!==e.nonMatchingCharacterTyped&&(this.nonMatchingCharacterTyped=e.nonMatchingCharacterTyped),void 0!==e.charactersTypedAfterRejection&&(this.charactersTypedAfterRejection=e.charactersTypedAfterRejection),void 0!==e.charactersAcceptedAfterRejection&&(this.charactersAcceptedAfterRejection=e.charactersAcceptedAfterRejection)}}},3056:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var n="EditorProofing_UpsellClicked"},3076:function(e,t,s){"use strict";s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return c}));var n=s(44),i=s(2762);s.d(t,"d",(function(){return i.b}));var o=new n.c((function(){return s.e(696).then(s.bind(null,5526))})),r=new n.a(o,(function(e){return e.setupSharedPostBoot})),a=new n.a(o,(function(e){return e.govern})),c=new n.a(o,(function(e){return e.enableGovernReport}))},3224:function(e,t,s){"use strict";s.d(t,"f",(function(){return r})),s.d(t,"d",(function(){return a})),s.d(t,"i",(function(){return c})),s.d(t,"h",(function(){return u})),s.d(t,"g",(function(){return l})),s.d(t,"c",(function(){return d})),s.d(t,"b",(function(){return g})),s.d(t,"e",(function(){return h}));var n=s(44),i=(s(3056),s(2878));s.d(t,"a",(function(){return i.a}));var o=new n.c((function(){return Promise.all([s.e(0),s.e(1),s.e(2),s.e(4),s.e(5),s.e(8),s.e(14),s.e(37),s.e(183),s.e(287),s.e(697)]).then(s.bind(null,5907))})),r=new n.a(o,(function(e){return e.showEditorOptions})),a=new n.a(o,(function(e){return e.getUserOptions})),c=new n.a(o,(function(e){return e.updateSettingDirectly})),u=new n.a(o,(function(e){return e.tryStartTrial})),l=new n.a(o,(function(e){return e.startPremiumPreviewTimeBased})),d=new n.a(o,(function(e){return e.getDefaultOptions})),g=new n.a(o,(function(e){return e.getAllOverriddenOptions})),h=new n.a(o,(function(e){return e.openUpsellUrlFromSettingsDialog}))},342:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return r}));var n,i=s(0);function o(e){n=e}function r(){var e,t;return Object(i.__awaiter)(this,void 0,void 0,(function(){var s,o;return Object(i.__generator)(this,(function(i){switch(i.label){case 0:return(o=n)?[4,n()]:[3,2];case 1:o=i.sent(),i.label=2;case 2:if((s=o)&&s.length>0){if("bearer"===(null===(e=null==s?void 0:s.split(" ")[0])||void 0===e?void 0:e.toLowerCase()))return[2,s.split(" ")[1]];if("msauth1.0"===(null===(t=null==s?void 0:s.split(" ")[0])||void 0===t?void 0:t.toLowerCase()))return[2,s]}return[2,void 0]}}))}))}},3808:function(e,t,s){"use strict";var n;!function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(n||(n={})),t.a=n},4226:function(e,t,s){"use strict";function n(){return{shouldShowFeedbackRibbon:!1,isFeedbackProvided:!1,feedbackRibbonDetails:{ribbonMessage:void 0,subFeature:void 0,thankYouMessage:void 0,noFeedbackDialogParams:void 0}}}s.d(t,"a",(function(){return n}))},424:function(e,t,s){"use strict";var n=function(){function e(e,t,s){this.maxParallelTasks=e,this.taskCallback=t,this.taskDelay=s,this.taskList=[],this.numberOfTasksRunning=0}return e.prototype.add=function(e){this.taskList.unshift(e),this.scheduleTask()},e.prototype.clear=function(){this.taskList.splice(0,this.taskList.length)},e.prototype.canRunMoreTasks=function(){return this.numberOfTasksRunning<this.maxParallelTasks&&this.taskList.length>0},e.prototype.scheduleTask=function(){var e=this;this.canRunMoreTasks()&&setTimeout((function(){e.tryRunTask()}),this.taskDelay)},e.prototype.onTaskComplete=function(){this.numberOfTasksRunning--,this.scheduleTask()},e.prototype.tryRunTask=function(){var e=this;if(this.canRunMoreTasks()){var t=this.taskList.pop();this.numberOfTasksRunning++,this.taskCallback(t).then((function(){e.onTaskComplete()})).catch((function(){e.onTaskComplete()})),this.scheduleTask()}},e}();s.d(t,"a",(function(){return n}))},4894:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"d",(function(){return a})),s.d(t,"c",(function(){return c}));var n=s(44),i=s(4226);s.d(t,"b",(function(){return i.a}));var o=new n.c((function(){return s.e(362).then(s.bind(null,9631))})),r=Object(n.d)(o,(function(e){return e.ComposeFeedback})),a=new n.a(o,(function(e){return e.showFeedbackRibbon})),c=new n.a(o,(function(e){return e.hideFeedbackRibbon}))},5773:function(e,t,s){"use strict";var n=s(16),i=s(3),o={usageSuggestions:new n.ObservableMap},r=Object(i.createStore)("personalization",o)();t.a=r},5967:function(e,t,s){"use strict";var n=s(44),i=s(5773);function o(e){var t;return null===(t=i.a.usageSuggestions)||void 0===t?void 0:t.get(e)}s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return c})),s.d(t,"a",(function(){return o}));var r=new n.c((function(){return s.e(873).then(s.bind(null,17220))})),a=new n.a(r,(function(e){return e.initializePersonalizationSuggestions})),c=(new n.a(r,(function(e){return e.postPersonalizationSuggestionFeedback})),new n.a(r,(function(e){return e.postPersonalizationUsageSignals})))},6838:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const n=s(14517);!function(e){e[e.New=0]="New",e[e.Reply=1]="Reply",e[e.ReplyAll=2]="ReplyAll",e[e.Forward=3]="Forward",e[e.EditDraft=4]="EditDraft",e[e.Approve=5]="Approve",e[e.Reject=6]="Reject"}(t.ComposeType||(t.ComposeType={})),function(e){e[e.UnStarted=0]="UnStarted",e[e.Started=1]="Started",e[e.Restarting=2]="Restarting",e[e.Restarted=3]="Restarted",e[e.Open=4]="Open",e[e.Complete=5]="Complete",e[e.Faulted=6]="Faulted",e[e.Inactive=7]="Inactive",e[e.BuildingWSB=8]="BuildingWSB",e[e.WSBOpen=9]="WSBOpen"}(t.States||(t.States={}));t.Attachment=class{constructor(e,t){this.fileName=e,this.fileType=t}};t.UrlParam=class{constructor(e,t){this.name=e,this.value=t}};t.Recipient=class{constructor(e,t,s){this.a=e,this.n=t,s&&(this.t=n.getType(s))}};t.Email=class{constructor(e,t,s,n,i,o,r){this.subject=e,this.sender=t,this.to=s,this.cc=n,this.bcc=i,this.date=o,this.body=r}};class i{constructor(e,t,s,n,o){this.user=e,this.dateTime=t,this.constraints=s,this.subject=n,o.length>i.MAX_RECIPIENT_NUM&&(o=o.slice(0,3)),this.to=o}}t.Envelope=i,i.MAX_RECIPIENT_NUM=3;t.RequestsInfo=class{constructor(e,t){this.time=e,this.context=t}};t.Actor=class{constructor(e,t,s="User",n){this.actorId="PUID:"+e,this.actorIdType=t,this.aadTenantId=n,this.actorType=s}};t.Application=class{constructor(e,t,s){this.aadAppId=e,this.appName=t,this.appVer=s}};t.Device=class{constructor(e,t,s){this.os=e,this.osVer=t,this.userAgent=s}};t.SessionInfo=class{constructor(e,t,s,n){this.actor=e,this.application=t,this.device=s,this.composeType=n}};t.SuggestionRequest=class{constructor(e,t,s,n,i){this.sr=e,this.l=t,this.ac=s,this.i=n,this.cv=i}}},7505:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(2421);function i(){return Object(n.a)().userOptions.textPredictionEnabled}},8999:function(e,t,s){"use strict";s.d(t,"a",(function(){return i})),s.d(t,"b",(function(){return o}));var n=s(40);function i(e){Object(n.i)("mc-smartCompose-exp-flight01")&&e.set("flight","1"),Object(n.i)("mc-smartCompose-exp-flight02")&&e.set("flight","2"),Object(n.i)("mc-smartCompose-exp-flight03")&&e.set("flight","3"),Object(n.i)("mc-smartCompose-exp-flight04")&&e.set("flight","4"),Object(n.i)("mc-smartCompose-exp-flight05")&&e.set("flight","5"),Object(n.i)("mc-smartCompose-exp-flight06")&&e.set("flight","6"),Object(n.i)("mc-smartCompose-exp-flight07")&&e.set("flight","7"),Object(n.i)("mc-smartCompose-exp-flight08")&&e.set("flight","8"),Object(n.i)("mc-smartCompose-exp-flight09")&&e.set("flight","9"),Object(n.i)("mc-smartCompose-exp-flight10")&&e.set("flight","10")}function o(e){Object(n.i)("mc-smartComposeIntl-exp-flight01")&&e.set("intl_flight","1"),Object(n.i)("mc-smartComposeIntl-exp-flight02")&&e.set("intl_flight","2"),Object(n.i)("mc-smartComposeIntl-exp-flight03")&&e.set("intl_flight","3"),Object(n.i)("mc-smartComposeIntl-exp-flight04")&&e.set("intl_flight","4"),Object(n.i)("mc-smartComposeIntl-exp-flight05")&&e.set("intl_flight","5")}},9e3:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n="";function i(e,t){if(!e||!t)return n;if(e.length>=t.length)return n;if(0!==t.indexOf(e))return n;for(var s=n,i=e.length;i<t.length;i++)s+=t.charAt(i);return s}}}]);
//# sourceMappingURL=owa.MailBoot~SmartComposePlugin.js.map
self.scriptsLoaded['owa.MailBoot~SmartComposePlugin.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.MailBoot~SmartComposePlugin.js'] = (new Date()).getTime();